{
    "template_name": "Knowledge_Graph_Extraction_Multi_Layer",
    "model_target": "Mistral-NeMo:12B (Local)",
    "language": "zh-TW",
    "instruction_template": [
      "你是一位專業的知識圖譜工程師，請仔細閱讀以下 [TEXT_CHUNK]。",
      "任務：抽取符合內部 Ontology 規範的三元組結構化知識，並對每個三元組進行質量評估。",
      "你必須嚴格遵守以下由我們動態載入的規則，否則你的輸出將被系統拒絕。",

      "## 功能分層說明",
      "本任務分為三個層次：",
      "1. **Extraction Layer (抽取層)**: 負責從文本中識別實體和關係，生成候選三元組",
      "2. **Judgment Layer (裁決層)**: 負責評估三元組質量，判斷是否適合入圖",
      "3. **Schema Layer (格式層)**: 強制 JSON Schema 規範，確保系統可直接解析",

      "### 1. 核心實體類型 (Entity Classes):",
      "[INJECT_ENTITY_LIST]",

      "### 2. 關係類型約束 (Relationship Types):",
      "[INJECT_RELATIONSHIP_LIST]",

      "### 3. OWL Domain/Range 規則 (嚴格約束):",
      "提取的三元組必須滿足 Domain-Range 約束。例如，如果關係是 'produces'，則主體必須是 'Machine_Asset'，客體必須是 'Material'。",

      "### 4. GraphRAG 裁決規則 (Judgment Layer):",
      "對每個候選三元組，請進行以下評估：",
      "1. **證據充分性**: 三元組必須在文本中有明確的證據支持，禁止推測或創造",
      "2. **置信度評估**: 請給出 0~1 的置信度數值，表示你對該三元組的信心",
      "   - 0.9-1.0: 文本中明確提及，證據充分",
      "   - 0.7-0.9: 文本中提及，但需要一定推斷",
      "   - 0.5-0.7: 文本中隱含，需要較多推斷",
      "   - <0.5: 證據不足，不建議入圖",
      "3. **核心節點識別**: 如果實體是文檔的核心概念（如主要人物、關鍵設備、重要流程），請在置信度中體現（高置信度通常表示核心節點）",
      "4. **保守原則**: 當證據不足或存在歧義時，請保守處理，寧可遺漏也不要錯誤入圖",
      "5. **禁止創造**: 絕對禁止模型自行新增文本中未明確出現的實體或關係",

      "### 5. 上下文一致性要求:",
      "1. **實體名稱一致性**: 如果同一實體在不同片段出現，請保持名稱完全一致，避免創建重複節點",
      "2. **類型一致性**: 同一實體在不同三元組中應保持相同的實體類型",
      "3. **關係一致性**: 相同實體對之間的關係應保持一致",

      "### 6. 輸出格式 (JSON Schema):",
      "[INJECT_JSON_SCHEMA]",
      "",
      "**重要**: 你的輸出必須完全符合上述 JSON Schema，不得包含任何 Markdown、註解、額外文字或說明。",
      "如果無法生成符合規範的三元組，請輸出空列表 `{\"extracted_triples\": []}`。",
      "系統會自動驗證 JSON 格式，任何格式錯誤都會導致提取失敗。",

      "### 7. 待分析文本片段 (Text Chunk):",
      "[TEXT_CHUNK]",

      "### 8. 輸出 (JSON):"
    ],

    "injection_placeholders": {
      "INJECT_ENTITY_LIST": "用於插入所有合併後的實體類別名稱列表。",
      "INJECT_RELATIONSHIP_LIST": "用於插入所有合併後的關係名稱列表。",
      "INJECT_JSON_SCHEMA": "用於插入由 Pydantic 模型動態生成的 JSON Schema。",
      "TEXT_CHUNK": "待分析的文檔內容片段。"
    },

    "extraction_example_slot": {
      "enabled": false,
      "description": "可選地，在這裡插入 Few-Shot 範例來提高特定任務的準確性。啟用時，LangChain Agent 應將範例插入到 '### 7. 待分析文本片段' 之前。"
    },
    "model_parameters": {
      "recommended": {
        "temperature": 0.0,
        "top_p": 0.9,
        "top_k": 40,
        "max_tokens": 512
      },
      "description": "建議的模型參數（可在服務層配置，不強制）。temperature=0.0 確保穩定性，max_tokens=512 適合單個 chunk 處理。"
    }
  }
