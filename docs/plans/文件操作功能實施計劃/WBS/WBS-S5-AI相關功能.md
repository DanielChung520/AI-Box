# WBS計劃 - 階段五：AI相關功能（S5）

**創建日期**: 2025-01-27
**創建人**: Daniel Chung
**最後修改日期**: 2025-01-27

## 階段概述

**目標**: 實現AI相關的文件操作功能
**工作量**: 3 天
**優先級**: P2
**依賴**: S1

---

## 任務分解

### S5.1 附加文件到聊天功能（1 天）

**任務描述**: 實現附加文件到聊天API

**實施位置**: `api/routers/file_management.py`

**API設計**:
- **端點**: `POST /api/v1/files/{file_id}/attach`
- **響應**: 文件摘要信息（用於聊天上下文）

**實現步驟**:
1. [ ] 在 `file_management.py` 中新增 `attach_file_to_chat` 函數
2. [ ] 實現文件信息獲取（重用 `get_metadata_service().get()`）
3. [ ] 實現文件摘要生成（可選，使用LLM生成摘要）
4. [ ] 返回文件摘要信息
5. [ ] 添加錯誤處理和日誌記錄
6. [ ] 添加審計日誌

**重用服務**:
- `get_metadata_service()` - 文件元數據服務

**驗收標準**:
- [ ] API可以成功附加文件
- [ ] 文件摘要信息正確返回
- [ ] 錯誤處理完善
- [ ] 現有功能不受影響

---

### S5.2 查看向量資料功能（1 天）

**任務描述**: 實現查看向量資料API

**實施位置**: `api/routers/file_management.py`

**API設計**:
- **端點**: `GET /api/v1/files/{file_id}/vectors`
- **響應**: 向量列表和統計信息

**實現步驟**:
1. [ ] 在 `file_management.py` 中新增 `get_file_vectors` 函數
2. [ ] 實現文件存在性檢查
3. [ ] 實現權限檢查
4. [ ] 實現向量查詢（重用 `get_vector_store_service()`）
5. [ ] 實現向量統計信息計算
6. [ ] 返回向量列表和統計信息
7. [ ] 添加錯誤處理和日誌記錄

**重用服務**:
- `get_vector_store_service()` - 向量存儲服務

**驗收標準**:
- [ ] API可以成功查詢向量資料
- [ ] 向量列表正確返回
- [ ] 統計信息正確計算
- [ ] 權限檢查正確
- [ ] 錯誤處理完善
- [ ] 現有功能不受影響

---

### S5.3 查看圖譜資料功能（1 天）

**任務描述**: 實現查看圖譜資料API

**實施位置**: `api/routers/file_management.py`

**API設計**:
- **端點**: `GET /api/v1/files/{file_id}/graph`
- **響應**: 圖譜節點和邊

**實現步驟**:
1. [ ] 在 `file_management.py` 中新增 `get_file_graph` 函數
2. [ ] 實現文件存在性檢查
3. [ ] 實現權限檢查
4. [ ] 實現圖譜查詢（重用 `get_kg_extraction_service()`）
5. [ ] 實現圖譜數據格式化
6. [ ] 返回圖譜節點和邊
7. [ ] 添加錯誤處理和日誌記錄

**重用服務**:
- `get_kg_extraction_service()` - 圖譜提取服務

**驗收標準**:
- [ ] API可以成功查詢圖譜資料
- [ ] 圖譜節點和邊正確返回
- [ ] 權限檢查正確
- [ ] 錯誤處理完善
- [ ] 現有功能不受影響

---

## 階段交付物

- ✅ 附加文件到聊天API實現完成
- ✅ 查看向量資料API實現完成
- ✅ 查看圖譜資料API實現完成
- ✅ 單元測試完成
- ✅ 集成測試完成
- ✅ API文檔更新完成

---

## 測試要求

### 單元測試
- [ ] 測試附加文件到聊天功能
- [ ] 測試查看向量資料功能
- [ ] 測試查看圖譜資料功能
- [ ] 測試錯誤處理

### 集成測試
- [ ] 測試與現有服務的集成
- [ ] 測試權限檢查
- [ ] 測試數據查詢正確性

---

## 注意事項

- ⚠️ **禁止移動現有文件**
- ⚠️ **禁止修改現有代碼**
- ⚠️ **禁止改變現有API路徑**
- ✅ **重用現有服務和函數**
- ✅ **新增功能使用新API路徑**
