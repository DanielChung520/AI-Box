# å¼€å‘ç¯å¢ƒè®¾ç½®æŒ‡å—

**åˆ›å»ºæ—¥æœŸ**: 2025-12-29
**åˆ›å»ºäºº**: Daniel Chung
**æœ€åä¿®æ”¹æ—¥æœŸ**: 2025-12-29
**å…³è”æ–‡æ¡£**: [SeaweedFS ä½¿ç”¨æŒ‡å—](./æ ¸å¿ƒç»„ä»¶/SeaweedFSä½¿ç”¨æŒ‡å—.md)ã€[éƒ¨ç½²æ¶æ„](./æ ¸å¿ƒç»„ä»¶/éƒ¨ç½²æ¶æ„.md)

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•è®¾ç½® AI-Box ç³»ç»Ÿçš„å¼€å‘ç¯å¢ƒï¼ŒåŒ…æ‹¬ SeaweedFS é…ç½®ã€æ•°æ®åº“é…ç½®å’Œå…¶ä»–å¿…è¦çš„ç¯å¢ƒè®¾ç½®ã€‚

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### åŸºç¡€é…ç½®

å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼š

```bash
cp env.example .env
```

### SeaweedFS é…ç½®

#### AI-Box é¡¹ç›® SeaweedFS é…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# AI-Box é¡¹ç›®çš„ SeaweedFS é…ç½®
AI_BOX_SEAWEEDFS_S3_ENDPOINT=http://seaweedfs-ai-box-filer:8333
AI_BOX_SEAWEEDFS_S3_ACCESS_KEY=your-access-key
AI_BOX_SEAWEEDFS_S3_SECRET_KEY=your-secret-key
AI_BOX_SEAWEEDFS_USE_SSL=false
AI_BOX_SEAWEEDFS_FILER_ENDPOINT=http://seaweedfs-ai-box-filer:8888
```

**é…ç½®è¯´æ˜**ï¼š

- `AI_BOX_SEAWEEDFS_S3_ENDPOINT`: SeaweedFS S3 API ç«¯ç‚¹
  - Kubernetes ç¯å¢ƒï¼š`http://seaweedfs-ai-box-filer:8333`
  - æœ¬åœ°å¼€å‘ç¯å¢ƒï¼š`http://localhost:8333`ï¼ˆå¦‚æœæœ¬åœ°è¿è¡Œ SeaweedFSï¼‰
- `AI_BOX_SEAWEEDFS_S3_ACCESS_KEY`: S3 è®¿é—®å¯†é’¥
- `AI_BOX_SEAWEEDFS_S3_SECRET_KEY`: S3 ç§˜å¯†å¯†é’¥
- `AI_BOX_SEAWEEDFS_USE_SSL`: æ˜¯å¦ä½¿ç”¨ SSL/TLSï¼ˆå¼€å‘ç¯å¢ƒé€šå¸¸ä¸º `false`ï¼‰
- `AI_BOX_SEAWEEDFS_FILER_ENDPOINT`: SeaweedFS Filer API ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰

#### DataLake é¡¹ç›® SeaweedFS é…ç½®

å¦‚æœéœ€è¦ä½¿ç”¨ DataLake é¡¹ç›®çš„ SeaweedFS æœåŠ¡ï¼Œé…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# DataLake é¡¹ç›®çš„ SeaweedFS é…ç½®
DATALAKE_SEAWEEDFS_S3_ENDPOINT=http://seaweedfs-datalake-filer:8333
DATALAKE_SEAWEEDFS_S3_ACCESS_KEY=your-access-key
DATALAKE_SEAWEEDFS_S3_SECRET_KEY=your-secret-key
DATALAKE_SEAWEEDFS_USE_SSL=false
DATALAKE_SEAWEEDFS_FILER_ENDPOINT=http://seaweedfs-datalake-filer:8888
```

### å­˜å‚¨åç«¯é€‰æ‹©

ç³»ç»Ÿä¼šæ ¹æ®ç¯å¢ƒå˜é‡è‡ªåŠ¨é€‰æ‹©å­˜å‚¨åç«¯ï¼š

1. **å¦‚æœé…ç½®äº† SeaweedFS ç¯å¢ƒå˜é‡**ï¼šä½¿ç”¨ `S3FileStorage`ï¼ˆSeaweedFSï¼‰
2. **å¦‚æœæœªé…ç½® SeaweedFS ç¯å¢ƒå˜é‡**ï¼šä½¿ç”¨ `LocalFileStorage`ï¼ˆæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼‰

**å¼€å‘ç¯å¢ƒå»ºè®®**ï¼š

- **æœ¬åœ°å¼€å‘**ï¼šå¯ä»¥ä¸é…ç½® SeaweedFSï¼Œä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼ˆ`./data/datasets/files`ï¼‰
- **Kubernetes å¼€å‘**ï¼šå¿…é¡»é…ç½® SeaweedFSï¼Œä½¿ç”¨ SeaweedFS åˆ†å¸ƒå¼å­˜å‚¨

### æœ¬åœ°å¼€å‘ç¯å¢ƒ SeaweedFS è®¾ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­è¿è¡Œ SeaweedFSï¼Œå¯ä»¥ä½¿ç”¨ Docker Composeï¼š

```yaml
# docker-compose.seaweedfs.yml
version: '3.8'

services:
  seaweedfs-master:
    image: chrislusf/seaweedfs:latest
    command: "master -ip=seaweedfs-master -port=9333"
    ports:
      - "9333:9333"
    networks:
      - seaweedfs-network

  seaweedfs-volume:
    image: chrislusf/seaweedfs:latest
    command: "volume -mserver=seaweedfs-master:9333 -port=8080"
    depends_on:
      - seaweedfs-master
    networks:
      - seaweedfs-network

  seaweedfs-filer:
    image: chrislusf/seaweedfs:latest
    command: "filer -master=seaweedfs-master:9333"
    ports:
      - "8888:8888"  # Filer API
      - "8333:8333"  # S3 API
    depends_on:
      - seaweedfs-master
      - seaweedfs-volume
    networks:
      - seaweedfs-network

networks:
  seaweedfs-network:
    driver: bridge
```

å¯åŠ¨ SeaweedFSï¼š

```bash
docker-compose -f docker-compose.seaweedfs.yml up -d
```

ç„¶åæ›´æ–° `.env` æ–‡ä»¶ä¸­çš„ç«¯ç‚¹ï¼š

```bash
AI_BOX_SEAWEEDFS_S3_ENDPOINT=http://localhost:8333
AI_BOX_SEAWEEDFS_FILER_ENDPOINT=http://localhost:8888
```

### åˆ›å»º Buckets

ä½¿ç”¨è„šæœ¬åˆ›å»ºæ‰€æœ‰å¿…è¦çš„ Bucketsï¼š

```bash
# åˆ›å»ºæ‰€æœ‰ Bucketsï¼ˆAI-Box å’Œ DataLakeï¼‰
python scripts/migration/create_seaweedfs_buckets.py --service all

# åªåˆ›å»º AI-Box æœåŠ¡çš„ Buckets
python scripts/migration/create_seaweedfs_buckets.py --service ai_box

# åªåˆ›å»º DataLake æœåŠ¡çš„ Buckets
python scripts/migration/create_seaweedfs_buckets.py --service datalake

# ä¹¾é‹è¡Œæ¨¡å¼ï¼ˆä¸å¯¦éš›å‰µå»ºï¼‰
python scripts/migration/create_seaweedfs_buckets.py --service all --dry-run
```

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### ArangoDB é…ç½®

```bash
ARANGO_HOST=localhost
ARANGO_PORT=8529
ARANGO_USER=root
ARANGO_PASSWORD=your-password
ARANGO_DB=ai_box
```

### Redis é…ç½®

```bash
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
```

### ChromaDB é…ç½®

```bash
CHROMA_HOST=localhost
CHROMA_PORT=8000
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†ä»“åº“

```bash
git clone <repository-url>
cd AI-Box
```

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows
```

### 3. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
pip install -r requirements-dev.txt
```

### 4. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡
```

### 5. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»º ArangoDB Schema
python scripts/migration/create_schema.py

# åˆ›å»º SeaweedFS Bucketsï¼ˆå¦‚æœä½¿ç”¨ SeaweedFSï¼‰
python scripts/migration/create_seaweedfs_buckets.py --service all
```

### 6. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨ API æœåŠ¡
python -m api.main

# å¯åŠ¨ Workerï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
python -m workers.worker
```

---

## ğŸ” éªŒè¯é…ç½®

### éªŒè¯ SeaweedFS è¿æ¥

```python
from storage.file_storage import create_storage_from_config
from storage.s3_storage import SeaweedFSService

# æµ‹è¯• AI-Box æœåŠ¡è¿æ¥
config = {
    "storage_backend": "s3",
    "service_type": "ai_box",
}
storage = create_storage_from_config(config, service_type=SeaweedFSService.AI_BOX)

# æµ‹è¯•æ–‡ä»¶æ“ä½œ
file_id, s3_uri = storage.save_file(b"test content", "test.txt")
print(f"File saved: {file_id}, URI: {s3_uri}")

content = storage.read_file(file_id)
print(f"File content: {content}")
```

### éªŒè¯æ•°æ®åº“è¿æ¥

```bash
# éªŒè¯ ArangoDB è¿æ¥
python -c "from database.arangodb import get_arangodb_client; client = get_arangodb_client(); print('ArangoDB connected:', client.db is not None)"

# éªŒè¯ Redis è¿æ¥
python -c "from database.redis import get_redis_client; client = get_redis_client(); print('Redis connected:', client.ping())"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [SeaweedFS ä½¿ç”¨æŒ‡å—](./æ ¸å¿ƒç»„ä»¶/SeaweedFSä½¿ç”¨æŒ‡å—.md) - SeaweedFS è¯¦ç»†ä½¿ç”¨è¯´æ˜
- [éƒ¨ç½²æ¶æ„](./æ ¸å¿ƒç»„ä»¶/éƒ¨ç½²æ¶æ„.md) - Kubernetes éƒ¨ç½²è¯´æ˜
- [å­˜å‚¨æ¶æ„](./æ ¸å¿ƒç»„ä»¶/å­˜å‚¨æ¶æ„.md) - å­˜å‚¨æ¶æ„è¯¦ç»†è¯´æ˜

---

**æœ€åæ›´æ–°æ—¥æœŸ**: 2025-12-29
