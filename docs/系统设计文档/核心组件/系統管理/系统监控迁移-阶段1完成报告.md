# ç³»ç»Ÿç›‘æ§è¿ç§»å®æ–½è®°å½• - é˜¶æ®µ1å®ŒæˆæŠ¥å‘Š

**é˜¶æ®µ**: é˜¶æ®µ1 - ç¯å¢ƒå‡†å¤‡
**å®Œæˆæ—¥æœŸ**: 2026-01-18 13:29 UTC+8
**æ‰§è¡Œäºº**: AI Agent
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ æ‰§è¡Œæ¦‚å†µ

### ä»»åŠ¡å®Œæˆæƒ…å†µ

- **æ€»ä»»åŠ¡æ•°**: 9
- **å·²å®Œæˆ**: 9
- **å®Œæˆç‡**: 100%
- **å®é™…è€—æ—¶**: çº¦ 10 åˆ†é’Ÿ

### ä»»åŠ¡æ˜ç»†

| ä»»åŠ¡ID | ä»»åŠ¡åç§°             | çŠ¶æ€      | å®Œæˆæ—¶é—´           |
| ------ | -------------------- | --------- | ------------------ |
| 1.1    | æ£€æŸ¥å‰ç½®æ¡ä»¶         | âœ… å·²å®Œæˆ | 2026-01-18 13:27   |
| 1.2    | å®‰è£… Python ä¾èµ–     | âœ… å·²å®Œæˆ | 2026-01-18 13:27   |
| 1.3    | åˆ›å»ºç›®å½•ç»“æ„         | âœ… å·²å®Œæˆ | 2026-01-18 13:27   |
| 1.4    | åˆ›å»º Prometheus é…ç½® | âœ… å·²å®Œæˆ | 2026-01-18 13:27   |
| 1.5    | åˆ›å»ºå‘Šè­¦è§„åˆ™é…ç½®     | âœ… å·²å®Œæˆ | 2026-01-18 13:27   |
| 1.6    | åˆ›å»º Grafana é…ç½®    | âœ… å·²å®Œæˆ | 2026-01-18 13:27   |
| 1.7    | åˆ›å»º Docker Compose  | âœ… å·²å®Œæˆ | 2026-01-18 13:28   |
| 1.8    | å¯åŠ¨ç›‘æ§æœåŠ¡         | âœ… å·²å®Œæˆ | 2026-01-18 13:28   |
| 1.9    | éªŒè¯æœåŠ¡å¯ç”¨æ€§       | âœ… å·²å®Œæˆ | 2026-01-18 13:29   |

---

## âœ… éªŒæ”¶ç»“æœ

### å‰ç½®æ¡ä»¶æ£€æŸ¥

- [x] Docker å·²å®‰è£…: Docker version 28.5.2, build ecc6942
- [x] Docker Compose å·²å®‰è£…: Docker Compose version v2.40.3-desktop.1

### Python ä¾èµ–å®‰è£…

- [x] prometheus-client: å·²å®‰è£… (0.23.1)
- [x] prometheus-fastapi-instrumentator: å·²å®‰è£… (7.1.0)
- [x] psutil: å·²å®‰è£… (7.2.1)

### ç›®å½•ç»“æ„åˆ›å»º

```
monitoring/
â”œâ”€â”€ prometheus/
â”‚   â”œâ”€â”€ prometheus.yml
â”‚   â””â”€â”€ alerts.yml
â”œâ”€â”€ grafana/
â”‚   â””â”€â”€ provisioning/
â”‚       â”œâ”€â”€ datasources/
â”‚       â”‚   â””â”€â”€ prometheus.yml
â”‚       â””â”€â”€ dashboards/
â”‚           â””â”€â”€ dashboard.yml
â””â”€â”€ alertmanager/
    â””â”€â”€ alertmanager.yml

docker-compose.monitoring.yml
```

### æœåŠ¡å¯ç”¨æ€§éªŒè¯

| æœåŠ¡           | ç«¯å£ | çŠ¶æ€ç  | éªŒè¯ç»“æœ |
| -------------- | ---- | ------ | -------- |
| Prometheus     | 9090 | 200    | âœ… æ­£å¸¸  |
| Grafana        | 3001 | 302    | âœ… æ­£å¸¸  |
| Node Exporter  | 9100 | 200    | âœ… æ­£å¸¸  |
| Redis Exporter | 9121 | 200    | âœ… æ­£å¸¸  |
| Alertmanager   | 9093 | 200    | âœ… æ­£å¸¸  |

### Docker å®¹å™¨çŠ¶æ€

æ‰€æœ‰ç›‘æ§å®¹å™¨å·²æˆåŠŸå¯åŠ¨å¹¶è¿è¡Œï¼š

```
NAME                   IMAGE                          STATUS
aibox-prometheus       prom/prometheus:latest         Up (è¿è¡Œä¸­)
aibox-grafana          grafana/grafana:latest         Up (è¿è¡Œä¸­)
aibox-alertmanager     prom/alertmanager:latest       Up (è¿è¡Œä¸­)
aibox-node-exporter    prom/node-exporter:latest      Up (è¿è¡Œä¸­)
aibox-redis-exporter   oliver006/redis_exporter:latest Up (è¿è¡Œä¸­)
```

### Prometheus Targets çŠ¶æ€

æ‰€æœ‰é…ç½®çš„ç›‘æ§ç›®æ ‡éƒ½è¢« Prometheus æˆåŠŸå‘ç°ï¼š

- âœ… fastapi: <http://host.docker.internal:8000/metrics>
- âœ… node-exporter: <http://node-exporter:9100/metrics>
- âœ… prometheus: <http://localhost:9090/metrics>
- âœ… redis-exporter: <http://redis-exporter:9121/metrics>

---

## ğŸ“ é‡è¦è¯´æ˜

### ArangoDB Exporter å¤„ç†

åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç° `arangodb/arangodb-exporter:latest` é•œåƒä¸å­˜åœ¨ï¼Œå·²åšä»¥ä¸‹å¤„ç†ï¼š

- æš‚æ—¶æ³¨é‡Šäº† ArangoDB Exporter ç›¸å…³é…ç½®
- å°†åœ¨é˜¶æ®µ3ï¼ˆExporters éƒ¨ç½²ï¼‰æ—¶å¯»æ‰¾åˆé€‚çš„æ›¿ä»£æ–¹æ¡ˆæˆ–è‡ªå®šä¹‰å®ç°
- ä¸å½±å“å…¶ä»–ç›‘æ§ç»„ä»¶çš„æ­£å¸¸è¿è¡Œ

### Docker Compose é…ç½®æ›´æ–°

- ç§»é™¤äº†å·²åºŸå¼ƒçš„ `version` å­—æ®µ
- æ‰€æœ‰é…ç½®æ–‡ä»¶éƒ½å·²æ·»åŠ äº†è§„èŒƒçš„æ–‡ä»¶å¤´æ³¨é‡Š

---

## ğŸ” é…ç½®æ–‡ä»¶æ¸…å•

### Prometheus é…ç½®

**æ–‡ä»¶**: `monitoring/prometheus/prometheus.yml`

- é…ç½®äº† 5 ä¸ª scrape jobsï¼ˆfastapi, redis-exporter, node-exporter, prometheusï¼‰
- å…¨å±€æŠ“å–é—´éš”: 15 ç§’
- è¯„ä¼°é—´éš”: 15 ç§’
- å¤–éƒ¨æ ‡ç­¾: cluster=aibox-production, environment=production

**æ–‡ä»¶**: `monitoring/prometheus/alerts.yml`

- é…ç½®äº† 3 ä¸ªå‘Šè­¦ç»„ï¼š
  - service_alerts: æœåŠ¡ç›‘æ§å‘Šè­¦ï¼ˆServiceDown, HighErrorRate, HighLatencyï¼‰
  - resource_alerts: èµ„æºç›‘æ§å‘Šè­¦ï¼ˆHighCPUUsage, HighMemoryUsage, HighDiskUsageï¼‰
  - database_alerts: æ•°æ®åº“ç›‘æ§å‘Šè­¦ï¼ˆHighRedisConnections, HighRedisMemoryï¼‰

### Grafana é…ç½®

**æ–‡ä»¶**: `monitoring/grafana/provisioning/datasources/prometheus.yml`

- æ•°æ®æºåç§°: Prometheus
- è®¿é—®æ–¹å¼: proxy
- URL: <http://prometheus:9090>
- é»˜è®¤æ•°æ®æº: true

**æ–‡ä»¶**: `monitoring/grafana/provisioning/dashboards/dashboard.yml`

- æä¾›å•†åç§°: AI Box Dashboards
- è‡ªåŠ¨æ›´æ–°é—´éš”: 10 ç§’
- å…è®¸ UI æ›´æ–°: true

### Alertmanager é…ç½®

**æ–‡ä»¶**: `monitoring/alertmanager/alertmanager.yml`

- Webhook æ¥æ”¶å™¨: <http://host.docker.internal:8000/api/v1/admin/alerts/webhook>
- åˆ†ç»„ç­‰å¾…æ—¶é—´: 10 ç§’
- åˆ†ç»„é—´éš”: 10 ç§’
- é‡å¤é—´éš”: 12 å°æ—¶

### Docker Compose é…ç½®

**æ–‡ä»¶**: `docker-compose.monitoring.yml`

- 5 ä¸ªæœåŠ¡å®¹å™¨ï¼ˆprometheus, grafana, alertmanager, node-exporter, redis-exporterï¼‰
- 3 ä¸ªæŒä¹…åŒ–å·ï¼ˆprometheus_data, grafana_data, alertmanager_dataï¼‰
- ç‹¬ç«‹çš„ç›‘æ§ç½‘ç»œï¼ˆmonitoringï¼‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### é˜¶æ®µ 2ï¼šFastAPI Metrics é›†æˆï¼ˆç¬¬ 2-3 å¤©ï¼‰

ä¸»è¦ä»»åŠ¡ï¼š

1. å¯¼å…¥ Prometheus åº“åˆ° FastAPI
2. å®šä¹‰ä¸šåŠ¡ Metrics æŒ‡æ ‡
3. å®ç° Middleware è¿›è¡ŒæŒ‡æ ‡æ”¶é›†
4. å®ç° `/metrics` ç«¯ç‚¹
5. éªŒè¯ Prometheus èƒ½å¤ŸæŠ“å– FastAPI metrics

é¢„è®¡å·¥æ—¶ï¼š7.5 å°æ—¶

---

## ğŸ“ è®¿é—®ä¿¡æ¯

### æœåŠ¡è®¿é—®åœ°å€

- **Prometheus**: <http://localhost:9090>
- **Grafana**: <http://localhost:3001>
  - é»˜è®¤ç”¨æˆ·å: admin
  - é»˜è®¤å¯†ç : admin
- **Alertmanager**: <http://localhost:9093>
- **Node Exporter**: <http://localhost:9100/metrics>
- **Redis Exporter**: <http://localhost:9121/metrics>

### å¿«é€Ÿå‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.monitoring.yml ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose -f docker-compose.monitoring.yml logs -f [service_name]

# é‡å¯ç›‘æ§æœåŠ¡
docker-compose -f docker-compose.monitoring.yml restart

# åœæ­¢ç›‘æ§æœåŠ¡
docker-compose -f docker-compose.monitoring.yml down

# å¯åŠ¨ç›‘æ§æœåŠ¡
docker-compose -f docker-compose.monitoring.yml up -d
```

---

## âœ¨ æ€»ç»“

é˜¶æ®µ1çš„ç¯å¢ƒå‡†å¤‡å·¥ä½œå·²åœ†æ»¡å®Œæˆï¼Œæ‰€æœ‰éªŒæ”¶æ ‡å‡†å‡å·²è¾¾æˆã€‚ç›‘æ§åŸºç¡€è®¾æ–½å·²æ­å»ºå®Œæˆï¼Œä¸ºåç»­çš„ FastAPI Metrics é›†æˆå’Œä»ªè¡¨æ¿é…ç½®å¥ å®šäº†åšå®åŸºç¡€ã€‚

é™¤äº† ArangoDB Exporter æš‚æ—¶å»¶åå¤„ç†å¤–ï¼Œå…¶ä»–æ‰€æœ‰ç»„ä»¶å‡å·²æ­£å¸¸è¿è¡Œå¹¶é€šè¿‡éªŒè¯ã€‚

**çŠ¶æ€**: âœ… **é˜¶æ®µ1å®Œæˆï¼Œå¯ä»¥è¿›å…¥é˜¶æ®µ2**
