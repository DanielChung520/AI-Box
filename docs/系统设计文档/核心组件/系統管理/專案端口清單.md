# AI-Box 專案端口清單

**創建日期**：2026-01-29  
**創建人**：Daniel Chung  
**最後修改日期**：2026-01-29

本文件整理 AI-Box 專案中所有服務調用的端口，包含 AI-Box 主系統、模擬 Datalake、Data-Agent、Warehouse Manager Agent（庫管員/Tiptop Data-Agent）與 Tiptop Data-Agent Dashboard。

---

## 一、總覽表

| 端口 | 服務 | 所屬系統 | 說明 |
|------|------|----------|------|
| **3000** | AI-Bot 前端 | AI-Box | Vite 開發服務器 |
| **3001** | Grafana | AI-Box 監控 | 監控可視化平台 |
| **5432** | PostgreSQL | AI-Box | 資料庫（docker-compose.qdrant.yml） |
| **6333** | Qdrant REST API | AI-Box | 向量資料庫 REST |
| **6334** | Qdrant gRPC | AI-Box | 向量資料庫 gRPC |
| **6379** | Redis | AI-Box | 快取與 RQ 任務隊列 |
| **8000** | FastAPI API | AI-Box | 後端 API 主服務 |
| **8001** | ChromaDB | AI-Box（生產） | 向量資料庫（已遷移 Qdrant，可忽略） |
| **8002** | MCP Server | AI-Box | MCP 協議服務 |
| **8003** | Warehouse Manager Agent | Data-Agent 體系 | 庫管員 Agent（Tiptop Data-Agent） |
| **8004** | Data Agent | Data-Agent 體系 | 數據查詢 Agent 服務 |
| **8333** | SeaweedFS AI-Box S3 | AI-Box | AI-Box 文件存儲 S3 API |
| **8334** | SeaweedFS Datalake S3 | 模擬 Datalake | Datalake 文件存儲 S3 API |
| **8529** | ArangoDB | AI-Box | 圖資料庫 |
| **8888** | SeaweedFS AI-Box Filer | AI-Box | AI-Box Filer API |
| **8889** | SeaweedFS Datalake Filer | 模擬 Datalake | Datalake Filer API |
| **9090** | Prometheus | AI-Box 監控 | 監控指標收集 |
| **9093** | Alertmanager | AI-Box 監控 | 告警管理 |
| **9100** | Node Exporter | AI-Box 監控 | 主機資源監控 |
| **9121** | Redis Exporter | AI-Box 監控 | Redis 指標 |
| **9181** | RQ Dashboard | AI-Box | 任務隊列監控介面 |
| **9333** | SeaweedFS AI-Box Master | AI-Box | AI-Box Master API |
| **9334** | SeaweedFS Datalake Master | 模擬 Datalake | Datalake Master API |
| **11434** | Ollama | AI-Box | 本機 LLM 服務 |
| **8501** | Tiptop Data-Agent Dashboard | Data-Agent 體系 | Streamlit 儀表板 |
| **80 / 443** | Nginx | AI-Box 生產 | 反向代理（僅生產環境） |

---

## 二、AI-Box 主系統

| 端口 | 服務 | 配置來源 | 環境變數 |
|------|------|----------|----------|
| **3000** | AI-Bot 前端（Vite） | `ai-bot/vite.config.ts` | `FRONTEND_PORT` |
| **5432** | PostgreSQL | `docker-compose.qdrant.yml` | - |
| **6333** | Qdrant REST API | `docker-compose.qdrant.yml` | - |
| **6334** | Qdrant gRPC | `docker-compose.qdrant.yml` | - |
| **6379** | Redis | `docker-compose.qdrant.yml`、`env.example` | `REDIS_PORT` |
| **8000** | FastAPI API | `env.example`、`docker-compose.*.yml` | `API_GATEWAY_PORT` |
| **8002** | MCP Server | `env.example`、`docker-compose.qdrant.yml` | `MCP_SERVER_PORT` |
| **8529** | ArangoDB | `env.example` | `ARANGO_PORT` |
| **8333** | SeaweedFS AI-Box S3 | `docker-compose.seaweedfs.yml` | `AI_BOX_SEAWEEDFS_S3_ENDPOINT` |
| **8888** | SeaweedFS AI-Box Filer | `docker-compose.seaweedfs.yml` | `AI_BOX_SEAWEEDFS_FILER_ENDPOINT` |
| **9333** | SeaweedFS AI-Box Master | `docker-compose.seaweedfs.yml` | - |
| **9181** | RQ Dashboard | `scripts/start_services.sh`、`scripts/rq_dashboard.sh` | `RQ_DASHBOARD_PORT` |
| **11434** | Ollama | `docker-compose.prod.yml`、`env.example` | `OLLAMA_BASE_URL` |

**ChromaDB（已遷移 Qdrant）**：
- **8001**：`docker-compose.prod.yml` 中 ChromaDB 對外映射（容器內 8000）

---

## 三、模擬 Datalake（SeaweedFS Datalake）

| 端口 | 服務 | 配置來源 | 說明 |
|------|------|----------|------|
| **9334** | SeaweedFS Datalake Master | `docker-compose.seaweedfs-datalake.yml` | 主機 9334 → 容器 9333 |
| **8334** | SeaweedFS Datalake S3 | `docker-compose.seaweedfs-datalake.yml` | 主機 8334 → 容器 8333 |
| **8889** | SeaweedFS Datalake Filer | `docker-compose.seaweedfs-datalake.yml` | 主機 8889 → 容器 8888 |

**環境變數**（`.env`）：
```bash
DATALAKE_SEAWEEDFS_S3_ENDPOINT=http://localhost:8334
DATALAKE_SEAWEEDFS_FILER_ENDPOINT=http://localhost:8889
```

---

## 四、Data-Agent 體系

### 4.1 Data Agent（數據查詢 Agent）

| 端口 | 服務 | 配置來源 | 環境變數 |
|------|------|----------|----------|
| **8004** | Data Agent HTTP API | `env.example`、`datalake-system/.ds-docs/README.md` | `DATA_AGENT_SERVICE_PORT`、`DATA_AGENT_SERVICE_URL` |

**啟動**：`./scripts/data_agent/start.sh` 或 `scripts/start_data_agent_service.py`

**端點**：
- `http://localhost:8004/health` - 健康檢查
- `http://localhost:8004/execute` - 執行任務
- `http://localhost:8004/mcp` - MCP 協議

### 4.2 MM-Agent（庫管員 Agent / Tiptop Data-Agent）

| 端口 | 服務 | 配置來源 | 環境變數 |
|------|------|----------|----------|
| **8003** | MM-Agent | `datalake-system/mm_agent/main.py` | `MM_AGENT_SERVICE_PORT` |

**啟動**：`python -m mm_agent.main` 或 `./scripts/mm_agent/start.sh`

**端點**：
- `http://localhost:8003/health` - 健康檢查
- `http://localhost:8003/mcp` - MCP 協議
- `http://localhost:8003/execute` - 執行任務

**依賴**：需連接 Data Agent（`http://localhost:8004`）

### 4.3 Tiptop Data-Agent Dashboard（Streamlit 儀表板）

| 端口 | 服務 | 配置來源 | 說明 |
|------|------|----------|------|
| **8502** | Tiptop Dashboard | dashboard/start.sh | `streamlit run dashboard/app.py --server.port=8502` |

**啟動**：
```bash
cd datalake-system
./dashboard/start.sh
# 或
./scripts/start_dashboard.sh
```

**說明**：Tiptop 數據湖儀表板，展現自然語言查詢與數據分析能力。依賴 Datalake SeaweedFS 與 Data Agent。

---

## 五、AI-Box 監控服務

| 端口 | 服務 | 配置來源 |
|------|------|----------|
| **3001** | Grafana | `docker-compose.monitoring.yml`（主機 3001 → 容器 3000） |
| **9090** | Prometheus | `docker-compose.monitoring.yml` |
| **9093** | Alertmanager | `docker-compose.monitoring.yml` |
| **9100** | Node Exporter | `docker-compose.monitoring.yml` |
| **9121** | Redis Exporter | `docker-compose.monitoring.yml` |

### 5.1 Grafana（端口 3001）

**用途**：監控可視化平台，提供儀表板與圖表展示。

**詳細說明**：
- 主機端口 **3001** 映射至容器內 3000（避免與前端 3000 衝突）
- 預設帳號：`admin` / `admin`
- 內建 Redis 數據源插件（`redis-datasource`）
- 支援 Auth Proxy 整合（與 AI-Box 前端登入整合）
- 預置儀表板：系統概覽、服務狀態、性能監控、Node Exporter 全量、Redis 指標
- 數據來源：Prometheus（`http://prometheus:9090`）
- 支援 iframe 嵌入（`GF_SERVER_ALLOW_EMBEDDING=true`）

**訪問**：`http://localhost:3001`

---

### 5.2 Prometheus（端口 9090）

**用途**：時序資料庫與指標收集中心，負責抓取各服務的 metrics。

**詳細說明**：
- 抓取間隔：15 秒（部分服務 10 秒）
- 資料保留：30 天（`--storage.tsdb.retention.time=30d`）
- 抓取目標：FastAPI (8000)、Redis Exporter (9121)、ArangoDB (8529)、Node Exporter (9100)、Prometheus 自監控
- 告警規則：`monitoring/prometheus/alerts.yml`
- 告警轉發：觸發後送至 Alertmanager (9093)
- 支援 Web UI：`http://localhost:9090` 可查詢 PromQL、檢視 targets 狀態

**訪問**：`http://localhost:9090`

---

### 5.3 Alertmanager（端口 9093）

**用途**：告警管理與路由，接收 Prometheus 告警並進行分組、抑制、通知。

**詳細說明**：
- 接收 Prometheus 觸發的告警
- 分組策略：依 `alertname`、`cluster`、`service` 分組
- 抑制規則：critical 級別會抑制同類 warning
- Webhook 接收器：告警轉發至 AI-Box API `http://host.docker.internal:8000/api/v1/admin/alerts/webhook`
- 解析通知：`send_resolved: true`，告警恢復時也會通知
- 配置檔：`monitoring/alertmanager/alertmanager.yml`

**訪問**：`http://localhost:9093`（檢視告警狀態與靜默設定）

---

### 5.4 Node Exporter（端口 9100）

**用途**：主機系統資源監控，暴露 CPU、記憶體、磁碟、網路等指標。

**詳細說明**：
- 掛載主機 `/proc`、`/sys`、`/` 以讀取系統資訊
- 排除虛擬檔案系統（`sys`、`proc`、`dev` 等）避免干擾
- 提供標準 Linux 主機指標（如 `node_cpu_seconds_total`、`node_memory_*`、`node_filesystem_*`）
- Prometheus 抓取目標：`node-exporter:9100`
- 對應 Grafana 儀表板：`node-exporter-full.json`

**訪問**：`http://localhost:9100/metrics`（僅供 Prometheus 抓取，非人類閱讀介面）

---

### 5.5 Redis Exporter（端口 9121）

**用途**：Redis 指標導出器，將 Redis 運行狀態轉為 Prometheus 格式。

**詳細說明**：
- 連接 Redis：`host.docker.internal:6379`（可透過 `REDIS_PASSWORD` 設定密碼）
- 導出指標：記憶體使用、連線數、命令統計、鍵數量、持久化狀態等
- Prometheus 抓取目標：`redis-exporter:9121`
- 對應 Grafana 儀表板：`redis-dashboard.json`
- 協助監控 RQ 任務隊列底層 Redis 的健康狀態

**訪問**：`http://localhost:9121/metrics`（僅供 Prometheus 抓取）

---

### 5.6 監控架構關係

```
Grafana (3001) ← 查詢 → Prometheus (9090) ← 抓取 → Node Exporter (9100)
                                              ├── Redis Exporter (9121)
                                              ├── FastAPI (8000) /metrics
                                              ├── ArangoDB (8529) /_admin/metrics
                                              └── Prometheus 自監控

Prometheus (9090) ← 告警觸發 → Alertmanager (9093) → Webhook → AI-Box API (8000)
```

---

## 六、服務依賴關係

```
AI-Box 主系統
├── FastAPI (8000) ← 前端 (3000) 代理 /api 到此
├── MCP Server (8002)
├── Redis (6379)
├── Qdrant (6333, 6334)
├── ArangoDB (8529)
├── SeaweedFS AI-Box (9333, 8333, 8888)
└── Ollama (11434)

模擬 Datalake
└── SeaweedFS Datalake (9334, 8334, 8889)

Data-Agent 體系
├── Data Agent (8004) ← 依賴 Datalake SeaweedFS
├── Warehouse Manager Agent (8003) ← 依賴 Data Agent (8004)
└── Tiptop Data-Agent Dashboard (8501) ← 依賴 Datalake SeaweedFS
```

---

## 七、端口衝突檢查

啟動前可執行以下指令檢查端口佔用：

```bash
# 檢查常用端口
for port in 3000 6333 6379 8000 8002 8003 8004 8333 8334 8529 8888 8889 9181 9333 9334 8501; do
  lsof -i :$port 2>/dev/null && echo "端口 $port 已佔用" || echo "端口 $port 可用"
done
```

---

## 八、參考文檔

- `env.example` - 環境變數範例
- `docs/重裝計劃.md` - 重裝與端口說明
- `datalake-system/.ds-docs/ENVIRONMENT.md` - Data Agent 環境配置
- `datalake-system/.ds-docs/Data-Agent-規格書.md` - Data Agent 規格
- `AGENTS.md` - 專案架構與服務端口
