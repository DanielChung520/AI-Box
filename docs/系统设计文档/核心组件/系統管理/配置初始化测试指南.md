# é…ç½®åˆå§‹åŒ–æµ‹è¯•æŒ‡å—

**åˆ›å»ºæ—¥æœŸ**: 2026-01-01
**åˆ›å»ºäºº**: Daniel Chung
**æœ€åä¿®æ”¹æ—¥æœŸ**: 2026-01-01

---

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•æµ‹è¯•ç³»ç»Ÿé…ç½®åˆå§‹åŒ–å’Œè¯»å–åŠŸèƒ½ï¼ŒéªŒè¯ä»£ç ä¿®æ”¹æ˜¯å¦ç¬¦åˆå‚æ•°ç­–ç•¥ã€‚

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### å‰ç½®æ¡ä»¶

1. **ç¡®ä¿ ArangoDB æœåŠ¡è¿è¡Œ**
   ```bash
   # æ£€æŸ¥ ArangoDB æ˜¯å¦è¿è¡Œ
   curl http://localhost:8529/_api/version
   ```

2. **æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®**
   ```bash
   # ç¡®ä¿ .env æ–‡ä»¶å­˜åœ¨ä¸”åŒ…å«æ­£ç¡®çš„ ArangoDB é…ç½®
   cat .env | grep ARANGODB
   ```

3. **å¯åŠ¨ API æœåŠ¡**ï¼ˆå¯é€‰ï¼Œç”¨äºæµ‹è¯• API ç«¯ç‚¹ï¼‰
   ```bash
   python -m uvicorn api.main:app --reload
   ```

---

## ğŸ“ æµ‹è¯• 1: é…ç½®åˆå§‹åŒ–æµ‹è¯•

### æ–¹æ³• 1: é€šè¿‡ API å¯åŠ¨æµ‹è¯•

å¯åŠ¨ API æœåŠ¡åï¼ŒæŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
ç³»çµ±é…ç½®åˆå§‹åŒ–å®Œæˆ: X å€‹å·²åˆå§‹åŒ–ï¼ŒY å€‹å·²å­˜åœ¨ï¼ˆè·³éï¼‰
```

### æ–¹æ³• 2: æ‰‹åŠ¨è¿è¡Œ Python è„šæœ¬

```python
#!/usr/bin/env python3
import sys
from pathlib import Path
from dotenv import load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
project_root = Path(__file__).parent.parent
load_dotenv(project_root / ".env")

sys.path.insert(0, str(project_root))

from services.api.services.config_initializer import initialize_system_configs

# åˆå§‹åŒ–é…ç½®
results = initialize_system_configs(force=False)
print(f"åˆå§‹åŒ–ç»“æœ: {results}")
```

### é¢„æœŸç»“æœ

- âœ… æ‰€æœ‰ 7 ä¸ªé»˜è®¤é…ç½® scope éƒ½åº”è¯¥æˆåŠŸåˆå§‹åŒ–æˆ–å·²å­˜åœ¨
- âœ… å¦‚æœé…ç½®å·²å­˜åœ¨ï¼Œåº”è¯¥æ˜¾ç¤º"å·²å­˜åœ¨ï¼ˆè·³è¿‡ï¼‰"ï¼Œä¸ä¼šè¦†ç›–ç°æœ‰é…ç½®

---

## ğŸ“ æµ‹è¯• 2: é…ç½®è¯»å–æµ‹è¯•

### æµ‹è¯• ArangoDB ä¸­çš„é…ç½®

```python
from services.api.services.config_store_service import ConfigStoreService

service = ConfigStoreService()

# æµ‹è¯•è¯»å–å„ä¸ªé…ç½®
scopes = ["chunk_processing", "file_processing", "streaming"]

for scope in scopes:
    config = service.get_config(scope, tenant_id=None)
    if config:
        print(f"âœ… {scope}: {config.config_data}")
    else:
        print(f"âŒ {scope}: é…ç½®ä¸å­˜åœ¨")
```

### é¢„æœŸç»“æœ

- âœ… æ‰€æœ‰é…ç½®éƒ½èƒ½æˆåŠŸä» ArangoDB è¯»å–
- âœ… `chunk_processing.chunk_size` åº”è¯¥æ˜¯ 768
- âœ… `streaming.chunk_size` åº”è¯¥æ˜¯ 50
- âœ… `file_processing.max_file_size` åº”è¯¥æ˜¯ 104857600 (100MB)

---

## ğŸ“ æµ‹è¯• 3: å‡½æ•°é…ç½®è¯»å–æµ‹è¯•

### æµ‹è¯• `get_chunk_processor()`

```python
from genai.api.routers.chunk_processing import get_chunk_processor

processor = get_chunk_processor()
print(f"chunk_size: {processor.chunk_size}")  # åº”è¯¥æ˜¯ 768
print(f"overlap: {processor.overlap}")  # åº”è¯¥æ˜¯ 0.2
print(f"strategy: {processor.strategy.value}")  # åº”è¯¥æ˜¯ semantic
```

### æµ‹è¯• `get_validator()`

```python
from api.routers.file_upload import get_validator

validator = get_validator()
print(f"max_file_size: {validator.max_file_size}")  # åº”è¯¥æ˜¯ 104857600
print(f"allowed_extensions: {len(validator.allowed_extensions)}")  # åº”è¯¥æœ‰å¤šä¸ªæ‰©å±•å
```

### æµ‹è¯• `get_streaming_chunk_size()`

```python
from api.routers.chat import get_streaming_chunk_size as get_chat_size
from api.routers.streaming import get_streaming_chunk_size as get_streaming_size

chat_size = get_chat_size()
streaming_size = get_streaming_size()

print(f"chat chunk_size: {chat_size}")  # åº”è¯¥æ˜¯ 50
print(f"streaming chunk_size: {streaming_size}")  # åº”è¯¥æ˜¯ 50
```

### é¢„æœŸç»“æœ

- âœ… æ‰€æœ‰å‡½æ•°éƒ½èƒ½æˆåŠŸè¯»å–é…ç½®
- âœ… è¿”å›çš„å€¼åº”è¯¥ä¸ ArangoDB ä¸­çš„é…ç½®ä¸€è‡´
- âœ… å¦‚æœ ArangoDB ä¸­æ²¡æœ‰é…ç½®ï¼Œåº”è¯¥å›é€€åˆ° `config.json`ï¼ˆå‘åå…¼å®¹ï¼‰

---

## ğŸ“ æµ‹è¯• 4: å‘åå…¼å®¹æ€§æµ‹è¯•

### æ­¥éª¤

1. **åˆ é™¤ ArangoDB ä¸­çš„æŸä¸ªé…ç½®**ï¼ˆä¾‹å¦‚ `streaming`ï¼‰

```python
from services.api.services.config_store_service import ConfigStoreService

service = ConfigStoreService()
config = service.get_config("streaming", tenant_id=None)
if config:
    # åˆ é™¤é…ç½®ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
    service._system_collection.delete(config.id)
    print("å·²åˆ é™¤ streaming é…ç½®")
```

2. **æµ‹è¯•å›é€€é€»è¾‘**

```python
from api.routers.chat import get_streaming_chunk_size

# åº”è¯¥å›é€€åˆ°é»˜è®¤å€¼ 50
chunk_size = get_streaming_chunk_size()
print(f"chunk_size: {chunk_size}")  # åº”è¯¥æ˜¯ 50ï¼ˆé»˜è®¤å€¼ï¼‰
```

3. **é‡æ–°åˆå§‹åŒ–é…ç½®**

```python
from services.api.services.config_initializer import initialize_system_configs

# é‡æ–°åˆå§‹åŒ–ï¼ˆåº”è¯¥ä¼šåˆ›å»ºè¢«åˆ é™¤çš„é…ç½®ï¼‰
results = initialize_system_configs(force=False)
print(f"åˆå§‹åŒ–ç»“æœ: {results}")
```

### é¢„æœŸç»“æœ

- âœ… å½“ ArangoDB ä¸­æ²¡æœ‰é…ç½®æ—¶ï¼Œå‡½æ•°åº”è¯¥ä½¿ç”¨é»˜è®¤å€¼æˆ–å›é€€åˆ° `config.json`
- âœ… é‡æ–°åˆå§‹åŒ–åï¼Œé…ç½®åº”è¯¥æ¢å¤

---

## ğŸ“ æµ‹è¯• 5: é…ç½®ä¿®æ”¹æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

### ä¿®æ”¹é…ç½®

```python
from services.api.services.config_store_service import ConfigStoreService
from services.api.models.config import ConfigUpdate

service = ConfigStoreService()

# æ›´æ–° streaming.chunk_size
update = ConfigUpdate(
    config_data={"chunk_size": 100}  # æ”¹ä¸º 100
)
service.update_config(
    scope="streaming",
    config=update,
    tenant_id=None,
    changed_by="test_user"
)

# éªŒè¯ä¿®æ”¹
config = service.get_config("streaming", tenant_id=None)
print(f"æ–°çš„ chunk_size: {config.config_data.get('chunk_size')}")  # åº”è¯¥æ˜¯ 100
```

### éªŒè¯ä¿®æ”¹ç”Ÿæ•ˆ

```python
from api.routers.chat import get_streaming_chunk_size

chunk_size = get_streaming_chunk_size()
print(f"å‡½æ•°è¯»å–çš„ chunk_size: {chunk_size}")  # åº”è¯¥æ˜¯ 100
```

### é¢„æœŸç»“æœ

- âœ… é…ç½®ä¿®æ”¹åï¼Œå‡½æ•°åº”è¯¥èƒ½è¯»å–åˆ°æ–°çš„å€¼
- âœ… æ— éœ€é‡å¯æœåŠ¡ï¼ˆé…ç½®æ˜¯åŠ¨æ€è¯»å–çš„ï¼‰

---

## ğŸ” éªŒè¯ ArangoDB ä¸­çš„æ•°æ®

### ä½¿ç”¨ ArangoDB Web UI

1. è®¿é—® `http://localhost:8529`
2. ç™»å½•åé€‰æ‹©æ•°æ®åº“ï¼ˆé€šå¸¸æ˜¯ `ai_box_kg`ï¼‰
3. è¿›å…¥ `system_configs` collection
4. æŸ¥çœ‹æ‰€æœ‰æ–‡æ¡£

### ä½¿ç”¨ AQL æŸ¥è¯¢

```aql
FOR doc IN system_configs
    FILTER doc.is_active == true
    SORT doc.scope ASC
    RETURN {
        scope: doc.scope,
        chunk_size: doc.config_data.chunk_size,
        max_file_size: doc.config_data.max_file_size,
        created_at: doc.created_at
    }
```

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] ArangoDB è¿æ¥æ­£å¸¸
- [ ] é…ç½®åˆå§‹åŒ–æˆåŠŸï¼ˆ7 ä¸ª scope éƒ½åˆå§‹åŒ–ï¼‰
- [ ] å¯ä»¥ä» ArangoDB è¯»å–æ‰€æœ‰é…ç½®
- [ ] `get_chunk_processor()` èƒ½æ­£ç¡®è¯»å–é…ç½®
- [ ] `get_validator()` èƒ½æ­£ç¡®è¯»å–é…ç½®
- [ ] `get_streaming_chunk_size()` èƒ½æ­£ç¡®è¯»å–é…ç½®
- [ ] å‘åå…¼å®¹æ€§æµ‹è¯•é€šè¿‡ï¼ˆåˆ é™¤é…ç½®åèƒ½å›é€€ï¼‰
- [ ] é…ç½®ä¿®æ”¹åèƒ½ç«‹å³ç”Ÿæ•ˆ

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: ArangoDB è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**: `[HTTP 401][ERR 11] not authorized to execute this request`

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `ARANGODB_USERNAME` å’Œ `ARANGODB_PASSWORD`
2. ç¡®ä¿ ArangoDB æœåŠ¡æ­£åœ¨è¿è¡Œ
3. éªŒè¯ç”¨æˆ·æƒé™æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 2: é…ç½®è¯»å–è¿”å› None

**å¯èƒ½åŸå› **:
1. é…ç½®æœªåˆå§‹åŒ–
2. scope åç§°ä¸æ­£ç¡®
3. `tenant_id` å‚æ•°é”™è¯¯

**è§£å†³æ–¹æ³•**:
1. è¿è¡Œé…ç½®åˆå§‹åŒ–
2. æ£€æŸ¥ scope åç§°æ˜¯å¦æ­£ç¡®
3. ç¡®ä¿ä½¿ç”¨ `tenant_id=None` è¯»å–ç³»ç»Ÿçº§é…ç½®

### é—®é¢˜ 3: å‡½æ•°ä»ç„¶ä½¿ç”¨æ—§é…ç½®

**å¯èƒ½åŸå› **:
1. å‡½æ•°ä½¿ç”¨äº†ç¼“å­˜
2. é…ç½®æœªæ­£ç¡®æ›´æ–°

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥å‡½æ•°æ˜¯å¦ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼ï¼ˆå¯èƒ½éœ€è¦é‡å¯æœåŠ¡ï¼‰
2. éªŒè¯ ArangoDB ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®æ›´æ–°

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æ¶æ„](./éƒ¨ç½²æ¶æ„.md) - ç³»ç»Ÿå‚æ•°é…ç½®ç­–ç•¥
- [éƒ¨ç½²æ¶æ„-å‚æ•°ç­–ç•¥ç¬¦åˆæ€§æ£€æ ¸](./éƒ¨ç½²æ¶æ„-å‚æ•°ç­–ç•¥ç¬¦åˆæ€§æ£€æ ¸.md) - å‚æ•°ä½¿ç”¨ç­–ç•¥ç¬¦åˆæ€§æ£€æ ¸æŠ¥å‘Š

---

**æœ€åæ›´æ–°æ—¥æœŸ**: 2026-01-01

