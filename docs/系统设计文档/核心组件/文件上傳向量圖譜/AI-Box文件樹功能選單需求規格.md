# 代碼功能說明: AI-Box 文件樹功能選單需求規格

# 創建日期: 2026-01-21

# 創建人: Daniel Chung

# 最後修改日期: 2026-01-21

# AI-Box 文件樹功能選單需求規格

## 📋 版本歷史

| 版本 | 日期 | 更新內容 | 更新人 |
|------|------|----------|--------|
| v1.0 | 2026-01-21 | 初始版本 | Daniel Chung |

---

## 1. 概述

本文檔定義前端任務文件區中，資料夾和檔案的右鍵選單功能規格。

---

## 2. 資料夾選單功能

### 2.1 選單結構

```
📁 資料夾名稱
    ├── 📁 新增資料夾
    ├── 📄 新增檔案
    ├── 📋 複製資料夾路徑
    ├── ℹ️ 資料夾信息
    ├── ✂️ 剪下
    ├── 📥 貼上
    ├── ✏️ 重新命名
    └── 🗑️ 刪除
```

### 2.2 功能規格

#### 2.2.1 新增資料夾 (New Folder)

**功能描述**: 在當前資料夾下創建新子資料夾

**前置條件**: 選擇一個資料夾

**操作流程**:

```
用戶點擊「新增資料夾」
    │
    ▼
┌─────────────────────┐
│ 顯示對話框          │
│ - 名稱輸入          │
│ - 位置（當前資料夾）│
└─────────────────────┘
    │
    ▼
POST /api/v1/folders
    │
    ▼
┌─────────────────────┐
│ 成功: 刷新文件樹    │
│ 失敗: 顯示錯誤      │
└─────────────────────┘
```

**API**: `POST /api/v1/folders`

**請求參數**:

```json
{
  "task_id": "task_id",
  "folder_name": "新資料夾名稱",
  "parent_folder_id": "當前資料夾ID"
}
```

**驗證規則**:

- 名稱長度: 1-100 字元
- 不允許字符: `/ \ : * ? " < > |`
- 同一父目錄下名稱唯一

**UI 行為**:

- 對話框包含「取消」和「確認」按鈕
- 輸入時即時驗證名稱格式
- 成功後自動展開新資料夾

---

#### 2.2.2 新增檔案 (New File)

**功能描述**: 在當前資料夾下上傳新檔案

**前置條件**: 選擇一個資料夾

**操作流程**:

```
用戶點擊「新增檔案」
    │
    ▼
┌─────────────────────┐
│ 顯示上傳對話框      │
│ - 選擇檔案          │
│ - 目標資料夾        │
└─────────────────────┘
    │
    ▼
POST /api/v1/files/upload
    │
    ▼
┌─────────────────────┐
│ 成功: 刷新文件樹    │
│ 失敗: 顯示錯誤      │
└─────────────────────┘
```

**API**: `POST /api/v1/files/upload`

**請求參數**:

```multipart/form-data
files: [檔案列表]
task_id: "task_id"
folder_id: "當前資料夾ID"
```

**限制**:

- 單次最多 10 個檔案
- 單檔案最大 100MB

---

#### 2.2.3 複製資料夾路徑 (Copy Path)

**功能描述**: 複製當前資料夾的完整路徑

**前置條件**: 選擇一個資料夾

**操作流程**:

```
用戶點擊「複製資料夾路徑」
    │
    ▼
讀取路徑格式: tasks/{task_id}/{folder_path}
    │
    ▼
複製到剪貼簿
    │
    ▼
顯示 Toast: "路徑已複製到剪貼簿"
```

**路徑格式**:

```
tasks/1768995433434/workspace/子目錄A
```

**注意事項**:

- 路徑為相對於 S3 bucket 的路徑
- 支援複製後直接貼上使用

---

#### 2.2.4 資料夾信息 (Folder Info)

**功能描述**: 顯示資料夾的詳細資訊

**前置條件**: 選擇一個資料夾

**UI 顯示內容**:

```
┌─────────────────────────┐
│ 資料夾資訊              │
├─────────────────────────┤
│ 名稱: 子目錄A           │
│ 類型: workspace         │
│ 路徑: tasks/xxx/...     │
│ 檔案數: 5               │
│ 子資料夾數: 2           │
│ 建立時間: 2026-01-21    │
│ 建立者: daniel@test.com │
└─────────────────────────┘
```

**API**: `GET /api/v1/folders/{folder_id}`

**響應**:

```json
{
  "folder_id": "folder_id",
  "folder_name": "名稱",
  "folder_type": "workspace",
  "task_id": "task_id",
  "path": "tasks/{task_id}/...",
  "file_count": 5,
  "subfolder_count": 2,
  "created_at": "2026-01-21T00:00:00Z",
  "created_by": "daniel@test.com"
}
```

---

#### 2.2.5 剪下 (Cut)

**功能描述**: 剪切資料夾到剪貼簿，準備移動

**前置條件**: 選擇一個資料夾（非系統資料夾）

**操作流程**:

```
用戶點擊「剪下」
    │
    ▼
┌─────────────────────┐
│ 驗證權限            │
│ - 是否為系統資料夾？│
│ - 是否有移動權限？  │
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 寫入剪貼簿          │
│ {                  │
│   type: "folder",  │
│   id: "folder_id", │
│   from: "task_id"  │
│ }                  │
└─────────────────────┘
    │
    ▼
顯示 Toast: "已剪下資料夾"
```

**限制**:

- 系統資料夾 (`_workspace`, `_scheduled`) 不可剪下
- 剪貼簿只能存一個項目

---

#### 2.2.6 貼上 (Paste)

**功能描述**: 將剪下/複製的項目移動到當前資料夾

**前置條件**:

- 剪貼簿有內容
- 選擇一個資料夾作為目標

**操作流程**:

```
用戶點擊「貼上」
    │
    ▼
讀取剪貼簿
    │
    ▼
┌─────────────────────┐
│ 判斷類型            │
│ - folder: 移動資料夾│
│ - file: 移動檔案    │
└─────────────────────┘
    │
    ▼
PUT /api/v1/files/{id}/move  或
PUT /api/v1/folders/{id}/move
    │
    ▼
┌─────────────────────┐
│ 成功: 刷新文件樹    │
│ 失敗: 顯示錯誤      │
└─────────────────────┘
```

**衝突處理**:

- 若目標已存在同名項目，詢問是否覆蓋
- 或自動重新命名: "名稱 (1)"

---

#### 2.2.7 重新命名 (Rename)

**功能描述**: 重新命名資料夾

**前置條件**: 選擇一個資料夾（非系統資料夾）

**操作流程**:

```
用戶點擊「重新命名」
    │
    ▼
┌─────────────────────┐
│ 顯示對話框          │
│ - 當前名稱          │
│ - 新名稱輸入        │
└─────────────────────┘
    │
    ▼
PUT /api/v1/folders/{folder_id}
    │
    ▼
┌─────────────────────┐
│ 成功: 刷新文件樹    │
│ 失敗: 顯示錯誤      │
└─────────────────────┘
```

**限制**:

- 系統資料夾不可重新命名
- 名稱規則同「新增資料夾」

---

#### 2.2.8 刪除資料夾 (Delete)

**功能描述**: 刪除資料夾及其所有內容

**前置條件**: 選擇一個資料夾（非系統資料夾）

**操作流程**:

```
用戶點擊「刪除」
    │
    ▼
┌─────────────────────┐
│ 顯示確認對話框      │
│ 「確定要刪除嗎？」  │
│ [取消] [刪除]       │
└─────────────────────┘
    │
    ▼
用戶確認
    │
    ▼
┌─────────────────────┐
│ 查詢資料夾內容      │
│ - 檔案數            │
│ - 子資料夾數        │
└─────────────────────┘
    │
    ▼
DELETE /api/v1/folders/{folder_id}
    │
    ▼
┌─────────────────────┐
│ 成功: 刷新文件樹    │
│ 失敗: 顯示錯誤      │
└─────────────────────┘
```

**危險操作警告**:

```
⚠️  警告：此操作將刪除以下內容：
     - 資料夾: 子目錄A
     - 檔案: 5 個
     - 子資料夾: 2 個

     此操作無法撤銷。
```

---

## 3. 檔案選單功能

### 3.1 選單結構

```
📄 檔案名稱.md
    ├── ✏️ 重新命名
    ├── 📁 移動文件目錄
    ├── 📋 複製
    ├── 🔗 複製路徑
    ├── ✂️ 剪下
    ├── 📥 貼上
    ├── 📝 使用 IEE 編輯器打開
    ├── 💬 標註到任務指令區
    ├── 🔢 查看向量資料
    ├── 🕸️ 查看圖譜資料
    ├── ℹ️ 查看文件信息
    ├── 🔐 設置權限
    ├── 🗑️ 刪除文件
    └── 🔄 重新上傳文件
```

### 3.2 功能規格

#### 3.2.1 重新命名 (Rename)

**功能描述**: 重新命名檔案

**操作流程**: 同「資料夾重新命名」

**API**: `PUT /api/v1/files/{file_id}`

**請求**:

```json
{
  "filename": "新檔案名稱.md"
}
```

---

#### 3.2.2 移動文件目錄 (Move File)

**功能描述**: 將檔案移動到其他資料夾

**操作流程**:

```
用戶點擊「移動文件目錄」
    │
    ▼
┌─────────────────────┐
│ 顯示樹狀選擇器      │
│ - 選擇目標資料夾    │
└─────────────────────┘
    │
    ▼
用戶選擇目標
    │
    ▼
PUT /api/v1/files/{file_id}/move
    │
    ▼
┌─────────────────────┐
│ 成功: 刷新文件樹    │
└─────────────────────┘
```

**API**: `PUT /api/v1/files/{file_id}/move`

**請求**:

```json
{
  "target_folder_id": "目標資料夾ID"
}
```

---

#### 3.2.3 複製 (Copy)

**功能描述**: 複製檔案到剪貼簿

**操作流程**: 同「資料夾剪下」，但 type 為 "file"

**限制**:

- 複製多個檔案時，支援批量操作
- 剪貼簿可存多個檔案

---

#### 3.2.4 複製路徑 (Copy Path)

**功能描述**: 複製檔案的 S3 存儲路徑

**操作流程**:

```
用戶點擊「複製路徑」
    │
    ▼
讀取路徑格式: s3://bucket-ai-box-assets/tasks/{task_id}/{file_id}.{ext}
    │
    ▼
複製到剪貼簿
    │
    ▼
顯示 Toast: "路徑已複製"
```

**路徑格式**:

```
s3://bucket-ai-box-assets/tasks/1768995433434/e8b8a7ee-6cf7-43c6-8f5d-e7962f05d860.md
```

---

#### 3.2.5 剪下 (Cut)

**功能描述**: 剪切檔案到剪貼簿

**操作流程**: 同「資料夾剪下」

---

#### 3.2.6 貼上 (Paste)

**功能描述**: 將剪下/複製的檔案貼上到當前資料夾

**操作流程**: 同「資料夾貼上」

---

#### 3.2.7 使用 IEE 編輯器打開 (Open with IEE Editor)

**功能描述**: 在 IEE 編輯器中打開檔案進行編輯

**⚠️ 需要確認**:

- IEE 編輯器的具體名稱和接入方式？
- 是否需要新開分頁或在新視窗打開？
- 編輯後是否自動同步回 S3？

**預期流程**:

```
用戶點擊「使用 IEE 編輯器打開」
    │
    ▼
┌─────────────────────┐
│ 生成編輯器 URL      │
│ /editor?file_id=xxx │
└─────────────────────┘
    │
    ▼
新開分頁或視窗
```

---

#### 3.2.8 標註到任務指令區 (Add to Task Instructions)

**功能描述**: 將檔案內容引用到任務指令區

**⚠️ 需要確認**:

- 具體是標註檔案連結還是檔案內容？
- 目標區域是「任務指令區」的哪個部分？
- 是否需要彈出確認對話框？

**預期流程**:

```
用戶點擊「標註到任務指令區」
    │
    ▼
┌─────────────────────┐
│ 顯示選項            │
│ [引用連結]          │
│ [引用摘要]          │
│ [引用全文]          │
└─────────────────────┘
    │
    ▼
用戶選擇
    │
    ▼
添加到任務指令區
```

---

#### 3.2.9 查看向量資料 (View Vector Data)

**功能描述**: 顯示檔案的向量嵌入數據

**⚠️ 需要確認**:

- 向量數據量大，是否只顯示摘要？
- 是否需要可視化展示？
- 從 Qdrant 還是其他地方獲取？

**預期 UI**:

```
┌─────────────────────────┐
│ 向量資料                │
├─────────────────────────┤
│ 維度: 1024              │
│ 狀態: 已向量化 ✅        │
│                          │
│ [查看原始向量數據]      │
│ [查看相似文件]          │
└─────────────────────────┘
```

**API**: `GET /api/v1/files/{file_id}/vectors`

---

#### 3.2.10 查看圖譜資料 (View Graph Data)

**功能描述**: 顯示檔案關聯的知識圖譜數據

**⚠️ 需要確認**:

- 顯示哪些圖譜類型（實體、關係、屬性）？
- 是否需要圖譜可視化？
- 從 ArangoDB 哪個 collection 獲取？

**預期 UI**:

```
┌─────────────────────────┐
│ 圖譜資料                │
├─────────────────────────┤
│ 實體數量: 15            │
│ 關係數量: 23            │
│                          │
│ [查看實體列表]          │
│ [查看關係圖]            │
│ [查看圖譜可視化]        │
└─────────────────────────┘
```

**API**: `GET /api/v1/files/{file_id}/graph`

---

#### 3.2.11 查看文件信息 (View File Info)

**功能描述**: 顯示檔案的完整元數據

**UI 顯示內容**:

```
┌─────────────────────────┐
│ 檔案資訊                │
├─────────────────────────┤
│ 名稱: 檔案名稱.md        │
│ ID: e8b8a7ee-...        │
│ 大小: 12.5 KB            │
│ 類型: markdown           │
│ 狀態: 已處理完成         │
│                          │
│ 向量化: ✅ 完成          │
│ 知識圖譜: ⏳ 處理中      │
│                          │
│ 創建: 2026-01-21 12:00   │
│ 更新: 2026-01-21 12:30   │
│                          │
│ [設置權限]              │
│ [下載]                  │
└─────────────────────────┘
```

**API**: `GET /api/v1/files/{file_id}`

---

#### 3.2.12 設置權限 (Set Permissions)

**功能描述**: 設置檔案的訪問權限

**⚠️ 需要確認**:

- 權限設置的具體選項有哪些？
- 支援哪些權限級別（私有、團隊、公開）？
- 是否支援具體用戶授權？

**預期 UI**:

```
┌─────────────────────────┐
│ 設置權限                │
├─────────────────────────┤
│ 可見性:                 │
│ [●] 私人 - 僅自己       │
│ [ ] 團隊 - 團隊成員     │
│ [ ] 公開 - 所有人       │
│                          │
│ 數據分類:               │
│ [●] 內部               │
│ [ ] 機密               │
│ [ ] 高度機密            │
│                          │
│ [取消] [儲存]           │
└─────────────────────────┘
```

**API**: `PUT /api/v1/files/{file_id}/permissions`

**請求**:

```json
{
  "visibility": "private",
  "data_classification": "internal",
  "sharing_enabled": false
}
```

---

#### 3.2.13 刪除文件 (Delete File)

**功能描述**: 刪除檔案及所有關聯數據

**操作流程**:

```
用戶點擊「刪除文件」
    │
    ▼
┌─────────────────────┐
│ 顯示確認對話框      │
│ 「確定要刪除嗎？」  │
│ [取消] [刪除]       │
└─────────────────────┘
    │
    ▼
用戶確認
    │
    ▼
┌─────────────────────┐
│ 刪除內容            │
│ - file_metadata     │
│ - Qdrant 向量       │
│ - S3 檔案           │
│ - 知識圖譜 (可選)   │
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 成功: 刷新文件樹    │
└─────────────────────┘
```

**⚠️ 需要確認**:

- 是否同時刪除關聯的知識圖譜數據？
- 刪除後是否支援復原？

**API**: `DELETE /api/v1/files/{file_id}`

---

#### 3.2.14 重新上傳文件 (Re-upload File)

**功能描述**: 用新版本替換現有檔案

**⚠️ 需要確認**:

- 是否保留版本歷史？
- 新版本是否自動重新向量化？
- 如何處理權限繼承？

**操作流程**:

```
用戶點擊「重新上傳文件」
    │
    ▼
┌─────────────────────┐
│ 顯示上傳對話框      │
│ - 選擇新檔案        │
│ - 版本說明（可選）  │
└─────────────────────┘
    │
    ▼
POST /api/v1/files/upload
    │
    ▼
┌─────────────────────┐
│ 成功:               │
│ - 更新 file_metadata│
│ - 重新向量化        │
│ - 刷新文件樹        │
└─────────────────────┘
```

---

## 4. 待確認問題

### 4.1 檔案功能

| 項目 | 問題 |
|------|------|
| IEE 編輯器 | 具體接入方式和 URL 格式？ |
| 標註到任務指令區 | 目標區域和引用格式？ |
| 查看向量資料 | 顯示內容和可視化需求？ |
| 查看圖譜資料 | 圖譜數據結構和可視化需求？ |
| 設置權限 | 具體權限選項？ |
| 重新上傳 | 版本歷史策略？ |

### 4.2 其他

| 項目 | 問題 |
|------|------|
| 批量操作 | 是否支援多選批量刪除/移動？ |
| 拖曳操作 | 是否支援拖曳移動？ |
| 快捷鍵 | 是否需要快捷鍵支援？ |

---

## 5. API 端點總表（新增）

| Method | Endpoint | 說明 |
|--------|----------|------|
| PUT | /api/v1/folders/{id}/move | 移動資料夾 |
| PUT | /api/v1/files/{id}/move | 移動檔案 |
| PUT | /api/v1/files/{id}/permissions | 設置權限 |
| GET | /api/v1/files/{id}/vectors | 查看向量 |
| GET | /api/v1/files/{id}/graph | 查看圖譜 |
| PUT | /api/v1/files/{id}/rename | 重新命名 |

---

**文件版本**: v1.0
**最後更新日期**: 2026-01-21
**維護人**: Daniel Chung
