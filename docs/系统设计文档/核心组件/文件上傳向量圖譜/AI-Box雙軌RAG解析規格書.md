# AI-Box é›™è»Œ RAG è§£æè¦æ ¼æ›¸

**ä»£ç¢¼åŠŸèƒ½èªªæ˜**: AI-Box é›™è»Œä¸¦è¡Œè§£ææ¶æ§‹è¦æ ¼æ›¸ - å·¥æ¥­ç´šç²¾æº–åº¦ RAG è§£ææ–¹æ¡ˆ
**å‰µå»ºæ—¥æœŸ**: 2026-01-21 15:00 UTC+8
**å‰µå»ºäºº**: Daniel Chung
**æœ€å¾Œä¿®æ”¹æ—¥æœŸ**: 2026-01-21 16:00 UTC+8

---

## ğŸ“‹ æ–‡æª”ä¿¡æ¯

- **ç‰ˆæœ¬**: v1.0
- **ç‹€æ…‹**: è‰æ¡ˆï¼ˆDraftï¼‰
- **é©ç”¨ç¯„åœ**: AI-Box æ–‡ä»¶ä¸Šå‚³èˆ‡å‘é‡åŒ–ç³»çµ±
- **ç›¸é—œæ–‡æª”**:
  - [ä¸Šå‚³çš„åŠŸèƒ½æ¶æ§‹èªªæ˜-v4.0.md](./ä¸Šå‚³çš„åŠŸèƒ½æ¶æ§‹èªªæ˜-v4.0.md)
  - [å‘é‡åŒ–é‚è¼¯æª¢æŸ¥å ±å‘Š.md](../IEEå°è©±å¼é–‹ç™¼æ–‡ä»¶ç·¨è¼¯/å‘é‡åŒ–é‚è¼¯æª¢æŸ¥å ±å‘Š.md)

---

## ğŸ›  AI-Box é›™è»Œ RAG è§£æè¦æ ¼æ›¸

### æ¦‚è¿°

é‡å° **AI-Box** å°ˆæ¡ˆï¼Œé€™ä»½è¦æ ¼æ›¸èšç„¦æ–¼ã€Œé›™è»Œä¸¦è¡Œè§£ææ¶æ§‹ã€ã€‚ç‚ºäº†ç¢ºä¿ RAG æ•ˆæœé”åˆ°å·¥æ¥­ç´šç²¾æº–åº¦ï¼Œæˆ‘å€‘å°‡ Prompt åˆ†ç‚ºä¸‰å€‹æ ¸å¿ƒ AI è§’è‰²ï¼š **æ–‡æ„æ‘˜è¦å“¡ (LLM)** ã€**è¦–è¦ºè§£æå“¡ (VLM)** ä»¥åŠ  **Contextual Header æ•´åˆå“¡ (LLM)** ã€‚

### 1. æ ¸å¿ƒæµç¨‹èˆ‡ AI è§’è‰²åˆ†é…

æ ¹æ“šæ¶æ§‹è¨­è¨ˆï¼Œå®šç¾©ä»¥ä¸‹ä»»å‹™èˆ‡å°æ‡‰æ¨¡å‹ï¼š

| **ä»»å‹™éšæ®µ**                | **AI è§’è‰²** | **æ¨è–¦æ¨¡å‹**                      | **MoE å ´æ™¯**         | **æ ¸å¿ƒç›®æ¨™**                                    |
| --------------------------------- | ----------------- | --------------------------------------- | -------------------------- | ----------------------------------------------------- |
| **Stage 1: åŸºç¤ç´¢å¼•**       | å¿«é€Ÿå‘é‡åŒ–        | `bge-m3` / `qwen3-embedding`        | `embedding`              | å¿«é€Ÿå®ŒæˆåŸºç¤å‘é‡ç´¢å¼•ï¼Œæä¾›å³æ™‚æª¢ç´¢èƒ½åŠ›ã€‚              |
| **Stage 2: æ–‡æ„æå–**       | èªæ„æ‘˜è¦å“¡        | `qwen3-vl`                            | `semantic_understanding` | æå–å…¨æ–‡è„ˆçµ¡ï¼Œç”Ÿæˆå…¨å±€èƒŒæ™¯ï¼ˆGlobal Contextï¼‰ã€‚        |
| **Stage 2: åœ–ç‰‡/åœ–è¡¨è™•ç†**  | è¦–è¦ºè§£æå“¡        | `qwen3-vl`                            | `vision` (æ–°å¢)          | å°‡åœ–è¡¨è½‰ç‚º Markdown æ•¸æ“šï¼Œå°‡åœ–ç‰‡è½‰ç‚ºèªæ„æè¿°ã€‚        |
| **Stage 2: æ ¸å¿ƒé—œè¯èˆ‡æ›´æ–°** | æ•´åˆå°è£å“¡        | `qwen3-vl`                            | `semantic_understanding` | ç”Ÿæˆ Contextual Headerï¼Œç¢ºä¿ Chunk å…·å‚™ç¨ç«‹ç†è§£èƒ½åŠ›ã€‚ |

**é›™è»Œæ¶æ§‹èªªæ˜**:

- **Stage 1ï¼ˆå¿«é€Ÿè»Œï¼‰**: ä½¿ç”¨ Embedding æ¨¡å‹å¿«é€Ÿç”ŸæˆåŸºç¤å‘é‡ï¼Œç«‹å³æä¾›æª¢ç´¢èƒ½åŠ›
- **Stage 2ï¼ˆæ·±åº¦è»Œï¼‰**: ä½¿ç”¨ LLM + VLM é€²è¡Œæ·±åº¦ç†è§£ï¼Œç”Ÿæˆæ‘˜è¦å’Œ Contextual Headerï¼Œå¾ŒçºŒæ›´æ–° Metadata

![1768978689363](image/çµæ§‹RAGè©³ç´°è¦æ ¼/1768978689363.png)

---

### 2. AI Prompt è¦æ ¼æŒ‡ä»¤é›†

#### ğŸ“ Prompt Aï¼šèªæ„æ‘˜è¦å“¡ (å…¨æ–‡èƒŒæ™¯æå–)

- **ç›®æ¨™** ï¼šç‚ºæ•´ä»½æ–‡ä»¶ç”Ÿæˆä¸€å€‹å¼·å¤§çš„ã€Œå…¨å±€éŒ¨é»ã€ï¼Œé˜²æ­¢å¾ŒçºŒåˆ‡å‰²å¾Œæ–·ç« å–ç¾©ã€‚
- **æŒ‡ä»¤å…§å®¹** ï¼š

> ã€Œä½ ç¾åœ¨æ˜¯ä¸€åå°ˆæ¥­çš„æ–‡ä»¶æ¶æ§‹åˆ†æå¸«ã€‚è«‹é–±è®€é€™ä»½æ–‡ä»¶ï¼Œä¸¦å®Œæˆä»¥ä¸‹ä»»å‹™ï¼š
>
> 1. **ä¸»é¡Œå®šç¾©** ï¼šç”¨ä¸€å¥è©±æ¦‚æ‹¬é€™ä»½æ–‡ä»¶çš„æ ¸å¿ƒä¸»é¡Œï¼ˆä¾‹å¦‚ï¼šåœ‹ç¿æ©Ÿæ¢°ç†±è§£çˆæ“ä½œæ‰‹å†Šï¼‰ã€‚
> 2. **çµæ§‹å¤§ç¶±** ï¼šåˆ—å‡ºæ–‡ä»¶ä¸»è¦ç« ç¯€èˆ‡å°æ‡‰çš„æ ¸å¿ƒé‚è¼¯ã€‚
> 3. **é—œéµè¡“èª** ï¼šæå– 5-10 å€‹è²«ç©¿å…¨æ–‡çš„æ ¸å¿ƒæŠ€è¡“è¡“èªã€‚
> 4. **ç›®æ¨™å—çœ¾** ï¼šåˆ¤æ–·æ­¤æ–‡ä»¶æ˜¯çµ¦æŠ€è¡“å“¡ã€æŠ•è³‡äººé‚„æ˜¯ä¸€èˆ¬ç”¨æˆ¶çœ‹çš„ã€‚
>
> **è¼¸å‡ºæ ¼å¼** ï¼šè«‹ä½¿ç”¨ JSON æ ¼å¼è¼¸å‡ºï¼Œä»¥ä¾¿å¾ŒçºŒç¨‹å¼èª¿ç”¨ã€‚ã€

#### ğŸ‘ï¸ Prompt Bï¼šè¦–è¦ºè§£æå“¡ (åœ–è¡¨/åœ–ç‰‡/è¡¨æ ¼è½‰æ–‡å­—)

- **ç›®æ¨™** ï¼šå°‡éæ–‡å­—è³‡è¨Šã€Œç„¡æã€è½‰åŒ–ç‚ºæ–‡å­—å‘é‡ã€‚
- **æŒ‡ä»¤å…§å®¹** ï¼š

> ã€Œä½ ç¾åœ¨æ˜¯ä¸€åè¦–è¦ºæ•¸æ“šè§£æå°ˆå®¶ã€‚è«‹åˆ†æé€™å¼µåœ–ç‰‡ä¸¦åˆ¤æ–·å…¶é¡å‹ï¼š
>
> - **è‹¥ç‚ºè¡¨æ ¼** ï¼šè«‹ç²¾ç¢ºé‚„åŸç‚º Markdown æ ¼å¼ï¼Œç¢ºä¿è¡Œåˆ—å°é½Šï¼Œä¸è¦éºæ¼ä»»ä½•æ•¸æ“šã€‚
> - **è‹¥ç‚ºæŠ€è¡“åœ–è¡¨ (å¦‚æ›²ç·šã€æµç¨‹åœ–)** ï¼šè«‹æè¿° X/Y è»¸å«ç¾©ã€è¶¨å‹¢è®ŠåŒ–ï¼ˆä¸Šå‡/ä¸‹é™/å¹³ç©©ï¼‰ä»¥åŠé—œéµæ•¸æ“šé»ã€‚
> - **è‹¥ç‚ºç”¢å“åœ–ç‰‡** ï¼šè«‹æè¿°ä¸»é«”ç‰¹å¾µã€çµ„æˆé›¶ä»¶ä»¥åŠå…¶åœ¨æ–‡ä»¶ä¸­çš„æ½›åœ¨åŠŸèƒ½ã€‚
>
> **æ³¨æ„** ï¼šè¼¸å‡ºå¿…é ˆåŒ…å«è©²åœ–ç‰‡åœ¨æ–‡ä»¶ä¸­å¯èƒ½é—œè¯çš„æŠ€è¡“è¡“èªã€‚ã€

#### ğŸ”— Prompt Cï¼šContextual Header æ•´åˆå“¡ (ç”Ÿæˆ Chunk å‰ç¶´)

- **ç›®æ¨™** ï¼šé€™æ˜¯è§£æ±ºã€Œæ–‡æ„ä¸å®Œæ•´ã€çš„çµ‚æ¥µæ–¹æ¡ˆã€‚å°‡å…¨å±€æ‘˜è¦èˆ‡å±€éƒ¨æ®µè½èåˆã€‚
- **æŒ‡ä»¤å…§å®¹** ï¼š

> ã€Œä½ ç¾åœ¨è² è²¬ç”Ÿæˆ RAG æª¢ç´¢å‰ç¶´ã€‚
>
> è¼¸å…¥æ•¸æ“šï¼š
>
> - å…¨å±€èƒŒæ™¯ï¼š{{Global_Context}}
> - ç•¶å‰ç›®éŒ„è·¯å¾‘ï¼š{{TOC_Path}}
> - åŸå§‹æ®µè½å…§å®¹ï¼š{{Raw_Chunk_Content}}
>
> **ä»»å‹™** ï¼šè«‹ç‚ºåŸå§‹æ®µè½å¯«ä¸€æ®µ 50 å­—ä»¥å…§çš„ã€è„ˆçµ¡æ¨™é ­ (Contextual Header)ã€ï¼Œç¢ºä¿è©²æ®µè½å³ä½¿å–®ç¨è¢«æª¢ç´¢ï¼Œä¹Ÿèƒ½è®“ AI çŸ¥é“å®ƒæ˜¯é—œæ–¼ä»€éº¼ã€åœ¨å“ªå€‹ç« ç¯€ã€‚
>
> è¼¸å‡ºç¯„ä¾‹ï¼š
>
> ã€[èƒŒæ™¯ï¼šåœ‹ç¿æ©Ÿæ¢°ç†±è§£çˆèªªæ˜æ›¸ > ç¶­è­·æ‰‹å†Š > é›†å¡µå™¨æ¸…ç†] æœ¬æ®µè½èªªæ˜é›†å¡µå™¨çš„æ¸…ç†é »ç‡èˆ‡æ³¨æ„äº‹é …ï¼š...ã€ã€

---

### 3. æ•¸æ“šå„²å­˜è¦æ ¼ (Qdrant Payload Schema)

ç‚ºäº†é…åˆ **Qdrant** ä¿å­˜éœ€æ±‚ï¼Œæ¯å€‹ Point çš„ Payload å»ºè­°åŒ…å«ä»¥ä¸‹æ¬„ä½ï¼š

**ç•¶å‰å¯¦ç¾** (`services/api/services/qdrant_vector_store_service.py`):

```python
payload = {
    "file_id": file_id,
    "chunk_index": chunk.get("chunk_index", i),
    "chunk_text": chunk.get("text", "")[:200],  # å‰200å­—ç¬¦
    # ... å…¶ä»– metadata
}
```

**é›™è»Œ RAG å¢å¼·å¾Œçš„ Payload Schema**:

```json
{
  "file_id": "UUID",
  "chunk_index": "Integer",
  "chunk_text": "String (å‰200å­—ç¬¦ï¼Œç”¨æ–¼ç´¢å¼•)",
  "raw_text": "String (å®Œæ•´åŸå§‹æ–‡æœ¬)",
  "page_number": "Integer (å¯é¸)",
  "toc_path": "Chapter 1 > Section 2 (å¯é¸)",
  "content_type": "text | table | chart | image",
  "global_summary": "String (From Prompt A - å¯é¸)",
  "contextual_header": "String (From Prompt C - å¯é¸)",
  "image_description": "String (From Prompt B - å¯é¸)",
  "header_path": ["Chapter 1", "Section 1.1"] (å¯é¸ï¼ŒAST_DRIVEN ç­–ç•¥),
  "strategy": "summary_guided | ast_driven | semantic",
  "user_id": "String (å¯é¸)"
}
```

**å¯¦æ–½è¦é»**:

- âœ… **å‘å¾Œå…¼å®¹**: ä¿ç•™ç¾æœ‰çš„ `file_id`, `chunk_index`, `chunk_text` å­—æ®µ
- âœ… **å¯é¸å¢å¼·**: `global_summary`, `contextual_header` ç­‰å­—æ®µç‚ºå¯é¸ï¼Œä¸å½±éŸ¿ç¾æœ‰åŠŸèƒ½
- âœ… **æ¼¸é€²å¼æ›´æ–°**: Stage 2 å®Œæˆå¾Œï¼Œä½¿ç”¨ Qdrant `upsert` æ›´æ–° Payload

---

### 4. é‡å° AI-Box çš„å¯¦æ–½å»ºè­°

#### 4.1 éåŒæ­¥å„ªå…ˆç´šç­–ç•¥

**Stage 1ï¼ˆå¿«é€Ÿè»Œï¼‰**:

- ä½¿ç”¨ç¾æœ‰çš„ `EmbeddingService` å¿«é€Ÿç”Ÿæˆå‘é‡
- ç«‹å³å­˜å„²åˆ° Qdrantï¼Œæä¾›åŸºç¤æª¢ç´¢èƒ½åŠ›
- å¯¦ç¾ä½ç½®: `api/routers/file_upload.py` - `process_file_chunking_and_vectorization()`

**Stage 2ï¼ˆæ·±åº¦è»Œï¼‰**:

- åœ¨èƒŒæ™¯ä»»å‹™ä¸­åŸ·è¡Œï¼ˆä½¿ç”¨ RQ éšŠåˆ—ï¼‰
- å®Œæˆå¾Œä½¿ç”¨ Qdrant `upsert` æ›´æ–° Payloadï¼ˆæ·»åŠ  `global_summary`, `contextual_header` ç­‰ï¼‰
- ä¸å½±éŸ¿ Stage 1 çš„æª¢ç´¢åŠŸèƒ½

#### 4.2 çª—å£è¦åŠƒ

| Prompt                          | æ¨¡å‹      | Context Window | èªªæ˜                                                         |
| ------------------------------- | --------- | -------------- | ------------------------------------------------------------ |
| **Prompt A (èªæ„æ‘˜è¦å“¡)** | `qwen3-vl` | 32K            | éœ€å®¹ç´é•·æ–‡ä»¶ï¼Œä½¿ç”¨ `semantic_understanding` å ´æ™¯           |
| **Prompt B (è¦–è¦ºè§£æå“¡)** | `qwen3-vl` | 32K            | åœ–ç‰‡è§£æï¼Œä½¿ç”¨ `vision` å ´æ™¯                                 |
| **Prompt C (æ•´åˆå°è£å“¡)** | `qwen3-vl` | 32K            | ç”Ÿæˆ Contextual Headerï¼Œä½¿ç”¨ `semantic_understanding` å ´æ™¯ |

#### 4.3 éŒ¯èª¤å›é€€ (Fallback)

- **VLM è§£æå¤±æ•—**: åœ¨ Payload æ¨™è¨» `vlm_error: true`ï¼Œåƒ…ä¿ç•™æ–‡å­— OCR çµæœ
- **LLM æ‘˜è¦å¤±æ•—**: æ¨™è¨» `summary_error: true`ï¼Œä½¿ç”¨åŸºç¤åˆ†å¡Šç­–ç•¥
- **ç¢ºä¿æª¢ç´¢ä¸æ–·éˆ**: å³ä½¿ Stage 2 å¤±æ•—ï¼ŒStage 1 çš„åŸºç¤å‘é‡ä»å¯æ­£å¸¸æª¢ç´¢

---

## 5. èˆ‡ç¾æœ‰ç³»çµ±çš„æ•´åˆåˆ†æ

### 5.1 ç¾æœ‰ç³»çµ±æ¶æ§‹åˆ†æ

#### 5.1.1 å·²å¯¦ç¾åŠŸèƒ½ âœ…

| åŠŸèƒ½                      | å¯¦ç¾ä½ç½®                                                                   | ç‹€æ…‹          | èªªæ˜                                     |
| ------------------------- | -------------------------------------------------------------------------- | ------------- | ---------------------------------------- |
| **MoE ç³»çµ±**        | `llm/moe/moe_manager.py`                                                 | âœ… å®Œæ•´å¯¦ç¾   | æ”¯æŒå¤šå ´æ™¯è·¯ç”±ï¼Œå¯ç›´æ¥ä½¿ç”¨               |
| **å ´æ™¯è·¯ç”±**        | `llm/moe/scene_routing.py`                                               | âœ… æ”¯æŒå¤šå ´æ™¯ | å·²æœ‰ `semantic_understanding` å ´æ™¯     |
| **æ–‡ä»¶æ‘˜è¦ç”Ÿæˆ**    | `api/routers/file_upload.py` - `_generate_file_summary_for_metadata()` | âœ… å·²å¯¦ç¾     | éœ€å¢å¼·ä»¥ç¬¦åˆ Prompt A è¦æ ¼               |
| **è¦–è¦ºæ¨¡å‹å®¢æˆ¶ç«¯**  | `llm/clients/ollama_vision.py`                                           | âœ… å·²å¯¦ç¾     | æ”¯æŒ `qwen3-vl`ï¼Œå¯ç›´æ¥ä½¿ç”¨             |
| **åˆ†å¡Šè™•ç†å™¨**      | `services/api/processors/chunk_processor.py`                             | âœ… å¤šç¨®ç­–ç•¥   | æ”¯æŒ `AST_DRIVEN`ã€`SEMANTIC` ç­‰ç­–ç•¥ |
| **Qdrant å‘é‡å­˜å„²** | `services/api/services/qdrant_vector_store_service.py`                   | âœ… å·²é·ç§»     | æ”¯æŒ `upsert` æ›´æ–° Payload             |

#### 5.1.2 éœ€è¦æ–°å¢åŠŸèƒ½ âš ï¸

| åŠŸèƒ½                             | èªªæ˜                              | å„ªå…ˆç´š | ä¾è³´            |
| -------------------------------- | --------------------------------- | ------ | --------------- |
| **Contextual Header ç”Ÿæˆ** | å¯¦ç¾ Prompt C é‚è¼¯                | ğŸ”´ é«˜  | MoE ç³»çµ±        |
| **é›™è»Œè™•ç†æµç¨‹**           | Stage 1 + Stage 2 åˆ†é›¢            | ğŸ”´ é«˜  | RQ éšŠåˆ—ç³»çµ±     |
| **Payload æ›´æ–°æ©Ÿåˆ¶**       | Stage 2 å®Œæˆå¾Œæ›´æ–° Qdrant Payload | ğŸ”´ é«˜  | Qdrant å‘é‡å­˜å„² |
| **Vision å ´æ™¯é…ç½®**        | åœ¨ MoE ä¸­æ·»åŠ  `vision` å ´æ™¯     | ğŸŸ¡ ä¸­  | MoE é…ç½®ç³»çµ±    |

### 5.2 æ•´åˆå¯è¡Œæ€§è©•ä¼°

#### 5.2.1 æŠ€è¡“å¯è¡Œæ€§ âœ…

| è©•ä¼°é …                        | å¯è¡Œæ€§ | èªªæ˜                                                     |
| ----------------------------- | ------ | -------------------------------------------------------- |
| **MoE ç³»çµ±æ•´åˆ**        | âœ… é«˜  | ç¾æœ‰ MoE ç³»çµ±å®Œå…¨æ”¯æŒï¼Œåªéœ€æ·»åŠ å ´æ™¯é…ç½®                  |
| **è¦–è¦ºæ¨¡å‹æ•´åˆ**        | âœ… é«˜  | å·²æœ‰ `OllamaVisionClient`ï¼Œå¯ç›´æ¥ä½¿ç”¨                  |
| **æ‘˜è¦ç”Ÿæˆæ•´åˆ**        | âœ… é«˜  | å·²æœ‰ `_generate_file_summary_for_metadata()`ï¼Œåªéœ€å¢å¼· |
| **Qdrant Payload æ›´æ–°** | âœ… é«˜  | Qdrant æ”¯æŒ `upsert`ï¼Œå¯æ›´æ–° Payload                   |
| **é›™è»Œè™•ç†æµç¨‹**        | âœ… é«˜  | ç¾æœ‰ RQ éšŠåˆ—ç³»çµ±å®Œå…¨æ”¯æŒèƒŒæ™¯ä»»å‹™                         |

#### 5.2.2 æ¶æ§‹å…¼å®¹æ€§ âœ…

| è©•ä¼°é …                  | å…¼å®¹æ€§  | èªªæ˜                                 |
| ----------------------- | ------- | ------------------------------------ |
| **ç¾æœ‰åˆ†å¡Šç­–ç•¥**  | âœ… å…¼å®¹ | å¯èˆ‡ç¾æœ‰ `ChunkProcessor` ç­–ç•¥ä¸¦å­˜ |
| **ç¾æœ‰å‘é‡å­˜å„²**  | âœ… å…¼å®¹ | ä¸å½±éŸ¿ç¾æœ‰ Qdrant å­˜å„²é‚è¼¯           |
| **ç¾æœ‰ API æ¥å£** | âœ… å…¼å®¹ | ä¸å½±éŸ¿ç¾æœ‰ APIï¼Œåƒ…å¢å¼·å…§éƒ¨è™•ç†       |
| **ç¾æœ‰å‰ç«¯é¡¯ç¤º**  | âœ… å…¼å®¹ | å‰ç«¯ç„¡éœ€ä¿®æ”¹ï¼Œå¾Œç«¯è‡ªå‹•å¢å¼·           |

#### 5.2.3 æ€§èƒ½å½±éŸ¿è©•ä¼° âš ï¸

| è©•ä¼°é …                     | å½±éŸ¿              | ç·©è§£æ–¹æ¡ˆ                          |
| -------------------------- | ----------------- | --------------------------------- |
| **Stage 1 å»¶é²**     | âœ… ç„¡å½±éŸ¿         | Stage 1 ä¿æŒç¾æœ‰é€Ÿåº¦              |
| **Stage 2 è™•ç†æ™‚é–“** | âš ï¸ å¢åŠ  30-60ç§’ | èƒŒæ™¯ä»»å‹™ï¼Œä¸å½±éŸ¿ç”¨æˆ¶é«”é©—          |
| **LLM èª¿ç”¨æˆæœ¬**     | âš ï¸ å¢åŠ          | å¯é…ç½®é–‹é—œï¼ŒæŒ‰éœ€å•Ÿç”¨              |
| **å­˜å„²ç©ºé–“**         | âœ… å½±éŸ¿å°         | Payload å¢åŠ ç´„ 200-500 å­—ç¬¦/chunk |

#### 5.2.4 å¯¦æ–½é¢¨éšªè©•ä¼°

| é¢¨éšª                       | ç­‰ç´š  | ç·©è§£æ–¹æ¡ˆ                            |
| -------------------------- | ----- | ----------------------------------- |
| **LLM èª¿ç”¨å¤±æ•—**     | ğŸŸ¡ ä¸­ | Fallback æ©Ÿåˆ¶ï¼Œæ¨™è¨»éŒ¯èª¤ä½†ä¸å½±éŸ¿æª¢ç´¢ |
| **VLM èª¿ç”¨å¤±æ•—**     | ğŸŸ¡ ä¸­ | æ¨™è¨» `vlm_error`ï¼Œä¿ç•™æ–‡å­— OCR    |
| **Payload æ›´æ–°å¤±æ•—** | ğŸŸ¢ ä½ | é‡è©¦æ©Ÿåˆ¶ï¼Œä¸å½±éŸ¿ Stage 1 åŠŸèƒ½       |
| **æ€§èƒ½ä¸‹é™**         | ğŸŸ¡ ä¸­ | å¯é…ç½®é–‹é—œï¼Œç”Ÿç”¢ç’°å¢ƒå¯é¸æ“‡æ€§å•Ÿç”¨    |

**è©³ç´°å¯¦æ–½æ–¹æ¡ˆè«‹åƒé–±**: [AI-Box é›™è»Œ RAG è§£æå¯¦æ–½è¨ˆåŠƒæ›¸](./AI-Box%20é›™è»Œ%20RAG%20è§£æå¯¦æ–½è¨ˆåŠƒæ›¸.md)

---

## 8. é…ç½®å»ºè­°

### 8.1 MoE å ´æ™¯é…ç½®

```json
{
  "services": {
    "moe": {
      "model_priority": {
        "semantic_understanding": [
          {
            "model": "qwen3-vl",
            "context_size": 32768,
            "temperature": 0.3,
            "timeout": 60
          }
        ],
        "vision": [
          {
            "model": "qwen3-vl",
            "context_size": 32768,
            "temperature": 0.2,
            "timeout": 120
          }
        ]
      }
    }
  }
}
```

### 8.2 é›™è»Œè™•ç†é…ç½®

```json
{
  "chunk_processing": {
    "dual_track": {
      "enabled": true,
      "stage1_strategy": "semantic",  // å¿«é€Ÿè»Œç­–ç•¥
      "stage2_enabled": true,  // æ˜¯å¦å•Ÿç”¨æ·±åº¦è»Œ
      "stage2_delay_seconds": 0,  // Stage 2 å»¶é²å•Ÿå‹•ï¼ˆ0 = ç«‹å³ï¼‰
      "update_payload_on_complete": true,  // Stage 2 å®Œæˆå¾Œæ›´æ–° Payload
      "fallback_on_error": true  // éŒ¯èª¤æ™‚å›é€€åˆ°åŸºç¤åŠŸèƒ½
    }
  }
}
```

---

## 9. é æœŸæ•ˆæœ

### 9.1 åŠŸèƒ½å¢å¼·

- âœ… **æª¢ç´¢ç²¾åº¦æå‡**: Contextual Header æä¾›æ›´å¤šä¸Šä¸‹æ–‡ï¼Œæå‡æª¢ç´¢ç›¸é—œæ€§
- âœ… **åœ–ç‰‡ç†è§£**: å®Œæ•´çš„åœ–ç‰‡å’Œè¡¨æ ¼ç†è§£èƒ½åŠ›
- âœ… **æ–‡æª”çµæ§‹ä¿ç•™**: å…¨å±€æ‘˜è¦å’Œ TOC è·¯å¾‘ä¿ç•™æ–‡æª”çµæ§‹

### 9.2 æ€§èƒ½æŒ‡æ¨™

| æŒ‡æ¨™                       | ç•¶å‰    | æ”¹é€²å¾Œ   | èªªæ˜                   |
| -------------------------- | ------- | -------- | ---------------------- |
| **é¦–æ¬¡æª¢ç´¢å¯ç”¨æ™‚é–“** | 30-60ç§’ | 30-60ç§’  | Stage 1 ä¿æŒä¸è®Š       |
| **æª¢ç´¢ç²¾åº¦**         | åŸºæº–    | +10-20%  | Contextual Header å¢å¼· |
| **åœ–ç‰‡ç†è§£**         | âŒ ç„¡   | âœ… å®Œæ•´  | æ–°å¢åŠŸèƒ½               |
| **è™•ç†ç¸½æ™‚é–“**       | 30-60ç§’ | 60-120ç§’ | Stage 2 èƒŒæ™¯è™•ç†       |

---

## 6. ç›¸é—œæ–‡æª”

- [AI-Boxé›™è»ŒRAGè§£æå¯¦æ–½è¨ˆåŠƒæ›¸](./AI-Boxé›™è»ŒRAGè§£æå¯¦æ–½è¨ˆåŠƒæ›¸.md) - è©³ç´°å¯¦æ–½æ–¹æ¡ˆå’Œé€²åº¦ç®¡æ§è¡¨
- [ä¸Šå‚³çš„åŠŸèƒ½æ¶æ§‹èªªæ˜-v4.0.md](./ä¸Šå‚³çš„åŠŸèƒ½æ¶æ§‹èªªæ˜-v4.0.md) - æ–‡ä»¶ä¸Šå‚³å®Œæ•´æ¶æ§‹
- [å‘é‡åŒ–é‚è¼¯æª¢æŸ¥å ±å‘Š.md](../IEEå°è©±å¼é–‹ç™¼æ–‡ä»¶ç·¨è¼¯/å‘é‡åŒ–é‚è¼¯æª¢æŸ¥å ±å‘Š.md) - å‘é‡åŒ–æµç¨‹åˆ†æ

---

## 7. æ›´æ–°è¨˜éŒ„

| æ—¥æœŸ       | ç‰ˆæœ¬ | è®Šæ›´å…§å®¹                                                               |
| ---------- | ---- | ---------------------------------------------------------------------- |
| 2026-01-21 | v1.1 | æ›´æ–° MoE é…ç½®ï¼šæ¨¡å‹æ”¹ç‚º `qwen3-vl`ï¼Œä¸Šä¸‹æ–‡çª—å£æ”¹ç‚º 32K |
| 2026-01-21 | v1.0 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œå–„æ–‡ä»¶é ­è¨»é‡‹ã€å¯è¡Œæ€§åˆ†æã€æ•´åˆåˆ†æï¼›åˆ†é›¢å¯¦æ–½æ–¹æ¡ˆåˆ°ç¨ç«‹æ–‡ä»¶ |

---

**æ–‡ä»¶ç‰ˆæœ¬**: v1.1
**æœ€å¾Œæ›´æ–°æ—¥æœŸ**: 2026-01-21 16:00 UTC+8
**ç¶­è­·äºº**: Daniel Chung
