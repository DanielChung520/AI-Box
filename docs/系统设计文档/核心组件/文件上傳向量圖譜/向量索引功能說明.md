# å‘é‡ç´¢å¼•åŠŸèƒ½èªªæ˜

**å‰µå»ºæ—¥æœŸ**: 2026-01-05
**å‰µå»ºäºº**: Daniel Chung
**æœ€å¾Œä¿®æ”¹æ—¥æœŸ**: 2026-01-05

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æª”èªªæ˜ AI-Box ç³»çµ±ä¸­å‘é‡ç´¢å¼•çš„åŠŸèƒ½å’Œå¯¦ç¾æ–¹å¼ã€‚

---

## ğŸ” å‘é‡ç´¢å¼•æ˜¯ä»€éº¼ï¼Ÿ

å‘é‡ç´¢å¼•æ˜¯å°‡æ–‡æª”å…§å®¹è½‰æ›ç‚ºå‘é‡ï¼ˆembeddingï¼‰ä¸¦å­˜å„²åœ¨å‘é‡æ•¸æ“šåº«ï¼ˆChromaDBï¼‰ä¸­çš„éç¨‹ã€‚å‘é‡ç´¢å¼•å…è¨±ç³»çµ±æ ¹æ“šèªç¾©ç›¸ä¼¼åº¦é€²è¡Œæ–‡æª”æª¢ç´¢ï¼Œè€Œä¸æ˜¯åŸºæ–¼é—œéµè©åŒ¹é…ã€‚

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### 1. å‘é‡å­˜å„²å±¤ï¼ˆChromaDBï¼‰

**ä½ç½®**: `services/api/services/vector_store_service.py`

**åŠŸèƒ½**:
- ç®¡ç† ChromaDB é€£æ¥
- æä¾›å‘é‡å­˜å„²å’ŒæŸ¥è©¢æ¥å£
- æ”¯æŒæŒ‰æ–‡ä»¶ ID çµ„ç¹”é›†åˆï¼ˆ`file_based` å‘½åç­–ç•¥ï¼‰

**é›†åˆå‘½åç­–ç•¥**:
- æ¯å€‹æ–‡ä»¶å°æ‡‰ä¸€å€‹ ChromaDB é›†åˆ
- é›†åˆåç¨± = æ–‡ä»¶ IDï¼ˆ`file_id`ï¼‰
- ä¾‹å¦‚: æ–‡ä»¶ ID `f347352c-a30e-4598-b0e8-60811b949751` å°æ‡‰é›†åˆ `f347352c-a30e-4598-b0e8-60811b949751`

### 2. å‘é‡é©é…å™¨å±¤ï¼ˆChromaDBAdapterï¼‰

**ä½ç½®**: `agents/infra/memory/aam/storage_adapter.py`

**åŠŸèƒ½**:
- å°è£ ChromaDB æ“ä½œ
- æä¾›çµ±ä¸€çš„å­˜å„²æ¥å£
- è™•ç†æ–‡æª”åˆ†å¡Šå’Œå‘é‡åŒ–

**é—œéµæ–¹æ³•**:
- `store()`: å­˜å„²æ–‡æª”åˆ° ChromaDB
- `query()`: æŸ¥è©¢ç›¸ä¼¼æ–‡æª”
- `get()`: ç²å–æ–‡æª”

### 3. æª¢ç´¢æœå‹™å±¤ï¼ˆRealtimeRetrievalServiceï¼‰

**ä½ç½®**: `agents/infra/memory/aam/realtime_retrieval.py`

**åŠŸèƒ½**:
- åŸ·è¡Œå‘é‡æª¢ç´¢
- ç®¡ç†æª¢ç´¢ç·©å­˜
- æä¾›çµ±ä¸€çš„æª¢ç´¢æ¥å£

**é—œéµæ–¹æ³•**:
- `retrieve()`: åŸ·è¡Œå‘é‡æª¢ç´¢ï¼Œè¿”å›ç›¸é—œæ–‡æª”

---

## ğŸ“ å‘é‡åŒ–æµç¨‹

### 1. æ–‡ä»¶ä¸Šå‚³

ç•¶æ–‡ä»¶ä¸Šå‚³åˆ°ç³»çµ±æ™‚ï¼š
1. æ–‡ä»¶å­˜å„²åˆ°æ–‡ä»¶ç³»çµ±
2. æ–‡ä»¶å…ƒæ•¸æ“šå­˜å„²åˆ° ArangoDB (`file_metadata` é›†åˆ)
3. æ–‡ä»¶ç‹€æ…‹æ¨™è¨˜ç‚º `uploaded`

### 2. æ–‡ä»¶è™•ç†

æ–‡ä»¶è™•ç†æµç¨‹ï¼ˆç”± Worker åŸ·è¡Œï¼‰ï¼š
1. **åˆ†å¡Šï¼ˆChunkingï¼‰**: å°‡æ–‡æª”åˆ†å‰²æˆå°å¡Š
2. **å‘é‡åŒ–ï¼ˆVectorizationï¼‰**:
   - ä½¿ç”¨ Embedding æ¨¡å‹å°‡æ–‡æœ¬å¡Šè½‰æ›ç‚ºå‘é‡
   - å­˜å„²åˆ° ChromaDB å°æ‡‰çš„é›†åˆä¸­
3. **çŸ¥è­˜åœ–è­œæå–ï¼ˆKG Extractionï¼‰**: æå–å¯¦é«”å’Œé—œä¿‚ï¼Œå­˜å„²åˆ° ArangoDB

### 3. å‘é‡ç´¢å¼•æ§‹å»º

å‘é‡ç´¢å¼•åœ¨å‘é‡åŒ–éšæ®µè‡ªå‹•æ§‹å»ºï¼š
- ChromaDB è‡ªå‹•ç‚ºå‘é‡å‰µå»ºç´¢å¼•ï¼ˆHNSW ç´¢å¼•ï¼‰
- ç„¡éœ€æ‰‹å‹•æ§‹å»ºç´¢å¼•
- ç´¢å¼•éš¨å‘é‡æ•¸æ“šçš„æ·»åŠ è‡ªå‹•æ›´æ–°

---

## ğŸ”§ å‘é‡ç´¢å¼•çš„æŸ¥è©¢æµç¨‹

### 1. HybridRAG æª¢ç´¢

ç•¶åŸ·è¡Œ HybridRAG æª¢ç´¢æ™‚ï¼š
1. **å‘é‡æª¢ç´¢ï¼ˆVector Retrievalï¼‰**:
   - ä½¿ç”¨ `RealtimeRetrievalService` æŸ¥è©¢ ChromaDB
   - æ ¹æ“šæŸ¥è©¢æ–‡æœ¬ç”Ÿæˆ embedding
   - ä½¿ç”¨ç›¸ä¼¼åº¦æœç´¢æ‰¾åˆ°ç›¸é—œæ–‡æª”å¡Š
   
2. **åœ–æª¢ç´¢ï¼ˆGraph Retrievalï¼‰**:
   - ä½¿ç”¨ NER æå–å¯¦é«”
   - åœ¨ ArangoDB ä¸­æŸ¥æ‰¾åŒ¹é…çš„å¯¦é«”
   - ç²å–å¯¦é«”çš„é„°å±…ç¯€é»å’Œå­åœ–

3. **çµæœåˆä½µï¼ˆMergeï¼‰**:
   - åˆä½µå‘é‡å’Œåœ–æª¢ç´¢çµæœ
   - æ‡‰ç”¨æ¬Šé‡ï¼ˆå‘é‡ 70%ï¼Œåœ– 30%ï¼‰
   - æŒ‰ç›¸é—œåº¦æ’åº

### 2. æŸ¥è©¢ç¤ºä¾‹

```python
# 1. åˆå§‹åŒ–æœå‹™
aam_manager = AAMManager(
    chromadb_adapter=chromadb_adapter,
    ...
)

# 2. åŸ·è¡Œæª¢ç´¢
retrieval_service = RealtimeRetrievalService(aam_manager)
results = retrieval_service.retrieve(
    query="è«‹èªªæ˜ä¸­å›½é¢„åˆ¶èœäº§ä¸šå¸‚åœºè§„æ¨¡ä¸å¢é•¿è¶‹åŠ¿",
    limit=10,
    min_relevance=0.0
)

# 3. çµæœåŒ…å«ï¼š
# - content: æ–‡æª”å…§å®¹
# - relevance_score: ç›¸é—œåº¦åˆ†æ•¸
# - metadata: å…ƒæ•¸æ“šï¼ˆsource, file_id ç­‰ï¼‰
```

---

## âš ï¸ å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼æŸ¥è©¢è¿”å› 0 å€‹çµæœï¼Ÿ

**å¯èƒ½åŸå› **:
1. æ–‡ä»¶å°šæœªå®Œæˆå‘é‡åŒ–è™•ç†
2. ChromaDB é›†åˆå­˜åœ¨ä½†ç„¡æ–‡æª”æ•¸æ“š
3. æŸ¥è©¢èˆ‡æ–‡æª”å…§å®¹çš„èªç¾©ç›¸ä¼¼åº¦è¼ƒä½

**æª¢æŸ¥æ–¹æ³•**:
```python
# æª¢æŸ¥æ–‡ä»¶è™•ç†ç‹€æ…‹
from database.arangodb.client import ArangoDBClient

client = ArangoDBClient()
if client.db:
    # æª¢æŸ¥æ–‡ä»¶å…ƒæ•¸æ“š
    aql = """
        FOR doc IN file_metadata
            FILTER doc.filename LIKE '%é è£½èœ%'
            RETURN doc
    """
    files = list(client.db.aql.execute(aql))
    
    # æª¢æŸ¥è™•ç†ç‹€æ…‹
    if client.db.has_collection('processing_status'):
        aql_status = """
            FOR doc IN processing_status
                FILTER doc.file_id == @file_id
                RETURN doc
        """
        status = list(client.db.aql.execute(aql_status, bind_vars={"file_id": file_id}))
```

### Q2: å¦‚ä½•ç¢ºèªå‘é‡ç´¢å¼•å·²æ§‹å»ºï¼Ÿ

**æ–¹æ³• 1**: æª¢æŸ¥ ChromaDB é›†åˆ
```python
from services.api.services.vector_store_service import get_vector_store_service

vector_store_service = get_vector_store_service()
chromadb_client = getattr(vector_store_service, "client", None)
if chromadb_client:
    collections = chromadb_client.list_collections()
    for collection in collections:
        # å˜—è©¦ç²å–æ–‡æª”
        results = collection.get(limit=1)
        if results and results.get('ids'):
            print(f"é›†åˆ {collection.name} åŒ…å«æ–‡æª”")
```

**æ–¹æ³• 2**: æª¢æŸ¥è™•ç†ç‹€æ…‹
```python
# æª¢æŸ¥ processing_status é›†åˆ
# vectorization.status æ‡‰è©²ç‚º "completed"
# vectorization.progress æ‡‰è©²ç‚º 100
```

### Q3: å‘é‡ç´¢å¼•æ˜¯å¦éœ€è¦æ‰‹å‹•æ§‹å»ºï¼Ÿ

**ä¸éœ€è¦**ã€‚ChromaDB æœƒè‡ªå‹•ç‚ºå‘é‡å‰µå»ºç´¢å¼•ï¼ˆHNSW ç´¢å¼•ï¼‰ï¼Œç„¡éœ€æ‰‹å‹•æ§‹å»ºã€‚ç´¢å¼•éš¨å‘é‡æ•¸æ“šçš„æ·»åŠ è‡ªå‹•æ›´æ–°ã€‚

---

## ğŸ“Š æ•¸æ“šæµç¨‹åœ–

```
æ–‡ä»¶ä¸Šå‚³
  â†“
æ–‡ä»¶å­˜å„²ï¼ˆæ–‡ä»¶ç³»çµ±ï¼‰
  â†“
æ–‡ä»¶å…ƒæ•¸æ“šå­˜å„²ï¼ˆArangoDBï¼‰
  â†“
æ–‡ä»¶è™•ç†ï¼ˆWorkerï¼‰
  â†“
â”œâ”€ åˆ†å¡Šï¼ˆChunkingï¼‰
â”‚   â†“
â”‚ å‘é‡åŒ–ï¼ˆVectorizationï¼‰
â”‚   â†“
â”‚ å­˜å„²åˆ° ChromaDBï¼ˆè‡ªå‹•å‰µå»ºç´¢å¼•ï¼‰
â”‚
â””â”€ çŸ¥è­˜åœ–è­œæå–ï¼ˆKG Extractionï¼‰
    â†“
   å­˜å„²åˆ° ArangoDBï¼ˆentities, relationsï¼‰
```

---

## ğŸ”— ç›¸é—œæ–‡æª”

- `docs/ç³»ç»Ÿè®¾è®¡æ–‡æ¡£/æ ¸å¿ƒç»„ä»¶/æ–‡ä»¶ä¸Šå‚³å‘é‡åœ–è­œ/ä¸Šå‚³çš„åŠŸèƒ½æ¶æ§‹èªªæ˜-v3.0.md`
- `docs/ç³»ç»Ÿè®¾è®¡æ–‡æ¡£/æ ¸å¿ƒç»„ä»¶/æ–‡ä»¶ä¸Šå‚³å‘é‡åœ–è­œ/å‘é‡èˆ‡åœ–æª¢ç´¢æ··åˆæŸ¥è©¢é‚è¼¯.md`

---

**æœ€å¾Œæ›´æ–°æ—¥æœŸ**: 2026-01-05
**ç¶­è­·äºº**: Daniel Chung

