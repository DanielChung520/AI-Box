# ä»£ç¢¼åŠŸèƒ½èªªæ˜: AI-Box æª”æ¡ˆä»»å‹™ç®¡ç†éœ€æ±‚è¦æ ¼æ›¸

# å‰µå»ºæ—¥æœŸ: 2026-01-21

# å‰µå»ºäºº: Daniel Chung

# æœ€å¾Œä¿®æ”¹æ—¥æœŸ: 2026-01-21

# AI-Box æª”æ¡ˆä»»å‹™ç®¡ç†éœ€æ±‚è¦æ ¼æ›¸

## ğŸ“‹ ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å…§å®¹ | æ›´æ–°äºº |
|------|------|----------|--------|
| v1.0 | 2026-01-21 | åˆå§‹ç‰ˆæœ¬ | Daniel Chung |
| v1.1 | 2026-01-21 | æ–°å¢ä»»å‹™ç•°æ­¥åˆªé™¤éœ€æ±‚ï¼ˆF-TASK-010 ~ F-TASK-014ï¼‰ | Daniel Chung |
| v1.2 | 2026-01-21 | æ–°å¢ Soft Delete æ©Ÿåˆ¶ï¼ˆF-TASK-015 ~ F-TASK-020ï¼‰ã€Trash åŠŸèƒ½ | Daniel Chung |

---

## 1. éœ€æ±‚æ¦‚è¿°

### 1.1 èƒŒæ™¯

AI-Box ç³»çµ±éœ€è¦ä¸€å€‹çµ±ä¸€çš„æª”æ¡ˆä»»å‹™ç®¡ç†æ¶æ§‹ï¼Œæ»¿è¶³ï¼š

- æª”æ¡ˆä¸Šå‚³å¾Œç«‹å³å¯è¦‹
- æª”æ¡ˆå…ƒæ•¸æ“šé›†ä¸­ç®¡ç†
- å‘é‡åŒ–èˆ‡çŸ¥è­˜åœ–è­œç•°æ­¥è™•ç†

### 1.2 ç›®æ¨™

å»ºç«‹ä»¥ `file_metadata` ç‚ºæ ¸å¿ƒçš„æª”æ¡ˆç®¡ç†ç³»çµ±ï¼Œç¢ºä¿ï¼š

1. **æ•¸æ“šä¸€è‡´æ€§**: å–®ä¸€æ•¸æ“šæºï¼Œé¿å…å†—é¤˜
2. **ç”¨æˆ¶é«”é©—**: ä¸Šå‚³å¾Œç«‹å³é¡¯ç¤º
3. **æ¬Šé™ç®¡ç†**: æª”æ¡ˆæˆæ¬Šæ©Ÿåˆ¶
4. **æ“´å±•æ€§**: èƒŒæ™¯ä»»å‹™ä¸é˜»å¡ç”¨æˆ¶æ“ä½œ

---

## 2. ç³»çµ±æ¶æ§‹

### 2.1 æ•¸æ“šå­˜å„²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æª”æ¡ˆå­˜å„²å±¤                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SeaweedFS S3 (ç”Ÿç”¢ç’°å¢ƒ)                                     â”‚
â”‚  Bucket: bucket-ai-box-assets                               â”‚
â”‚  Path: s3://bucket-ai-box-assets/tasks/{task_id}/{file_id}  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âŒ data/tasks/ (å»¢é™¤ï¼Œæœ¬åœ°å­˜å„²åƒ…ä¾›é–‹ç™¼æ¸¬è©¦)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å…ƒæ•¸æ“šå­˜å„²å±¤ (ArangoDB)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  file_metadata (æ ¸å¿ƒ) â† æª”æ¡ˆç®¡ç†ä¸»æ•¸æ“šæº                      â”‚
â”‚  folder_metadata â† è³‡æ–™å¤¾çµæ§‹                                â”‚
â”‚  user_tasks â† ä»»å‹™è³‡è¨Š (ä¸åŒ…å« fileTree)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒå¯¦é«”

#### 2.2.1 file_metadata (æ ¸å¿ƒ)

**ç”¨é€”**: æª”æ¡ˆå…ƒæ•¸æ“šä¸»è¡¨ï¼Œæª”æ¡ˆç®¡ç†çš„å”¯ä¸€æ•¸æ“šæº

**å­—æ®µå®šç¾©**:

| å­—æ®µ | é¡å‹ | å¿…å¡« | èªªæ˜ |
|------|------|------|------|
| `_key` | string | âœ… | æ–‡ä»¶ ID (UUID) |
| `file_id` | string | âœ… | æ–‡ä»¶ ID (åŒ _key) |
| `filename` | string | âœ… | åŸå§‹æ–‡ä»¶åç¨± |
| `file_type` | string | âœ… | MIME é¡å‹ |
| `file_size` | integer | âœ… | æ–‡ä»¶å¤§å° (bytes) |
| `user_id` | string | âœ… | æ‰€å±¬ç”¨æˆ¶ ID |
| `task_id` | string | âœ… | æ‰€å±¬ä»»å‹™ ID |
| `folder_id` | string | âŒ | æ‰€å±¬è³‡æ–™å¤¾ ID |
| `storage_path` | string | âœ… | S3 å­˜å„²è·¯å¾‘ |
| `status` | string | âœ… | ç‹€æ…‹: uploaded/processing/completed/failed |
| `processing_status` | object | âŒ | è™•ç†ç‹€æ…‹ {vector, kg} |
| `access_control` | object | âœ… | æ¬Šé™æ§åˆ¶ |
| `tags` | array | âŒ | æ¨™ç±¤åˆ—è¡¨ |
| `description` | string | âŒ | æè¿° |
| `upload_time` | datetime | âœ… | ä¸Šå‚³æ™‚é–“ |
| `created_at` | datetime | âœ… | å‰µå»ºæ™‚é–“ |
| `updated_at` | datetime | âœ… | æ›´æ–°æ™‚é–“ |

**access_control çµæ§‹**:

```json
{
  "owner_id": "daniel@test.com",
  "tenant_id": null,
  "visibility": "private",
  "data_classification": "internal",
  "sensitivity_labels": ["confidential"],
  "sharing_enabled": false,
  "external_access_enabled": false
}
```

#### 2.2.2 folder_metadata

**ç”¨é€”**: è³‡æ–™å¤¾å…ƒæ•¸æ“š

| å­—æ®µ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `_key` | string | è³‡æ–™å¤¾ ID |
| `folder_name` | string | è³‡æ–™å¤¾åç¨± |
| `user_id` | string | æ‰€å±¬ç”¨æˆ¶ ID |
| `task_id` | string | æ‰€å±¬ä»»å‹™ ID |
| `folder_type` | string | workspace / scheduled |
| `created_at` | datetime | å‰µå»ºæ™‚é–“ |

#### 2.2.3 user_tasks

**ç”¨é€”**: ä»»å‹™è³‡è¨Š

**å­—æ®µå®šç¾©**:

| å­—æ®µ | é¡å‹ | èªªæ˜ |
|------|------|------|
| `_key` | string | ä»»å‹™ ID |
| `task_id` | string | ä»»å‹™ ID |
| `user_id` | string | æ‰€å±¬ç”¨æˆ¶ ID |
| `title` | string | ä»»å‹™æ¨™é¡Œ |
| `status` | string | ä»»å‹™ç‹€æ…‹: pending/in-progress/completed |
| `task_status` | string | ä»»å‹™é¡å‹ç‹€æ…‹: activate/archive/trash |
| `label_color` | string | æ¨™ç±¤é¡è‰² |
| `dueDate` | string | æˆªæ­¢æ—¥æœŸ |
| `messages` | array | å°è©±è¨˜éŒ„ |
| `executionConfig` | object | åŸ·è¡Œé…ç½® |
| `fileTree` | array | âŒ ç§»é™¤ (ä¸å†ä½¿ç”¨) |
| `deleted_at` | datetime | è»Ÿåˆªé™¤æ™‚é–“ï¼ˆSoft Deleteï¼‰ |
| `permanent_delete_at` | datetime | é å®šæ°¸ä¹…åˆªé™¤æ™‚é–“ï¼ˆ7 å¤©å¾Œï¼‰ |
| `created_at` | datetime | å‰µå»ºæ™‚é–“ |
| `updated_at` | datetime | æ›´æ–°æ™‚é–“ |

**task_status ç‹€æ…‹èªªæ˜**:

| ç‹€æ…‹ | èªªæ˜ |
|------|------|
| activate | æ­£å¸¸ä»»å‹™ï¼ˆé¡¯ç¤ºåœ¨ä»»å‹™åˆ—è¡¨ï¼‰ |
| archive | æ­¸æª”ä»»å‹™ï¼ˆå¯é¸åŠŸèƒ½ï¼‰ |
| trash | åˆªé™¤ä»»å‹™ï¼ˆé¡¯ç¤ºåœ¨ Trash é ç±¤ï¼‰ |

**Soft Delete æ©Ÿåˆ¶**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä»»å‹™ç”Ÿå‘½é€±æœŸ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  create â”€â”€â–º activate â”€â”€â–º archive                            â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â”‚ DELETE                                 â”‚
â”‚                    â–¼                                        â”‚
â”‚                  trash                                      â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â”‚ restore                                â”‚
â”‚                    â–¼                                        â”‚
â”‚                  activate                                    â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â”‚ permanent_delete (7å¤©å¾Œæˆ–æ‰‹å‹•)          â”‚
â”‚                    â–¼                                        â”‚
â”‚                deleted                                      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. åŠŸèƒ½éœ€æ±‚

### 3.1 æª”æ¡ˆä¸Šå‚³

#### 3.1.1 åŸºæœ¬æµç¨‹

```
ç”¨æˆ¶ä¸Šå‚³æª”æ¡ˆ
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é©—è­‰ç”¨æˆ¶æ¬Šé™                          â”‚
â”‚ 2. ç”Ÿæˆæ–‡ä»¶ ID (UUID)                    â”‚
â”‚ 3. ä¸Šå‚³åˆ° SeaweedFS S3                   â”‚
â”‚ 4. å‰µå»º file_metadata è¨˜éŒ„               â”‚
â”‚ 5. è¿”å›æˆåŠŸéŸ¿æ‡‰ (åŒ…å« file_id)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èƒŒæ™¯ä»»å‹™ (ç•°æ­¥)                          â”‚
â”‚ - å‘é‡åŒ– (Qdrant)                        â”‚
â”‚ - çŸ¥è­˜åœ–è­œæå– (ArangoDB)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.1.2 éœ€æ±‚è§„æ ¼

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | å„ªå…ˆç´š |
|----------|----------|--------|
| F-UPL-001 | æª”æ¡ˆå¿…é ˆä¸Šå‚³åˆ° SeaweedFS S3 | P0 |
| F-UPL-002 | file_metadata å‰µå»ºå¿…é ˆæˆåŠŸï¼ˆäº‹å‹™ä¿è­‰ï¼‰ | P0 |
| F-UPL-003 | ä¸Šå‚³æˆåŠŸå¾Œç«‹å³å¯é€šé API æŸ¥è©¢ | P0 |
| F-UPL-004 | å‘é‡åŒ–èˆ‡çŸ¥è­˜åœ–è­œç•°æ­¥åŸ·è¡Œ | P1 |
| F-UPL-005 | æ”¯æ´å¤šæ–‡ä»¶ä¸Šå‚³ | P1 |
| F-UPL-006 | æ”¯æ´é€²åº¦å›å ± | P2 |

### 3.2 æ–‡ä»¶æ¨¹æŸ¥è©¢

#### 3.2.1 API è¦æ ¼

**ç«¯é»**: `GET /api/v1/files/tree`

**åƒæ•¸**:

- `task_id` (å¿…å¡«): ä»»å‹™ ID
- `user_id` (é¸å¡«): ç”¨æˆ¶ IDï¼ˆé©—è­‰ç”¨ï¼‰

**éŸ¿æ‡‰**:

```json
{
  "code": 200,
  "data": {
    "tree": {
      "{folder_id}": [
        {
          "file_id": "uuid",
          "filename": "æª”æ¡ˆåç¨±.md",
          "file_type": "markdown",
          "upload_time": "2026-01-21T12:00:00Z"
        }
      ]
    },
    "folders": {
      "{folder_id}": {
        "folder_name": "ä»»å‹™å·¥ä½œå€",
        "folder_type": "workspace"
      }
    },
    "total_files": 1
  }
}
```

#### 3.2.2 éœ€æ±‚è¦æ ¼

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | å„ªå…ˆç´š |
|----------|----------|--------|
| F-TREE-001 | å¾ file_metadata å‹•æ…‹æŸ¥è©¢ | P0 |
| F-TREE-002 | æ”¯æ´è³‡æ–™å¤¾çµæ§‹ | P1 |
| F-TREE-003 | æ”¯æ´æ–‡ä»¶éæ¿¾èˆ‡æ’åº | P2 |

### 3.3 æª”æ¡ˆç®¡ç†

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | å„ªå…ˆç´š |
|----------|----------|--------|
| F-MGMT-001 | æ ¹æ“š file_id æŸ¥è©¢æª”æ¡ˆè³‡è¨Š | P0 |
| F-MGMT-002 | æ›´æ–°æª”æ¡ˆå…ƒæ•¸æ“š | P1 |
| F-MGMT-003 | åˆªé™¤æª”æ¡ˆ (å« S3 å’Œ metadata) | P0 |
| F-MGMT-004 | ç§»å‹•æª”æ¡ˆåˆ°ä¸åŒè³‡æ–™å¤¾ | P2 |

### 3.4 ä»»å‹™ç®¡ç†

#### 3.4.1 ä»»å‹™åˆªé™¤ï¼ˆç•°æ­¥ï¼‰

**ç«¯é»**:
| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| DELETE | `/api/v1/user-tasks/{task_id}/async` | ç•°æ­¥åˆªé™¤ä»»å‹™ï¼ˆç«‹å³è¿”å› job_idï¼‰ |
| GET | `/api/v1/user-tasks/jobs/{job_id}` | æŸ¥è©¢åˆªé™¤ä»»å‹™ç‹€æ…‹ |

**åŠŸèƒ½èªªæ˜**: åˆªé™¤ä»»å‹™åŠå…¶æ‰€æœ‰é—œè¯è³‡æºï¼ˆç•°æ­¥åŸ·è¡Œï¼‰

**åˆªé™¤ç¯„åœ**:
| è³‡æº | ä½ç½® | èªªæ˜ |
|------|------|------|
| ä»»å‹™è¨˜éŒ„ | ArangoDB `user_tasks` | åˆªé™¤ä»»å‹™æ–‡æª” |
| æª”æ¡ˆå…ƒæ•¸æ“š | ArangoDB `file_metadata` | åˆªé™¤è©²ä»»å‹™æ‰€æœ‰æª”æ¡ˆè¨˜éŒ„ |
| è³‡æ–™å¤¾å…ƒæ•¸æ“š | ArangoDB `folder_metadata` | åˆªé™¤è©²ä»»å‹™æ‰€æœ‰è³‡æ–™å¤¾è¨˜éŒ„ |
| æª”æ¡ˆå‘é‡ | Qdrant | åˆªé™¤è©²ä»»å‹™æ‰€æœ‰æª”æ¡ˆçš„å‘é‡ |
| çŸ¥è­˜åœ–è­œ | ArangoDB `entities`, `relations` | åˆªé™¤è©²ä»»å‹™æ‰€æœ‰åœ–è­œæ•¸æ“š |
| æª”æ¡ˆå­˜å„² | SeaweedFS S3 | åˆªé™¤è©²ä»»å‹™æ‰€æœ‰æª”æ¡ˆ |

**ç•°æ­¥åˆªé™¤æµç¨‹**:

```
ç”¨æˆ¶è«‹æ±‚åˆªé™¤ä»»å‹™
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DELETE /api/v1/user-tasks/{task_id}/async â”‚
â”‚                                         â”‚
â”‚ 1. é©—è­‰ä»»å‹™æ­¸å±¬                           â”‚
â”‚ 2. æª¢æŸ¥ä»»å‹™æ˜¯å¦å­˜åœ¨                       â”‚
â”‚ 3. æäº¤åˆ° RQ éšŠåˆ—                         â”‚
â”‚ 4. è¿”å› job_id                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›:                                    â”‚
â”‚ {                                        â”‚
â”‚   "job_id": "xxx",                       â”‚
â”‚   "task_id": "task_123",                 â”‚
â”‚   "status": "queued"                     â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯é—œé–‰å°è©±æ¡†ï¼Œé¡¯ç¤ºå³ä¸‹è§’ Toast é€šçŸ¥      â”‚
â”‚ ã€Œä»»å‹™åˆªé™¤å·²æäº¤ï¼Œè«‹ç¨å¾Œ...ã€              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯è¼ªè©¢:                                 â”‚
â”‚ GET /api/v1/user-tasks/jobs/{job_id}      â”‚
â”‚                                         â”‚
â”‚ ç‹€æ…‹: queued â†’ started â†’ finished        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®Œæˆé€šçŸ¥:                                 â”‚
â”‚ ã€Œä»»å‹™åˆªé™¤å®Œæˆã€‚                          â”‚
â”‚ å·²åˆªé™¤ 5 å€‹æ–‡ä»¶ï¼Œ2 å€‹è³‡æ–™å¤¾ã€‚ã€           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**DELETE /api/v1/user-tasks/{task_id}/async è«‹æ±‚åƒæ•¸**:
| åƒæ•¸ | é¡å‹ | å¿…å¡« | èªªæ˜ |
|------|------|------|------|
| `task_id` | string | âœ… | ä»»å‹™ ID |

**DELETE éŸ¿æ‡‰**:

```json
{
  "code": 200,
  "success": true,
  "data": {
    "job_id": "abc123-def456",
    "task_id": "task_123",
    "status": "queued"
  },
  "message": "ä»»å‹™åˆªé™¤å·²æäº¤"
}
```

**GET /api/v1/user-tasks/jobs/{job_id} éŸ¿æ‡‰**:
| ç‹€æ…‹ | éŸ¿æ‡‰ |
|------|------|
| queued | `{"status": "queued", "message": "ä»»å‹™æ­£åœ¨æ’éšŠ..."}` |
| started | `{"status": "started", "message": "ä»»å‹™æ­£åœ¨è™•ç†ä¸­..."}` |
| finished | `{"status": "finished", "data": {...}, "message": "ä»»å‹™åˆªé™¤å®Œæˆ"}` |
| failed | `{"status": "failed", "errors": [...], "message": "ä»»å‹™åˆªé™¤å¤±æ•—"}` |

**å®ŒæˆéŸ¿æ‡‰ç¯„ä¾‹**:

```json
{
  "code": 200,
  "success": true,
  "data": {
    "job_id": "abc123-def456",
    "status": "finished",
    "task_id": "task_123",
    "files_deleted": 5,
    "folders_deleted": 2,
    "vectors_deleted": 50,
    "kg_deleted": true,
    "started_at": "2026-01-21T22:30:00Z",
    "ended_at": "2026-01-21T22:30:05Z",
    "rollback_status": "completed"
  },
  "message": "ä»»å‹™åˆªé™¤å®Œæˆã€‚å·²åˆªé™¤ 5 å€‹æ–‡ä»¶ï¼Œ2 å€‹è³‡æ–™å¤¾ã€‚"
}
```

**åˆªé™¤äº‹å‹™å›æ»¾æ©Ÿåˆ¶**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DeletionRollbackManager          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è·è²¬:                                   â”‚
â”‚ 1. è¨˜éŒ„æ‰€æœ‰åˆªé™¤æ“ä½œ                      â”‚
â”‚ 2. å¯¦ç¾æ“ä½œé‡è©¦æ©Ÿåˆ¶ (æœ€å¤š 3 æ¬¡)          â”‚
â”‚ 3. è¿½è¹¤åˆªé™¤ç‹€æ…‹                          â”‚
â”‚ 4. ç”Ÿæˆå›æ»¾å ±å‘Š                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿½è¹¤çš„è³‡æºé¡å‹:                          â”‚
â”‚ - vector: å‘é‡åˆªé™¤                       â”‚
â”‚ - kg_entity: çŸ¥è­˜åœ–è­œå¯¦é«”åˆªé™¤             â”‚
â”‚ - kg_relation: çŸ¥è­˜åœ–è­œé—œä¿‚åˆªé™¤           â”‚
â”‚ - metadata: æ–‡ä»¶å…ƒæ•¸æ“šåˆªé™¤                â”‚
â”‚ - file: å¯¦é«”æ–‡ä»¶åˆªé™¤                     â”‚
â”‚ - folder: è³‡æ–™å¤¾åˆªé™¤                     â”‚
â”‚ - task: ä»»å‹™æœ¬èº«åˆªé™¤                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å›æ»¾å ±å‘ŠåŒ…å«:                            â”‚
â”‚ - ç‹€æ…‹: completed/partially_failed/failedâ”‚
â”‚ - ç¸½æ“ä½œæ•¸                               â”‚
â”‚ - æˆåŠŸæ“ä½œæ•¸                             â”‚
â”‚ - å¤±æ•—æ“ä½œæ•¸                             â”‚
â”‚ - å¤±æ•—æ“ä½œè©³ç´°ä¿¡æ¯                       â”‚
â”‚ - å»ºè­°æ“ä½œ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éœ€æ±‚è¦æ ¼**:

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | å„ªå…ˆç´š |
|----------|----------|--------|
| F-TASK-001 | åˆªé™¤ä»»å‹™åŠæ‰€æœ‰é—œè¯è³‡æº | P0 |
| F-TASK-002 | é©—è­‰ä»»å‹™æ­¸å±¬ï¼ˆåªèƒ½åˆªé™¤è‡ªå·±çš„ä»»å‹™ï¼‰ | P0 |
| F-TASK-003 | åˆªé™¤ ArangoDB user_tasks | P0 |
| F-TASK-004 | åˆªé™¤ ArangoDB file_metadata | P0 |
| F-TASK-005 | åˆªé™¤ ArangoDB folder_metadata | P0 |
| F-TASK-006 | åˆªé™¤ Qdrant å‘é‡ | P0 |
| F-TASK-007 | åˆªé™¤ SeaweedFS S3 æª”æ¡ˆ | P0 |
| F-TASK-008 | åˆªé™¤å¤±æ•—æ™‚å›æ»¾æˆ–è¨˜éŒ„ | P1 |
| F-TASK-009 | æ”¯æ´å¼·åˆ¶åˆªé™¤é¸é … | P2 |
| **F-TASK-010** | **ç•°æ­¥åˆªé™¤ï¼ˆç«‹å³è¿”å› job_idï¼‰** | **P0** |
| **F-TASK-011** | **ç‹€æ…‹æŸ¥è©¢ APIï¼ˆè¼ªè©¢é€²åº¦ï¼‰** | **P0** |
| **F-TASK-012** | **åˆªé™¤æ“ä½œè¿½è¹¤ï¼ˆDeletionOperationï¼‰** | **P1** |
| **F-TASK-013** | **é‡è©¦æ©Ÿåˆ¶ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰** | **P1** |
| **F-TASK-014** | **å›æ»¾å ±å‘Šç”Ÿæˆ** | **P1** |

#### 3.4.3 ä»»å‹™ Soft Deleteï¼ˆè»Ÿåˆªé™¤ï¼‰

**åŠŸèƒ½èªªæ˜**: æ”¯æ´è»Ÿåˆªé™¤æ©Ÿåˆ¶ï¼Œä»»å‹™ä¸æœƒç«‹å³è¢«æ°¸ä¹…åˆªé™¤ï¼Œè€Œæ˜¯é€²å…¥ Trashï¼Œç”¨æˆ¶å¯ä»¥åœ¨ 7 å¤©å…§æ¢å¾©ã€‚

**æ–°åˆªé™¤æµç¨‹ï¼ˆOptimistic UI + Soft Deleteï¼‰**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ¶åœ¨ Sidebar è¼¸å…¥ DELETEï¼Œé»æ“Šç¢ºèª                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 1ï¼šUI ç«‹å³æ¸…é™¤ä»»å‹™ï¼ˆOptimistic Updateï¼‰                          â”‚
â”‚   - å¾ savedTasks ç§»é™¤                                               â”‚
â”‚   - æ¸…é™¤ activeItemId                                                â”‚
â”‚   - å¾æ”¶è—å¤¾ç§»é™¤                                                     â”‚
â”‚   - é—œé–‰å°è©±æ¡†                                                       â”‚
â”‚   - é¡¯ç¤º Toastï¼šã€Œæ­£åœ¨åˆªé™¤...ã€                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 2ï¼šå¾Œç«¯ Soft Deleteï¼ˆæ¨™è¨˜ deleted_atï¼‰                          â”‚
â”‚   - PATCH /user-tasks/{task_id}/soft-delete                         â”‚
â”‚   - è¿”å› { job_id, status: "queued" }                               â”‚
â”‚   - è¨­ç½® deleted_at = now()                                          â”‚
â”‚   - è¨­å®š task_status = "trash"                                       â”‚
â”‚   - è¨­å®š permanent_delete_at = now() + 7 å¤©                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥é©Ÿ 3ï¼šå¾Œå°ç•°æ­¥æ¸…ç†ï¼ˆAsync Jobï¼‰                                     â”‚
â”‚   - RQ Job åŸ·è¡Œå¯¦éš›æ¸…ç†ï¼š                                            â”‚
â”‚     - æ–‡ä»¶å…ƒæ•¸æ“š (file_metadata)                                     â”‚
â”‚     - å‘é‡æ•¸æ“š (ChromaDB)                                            â”‚
â”‚     - çŸ¥è­˜åœ–è­œ (ArangoDB)                                            â”‚
â”‚     - å¯¦é«”æ–‡ä»¶ (S3/Storage)                                          â”‚
â”‚   - å®Œæˆå¾Œè¿”å›ç‹€æ…‹                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ æ¸…ç†æˆåŠŸ       â”‚               â”‚ æ¸…ç†å¤±æ•—       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â–¼                               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ è¨˜éŒ„æˆåŠŸæ—¥èªŒ   â”‚               â”‚ è¨˜éŒ„éŒ¯èª¤       â”‚
            â”‚ (job completed)â”‚               â”‚ ä¿ç•™ deleted_atâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ å…è¨±ç”¨æˆ¶é‡è©¦    â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API ç«¯é»**:

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| **PATCH** | **`/api/v1/user-tasks/{task_id}/soft-delete`** | **è»Ÿåˆªé™¤ä»»å‹™ï¼ˆæ¨™è¨˜ deleted_atï¼‰** |
| **PATCH** | **`/api/v1/user-tasks/{task_id}/restore`** | **æ¢å¾©ä»»å‹™ï¼ˆå¾ Trashï¼‰** |
| **DELETE** | **`/api/v1/user-tasks/{task_id}/permanent`** | **æ°¸ä¹…åˆªé™¤ï¼ˆå¾ Trashï¼‰** |
| **GET** | **`/api/v1/user-tasks?status=trash`** | **ç²å– Trash ä¸­çš„ä»»å‹™** |

**PATCH /api/v1/user-tasks/{task_id}/soft-delete è«‹æ±‚**:

```json
{
  "task_id": "task_123"
}
```

**PATCH éŸ¿æ‡‰**:

```json
{
  "code": 200,
  "success": true,
  "data": {
    "task_id": "task_123",
    "job_id": "abc123-def456",
    "status": "queued",
    "deleted_at": "2026-01-21T10:00:00Z",
    "permanent_delete_at": "2026-01-28T10:00:00Z",
    "message": "ä»»å‹™å·²ç§»è‡³ Trashï¼Œå°‡åœ¨ 7 å¤©å¾Œæ°¸ä¹…åˆªé™¤"
  },
  "message": "ä»»å‹™åˆªé™¤å·²æäº¤"
}
```

**PATCH /api/v1/user-tasks/{task_id}/restore è«‹æ±‚**:

```json
{
  "task_id": "task_123"
}
```

**PATCH /restore éŸ¿æ‡‰**:

```json
{
  "code": 200,
  "success": true,
  "data": {
    "task_id": "task_123",
    "task_status": "activate",
    "deleted_at": null,
    "permanent_delete_at": null,
    "message": "ä»»å‹™å·²æ¢å¾©"
  },
  "message": "ä»»å‹™å·²æ¢å¾©"
}
```

**DELETE /api/v1/user-tasks/{task_id}/permanent éŸ¿æ‡‰**:

```json
{
  "code": 200,
  "success": true,
  "data": {
    "task_id": "task_123",
    "message": "ä»»å‹™å·²æ°¸ä¹…åˆªé™¤"
  },
  "message": "ä»»å‹™å·²æ°¸ä¹…åˆªé™¤"
}
```

**éœ€æ±‚è¦æ ¼**:

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | å„ªå…ˆç´š |
|----------|----------|--------|
| **F-TASK-015** | **è»Ÿåˆªé™¤æ©Ÿåˆ¶ï¼ˆæ¨™è¨˜ deleted_atï¼‰** | **P0** |
| **F-TASK-016** | **ä»»å‹™ç§»è‡³ Trashï¼ˆtask_status = "trash"ï¼‰** | **P0** |
| **F-TASK-017** | **7 å¤©å¾Œè‡ªå‹•æ°¸ä¹…åˆªé™¤** | **P1** |
| **F-TASK-018** | **å¾ Trash æ¢å¾©ä»»å‹™** | **P0** |
| **F-TASK-019** | **å‰ç«¯ Optimistic UI æ›´æ–°** | **P0** |
| **F-TASK-020** | **åˆªé™¤å¤±æ•—æ™‚ UI ç‹€æ…‹å›æ»¾** | **P1** |

#### 3.4.4 åˆªé™¤æµç¨‹

```
ç”¨æˆ¶è«‹æ±‚åˆªé™¤ä»»å‹™
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é©—è­‰ä»»å‹™æ­¸å±¬                          â”‚
â”‚    - æª¢æŸ¥ä»»å‹™æ˜¯å¦å±¬æ–¼ç•¶å‰ç”¨æˆ¶             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æŸ¥è©¢æ‰€æœ‰é—œè¯è³‡æº                      â”‚
â”‚    - file_metadata (task_id)            â”‚
â”‚    - folder_metadata (task_id)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¸¦è¡Œåˆªé™¤è³‡æº                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    â”‚ ArangoDB â”‚  â”‚  Qdrant  â”‚  â”‚   S3     â”‚
â”‚    â”‚   (3å€‹)  â”‚  â”‚          â”‚  â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è¨˜éŒ„å¤±æ•—çš„è³‡æº                        â”‚
â”‚ 5. è¿”å›åˆªé™¤çµæœ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 æ¬Šé™ç®¡ç†

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | å„ªå…ˆç´š |
|----------|----------|--------|
| F-PERM-001 | åŸºæ–¼ file_metadata.access_control æª¢æŸ¥æ¬Šé™ | P0 |
| F-PERM-002 | æ”¯æ´æ•¸æ“šåˆ†é¡ | P1 |
| F-PERM-003 | æ”¯æ´æ•æ„Ÿåº¦æ¨™ç±¤ | P2 |

---

## 4. éåŠŸèƒ½éœ€æ±‚

### 4.1 æ€§èƒ½éœ€æ±‚

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | ç›®æ¨™ |
|----------|----------|------|
| N-PERF-001 | ä¸Šå‚³éŸ¿æ‡‰æ™‚é–“ | < 5s (ä¸å«èƒŒæ™¯è™•ç†) |
| N-PERF-002 | æ–‡ä»¶æ¨¹æŸ¥è©¢éŸ¿æ‡‰æ™‚é–“ | < 1s |
| N-PERF-003 | æ”¯æŒä¸¦ç™¼ä¸Šå‚³ | > 10 req/s |

### 4.2 å¯é æ€§éœ€æ±‚

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | ç›®æ¨™ |
|----------|----------|------|
| N-REL-001 | file_metadata å‰µå»ºäº‹å‹™ä¿è­‰ | 100% |
| N-REL-002 | èƒŒæ™¯ä»»å‹™å¤±æ•—é‡è©¦ | 3 æ¬¡ |
| N-REL-003 | æ•¸æ“šä¸€è‡´æ€§æª¢æŸ¥ | æ¯æ—¥ |

### 4.3 å»¢é™¤èˆŠåŠŸèƒ½

| éœ€æ±‚ç·¨è™Ÿ | éœ€æ±‚æè¿° | å„ªå…ˆç´š |
|----------|----------|--------|
| N-DEP-001 | å»¢é™¤æœ¬åœ°å­˜å„² data/tasks/ | P1 |
| N-DEP-002 | ç§»é™¤ user_tasks.fileTree | P1 |
| N-DEP-003 | ç§»é™¤æœ¬åœ°æ–‡ä»¶ç³»çµ±å­˜å„²é‚è¼¯ | P2 |

---

## 5. API ç«¯é»ç¸½è¦½

### 5.1 æª”æ¡ˆä¸Šå‚³

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| POST | /api/v1/files/upload | ä¸Šå‚³æª”æ¡ˆåˆ° S3ï¼Œå‰µå»º metadata |

### 5.2 æ–‡ä»¶ç®¡ç†

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| GET | /api/v1/files/{file_id} | æŸ¥è©¢æª”æ¡ˆè³‡è¨Š |
| PUT | /api/v1/files/{file_id} | æ›´æ–°æª”æ¡ˆå…ƒæ•¸æ“š |
| DELETE | /api/v1/files/{file_id} | åˆªé™¤æª”æ¡ˆ |

### 5.3 æ–‡ä»¶æ¨¹

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| GET | /api/v1/files/tree | æŸ¥è©¢ä»»å‹™æ–‡ä»¶æ¨¹ (å¾ metadata) |

### 5.4 ä»»å‹™ç®¡ç†

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| GET | `/api/v1/user-tasks` | æŸ¥è©¢ç”¨æˆ¶ä»»å‹™åˆ—è¡¨ |
| GET | `/api/v1/user-tasks?status=trash` | æŸ¥è©¢ Trash ä¸­çš„ä»»å‹™ |
| GET | `/api/v1/user-tasks/{task_id}` | æŸ¥è©¢å–®å€‹ä»»å‹™ |
| POST | `/api/v1/user-tasks` | å‰µå»ºä»»å‹™ |
| PUT | `/api/v1/user-tasks/{task_id}` | æ›´æ–°ä»»å‹™ |
| **PATCH** | **`/api/v1/user-tasks/{task_id}/soft-delete`** | **è»Ÿåˆªé™¤ä»»å‹™ï¼ˆç§»è‡³ Trashï¼‰** |
| **PATCH** | **`/api/v1/user-tasks/{task_id}/restore`** | **æ¢å¾©ä»»å‹™ï¼ˆå¾ Trashï¼‰** |
| **DELETE** | **`/api/v1/user-tasks/{task_id}/permanent`** | **æ°¸ä¹…åˆªé™¤ï¼ˆå¾ Trashï¼‰** |
| **DELETE** | **`/api/v1/user-tasks/{task_id}/async`** | **ç•°æ­¥åˆªé™¤ä»»å‹™ï¼ˆç«‹å³è¿”å› job_idï¼‰** |
| **GET** | **`/api/v1/user-tasks/jobs/{job_id}`** | **æŸ¥è©¢åˆªé™¤ä»»å‹™ç‹€æ…‹** |

### 5.5 è³‡æ–™å¤¾ç®¡ç†

| Method | Endpoint | èªªæ˜ |
|--------|----------|------|
| POST | /api/v1/folders | å‰µå»ºè³‡æ–™å¤¾ |
| GET | /api/v1/folders/{folder_id} | æŸ¥è©¢è³‡æ–™å¤¾ |
| PUT | /api/v1/folders/{folder_id} | æ›´æ–°è³‡æ–™å¤¾ |
| DELETE | /api/v1/folders/{folder_id} | åˆªé™¤è³‡æ–™å¤¾ |

---

## 6. æ•¸æ“šæµå‘

### 6.1 ä¸Šå‚³æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯    â”‚â”€â”€â”€â”€â–ºâ”‚  API Server  â”‚â”€â”€â”€â”€â–ºâ”‚ SeaweedFS   â”‚
â”‚          â”‚     â”‚              â”‚     â”‚ (S3)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ file_metadata â”‚ â—„â”€â”€ æ ¸å¿ƒæ•¸æ“šæº
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  è¿”å›æˆåŠŸ    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ RQ Worker    â”‚â”€â”€â”€â”€â–ºâ”‚ Qdrant      â”‚ (å‘é‡)
              â”‚ (èƒŒæ™¯)       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚â”€â”€â”€â”€â–ºâ”‚ ArangoDB    â”‚ (åœ–è­œ)
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æŸ¥è©¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯    â”‚â”€â”€â”€â”€â–ºâ”‚  API Server  â”‚â”€â”€â”€â”€â–ºâ”‚ file_metadataâ”‚
â”‚          â”‚     â”‚ /files/tree  â”‚     â”‚ + folder_   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ metadata    â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 åˆªé™¤æµç¨‹ï¼ˆç•°æ­¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯    â”‚â”€â”€â”€â”€â–ºâ”‚  API Server  â”‚â”€â”€â”€â”€â–ºâ”‚  RQ Queue   â”‚
â”‚          â”‚     â”‚  DELETE      â”‚     â”‚ (task_      â”‚
â”‚          â”‚     â”‚  /async      â”‚     â”‚  deletion)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ è¿”å› job_id  â”‚
               â”‚ é—œé–‰å°è©±æ¡†   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  Toast é€šçŸ¥  â”‚â—„â”€â”€â”€â”€â”‚  å‰ç«¯è¼ªè©¢   â”‚
               â”‚  "è™•ç†ä¸­..." â”‚     â”‚ /jobs/{id}  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚ RQ Worker    â”‚â”€â”€â”€â”€â–ºâ”‚ Deletion   â”‚
               â”‚              â”‚     â”‚ Rollback    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ Manager    â”‚
                        â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚              â”‚â”€â”€â”€â”€â–ºâ”‚ ArangoDB   â”‚ (3 å€‹ collection)
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  å®Œæˆé€šçŸ¥    â”‚â”€â”€â”€â”€â–ºâ”‚   å‰ç«¯     â”‚
               â”‚  Toast é—œé–‰  â”‚     â”‚            â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. é¢¨éšªèˆ‡ç·©è§£

| é¢¨éšª | å½±éŸ¿ | ç·©è§£æªæ–½ |
|------|------|----------|
| file_metadata å‰µå»ºå¤±æ•— | æ•¸æ“šä¸ä¸€è‡´ | äº‹å‹™ä¿è­‰ï¼Œå¤±æ•—å›æ»¾ |
| S3 å­˜å„²ä¸å¯ç”¨ | ç„¡æ³•ä¸Šå‚³ | æœ¬åœ°ç·©å­˜ï¼Œé‡è©¦æ©Ÿåˆ¶ |
| èƒŒæ™¯ä»»å‹™å¤±æ•— | å‘é‡/åœ–è­œç¼ºå¤± | é‡è©¦æ©Ÿåˆ¶ï¼Œå¤±æ•—å‘Šè­¦ |
| ä»»å‹™åˆªé™¤è¶…æ™‚ | ç”¨æˆ¶ç­‰å¾…æ™‚é–“é•· | ç•°æ­¥è™•ç†ï¼Œç‹€æ…‹é€šçŸ¥ |

---

**æ–‡ä»¶ç‰ˆæœ¬**: v1.2
**æœ€å¾Œæ›´æ–°æ—¥æœŸ**: 2026-01-21
**ç¶­è­·äºº**: Daniel Chung
