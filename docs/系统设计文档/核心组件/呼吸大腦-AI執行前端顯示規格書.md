# å‘¼å¸å¤§è…¦ - AI åŸ·è¡Œå‰ç«¯é¡¯ç¤ºè¦æ ¼æ›¸

**ä»£ç¢¼åŠŸèƒ½èªªæ˜**: å‘¼å¸å¤§è…¦ï¼ˆBrain Iconï¼‰AI åŸ·è¡Œç‹€æ…‹é¡¯ç¤ºçš„å®Œæ•´æŠ€è¡“è¦æ ¼
**å‰µå»ºæ—¥æœŸ**: 2026-02-03
**å‰µå»ºäºº**: Daniel Chung
**æœ€å¾Œä¿®æ”¹æ—¥æœŸ**: 2026-02-04

---

## ğŸ“‹ æ–‡æª”æ¦‚è¿°

æœ¬æ–‡æª”èªªæ˜ã€Œå‘¼å¸å¤§è…¦ã€åŠŸèƒ½ï¼šåœ¨ ChatInput ä¸Šæ–¹æä¾›ä¸€å€‹å¯é»æ“Šçš„å¤§è…¦åœ–æ¨™ï¼Œé»æ“Šå¾Œå½ˆå‡ºè¦–çª—é¡¯ç¤º AI åŸ·è¡Œéç¨‹ä¸­çš„å„å€‹æ­¥é©Ÿï¼Œè®“ç”¨æˆ¶äº†è§£ AI çš„æ€è€ƒã€è™•ç†éç¨‹ï¼Œé¡ä¼¼ OpenCode çš„ Coder Agent æˆ– Cursor çš„ AI åŸ·è¡Œç‹€æ…‹é¡¯ç¤ºã€‚

**æ ¸å¿ƒè¨­è¨ˆç†å¿µ**ï¼š
- **IDE AI Agents æˆåŠŸé—œéµ**ï¼šåœ¨åŸ·è¡Œçš„æ¯å€‹é—œéµé»ç™¼é€ç‹€æ…‹
- **åƒè€ƒæ¡ˆä¾‹**ï¼šCursorã€Copilotã€OpenCode çš„ AI åŸ·è¡Œç‹€æ…‹é¡¯ç¤º
- **AI-Box ç›®æ¨™**ï¼šåœ¨ Task Analyzerã€Orchestratorã€Agent åŸ·è¡Œçš„æ¯å€‹æ­¥é©Ÿéƒ½ç™¼é€ç‹€æ…‹

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½
1. **å‘¼å¸å¤§è…¦åœ–æ¨™**ï¼šåœ¨ ChatInput ä¸Šæ–¹é¡¯ç¤ºä¸€å€‹å¸¶å‘¼å¸å‹•ç•«çš„å¤§è…¦åœ–æ¨™
2. **ç‹€æ…‹æŒ‡ç¤º**ï¼šé€šéåœ–æ¨™é¡è‰²å’Œå‹•ç•«é¡¯ç¤º AI ç•¶å‰ç‹€æ…‹ï¼ˆé–’ç½®/è™•ç†ä¸­/å®Œæˆ/éŒ¯èª¤ï¼‰
3. **åŸ·è¡Œéç¨‹è¦–çª—**ï¼šé»æ“Šåœ–æ¨™å½ˆå‡ºè¦–çª—ï¼Œé¡¯ç¤º AI åŸ·è¡Œçš„å„å€‹æ­¥é©Ÿ
4. **å³æ™‚æ›´æ–°**ï¼šé€šé SSEï¼ˆServer-Sent Eventsï¼‰å¯¦æ™‚æ¥æ”¶ä¸¦é¡¯ç¤ºåŸ·è¡Œç‹€æ…‹

### è¨­è¨ˆç›®æ¨™
- **ç”¨æˆ¶å¯è¦–åŒ–**ï¼šè®“ç”¨æˆ¶äº†è§£ AI çš„æ€è€ƒã€è™•ç†éç¨‹
- **å¢å¼·ä¿¡ä»»**ï¼šé€æ˜çš„åŸ·è¡Œéç¨‹æå‡ç”¨æˆ¶ä¿¡ä»»
- **ä¾¿æ–¼èª¿è©¦**ï¼šé–‹ç™¼è€…å¯ä»¥é€šéè¦–çª—å¿«é€Ÿå®šä½å•é¡Œ
- **çµ±ä¸€æ¶æ§‹**ï¼šæ‰€æœ‰ AI å°è©±éƒ½ä½¿ç”¨ç›¸åŒçš„ç‹€æ…‹é¡¯ç¤ºæ©Ÿåˆ¶

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### æ•´é«”æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ai-bot å‰ç«¯                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ BrainIcon    â”‚  â”‚ AIStatusWindow                       â”‚  â”‚
â”‚  â”‚ - å‘¼å¸å‹•ç•«    â”‚  â”‚ - é¡¯ç¤ºåŸ·è¡Œæ­¥é©Ÿåˆ—è¡¨                     â”‚  â”‚
â”‚  â”‚ - ç‹€æ…‹æŒ‡ç¤º    â”‚  â”‚ - å¯¦æ™‚æ›´æ–°                           â”‚  â”‚
â”‚  â”‚ - é»æ“Šå½ˆçª—    â”‚  â”‚ - é€²åº¦æ¢é¡¯ç¤º                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                       â†‘                          â”‚
â”‚           â”‚                       â”‚ SSE é€£æ¥                  â”‚
â”‚           â”‚                       â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ aiStatusStore (Zustand)                              â”‚  â”‚
â”‚  â”‚ - isWindowOpen                                         â”‚  â”‚
â”‚  â”‚ - currentStatus                                        â”‚  â”‚
â”‚  â”‚ - events[]                                             â”‚  â”‚
â”‚  â”‚ - requestId                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                       â†‘                          â”‚
â”‚           â”‚                       â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ useAIStatusSSE (Hook)                                â”‚  â”‚
â”‚  â”‚ - ç®¡ç† SSE é€£æ¥                                        â”‚  â”‚
â”‚  â”‚ - æ¥æ”¶ä¸¦æ›´æ–°ç‹€æ…‹                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ SSE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AI-Box å¾Œç«¯                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Chat API (chat_product_stream)                        â”‚  â”‚
â”‚  â”‚ - ç”Ÿæˆ request_id                                     â”‚  â”‚
â”‚  â”‚ - è¿”å› X-Request-ID header                             â”‚  â”‚
â”‚  â”‚ - èª¿ç”¨ _publish_status_internal() ç™¼é€ç‹€æ…‹             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                       â†‘                          â”‚
â”‚           â”‚                       â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Agent Status API (agent_status.py)                    â”‚  â”‚
â”‚  â”‚ - SSE ç‹€æ…‹æµç«¯é» (/stream/{request_id})               â”‚  â”‚
â”‚  â”‚ - ç®¡ç†è¨‚é–±è€… (_agent_status_subscribers)              â”‚  â”‚
â”‚  â”‚ - æ¨é€ç‹€æ…‹äº‹ä»¶çµ¦è¨‚é–±è€…                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                       â†‘                          â”‚
â”‚           â”‚                       â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Task Analyzer / Orchestrator / Agent                   â”‚  â”‚
â”‚  â”‚ - åœ¨é—œéµæ­¥é©Ÿèª¿ç”¨ _publish_status_internal()             â”‚  â”‚
â”‚  â”‚ - ç™¼é€è™•ç†é€²åº¦                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•¸æ“šæµ

```
ç”¨æˆ¶ç™¼é€æ¶ˆæ¯
    â†“
Home.tsx ç”Ÿæˆ request_id (UUID)
    â†“
å‰ç«¯å»ºç«‹ SSE é€£æ¥åˆ° /api/v1/agent-status/stream/{request_id}
    â†“
å‰ç«¯èª¿ç”¨ /api/v1/agent-status/start
    â†“
AI åŸ·è¡Œéç¨‹ä¸­ç™¼å¸ƒç‹€æ…‹äº‹ä»¶
    â”œâ”€ Chat API: æ¥æ”¶è«‹æ±‚ â†’ å¿«é€Ÿè·¯å¾‘æª¢æ¸¬ â†’ Task Analyzer â†’ ...
    â”œâ”€ Task Analyzer: L1 èªç¾©ç†è§£ â†’ L2 æ„åœ–æŠ½è±¡ â†’ L3 ä»»å‹™è¦åŠƒ â†’ ...
    â”œâ”€ Orchestrator: Agent é¸æ“‡ â†’ ä»»å‹™èª¿åº¦ â†’ ...
    â””â”€ Agent: åŸ·è¡Œå·¥å…· â†’ èª¿ç”¨ LLM â†’ ...
    â†“
å‰ç«¯é€šé SSE æ¥æ”¶ç‹€æ…‹äº‹ä»¶
    â†“
aiStatusStore æ›´æ–° events[]
    â†“
AIStatusWindow é‡æ–°æ¸²æŸ“ï¼Œé¡¯ç¤ºæœ€æ–°ç‹€æ…‹
```

### é—œéµè¨­è¨ˆæ±ºç­–

**æ™‚åºå•é¡Œ**ï¼šSSE é€£æ¥å¿…é ˆåœ¨èª¿ç”¨ `/api/v1/agent-status/start` ä¹‹å‰å»ºç«‹

```
éŒ¯èª¤æ™‚åºï¼š
1. Home.tsx ç”Ÿæˆ request_id
2. Home.tsx èª¿ç”¨ /api/v1/agent-status/start â† å¤±æ•—ï¼šqueue ä¸å­˜åœ¨
3. Home.tsx å»ºç«‹ SSE é€£æ¥ â† å»¶é²

æ­£ç¢ºæ™‚åºï¼š
1. Home.tsx ç”Ÿæˆ request_id
2. Home.tsx å»ºç«‹ SSE é€£æ¥
3. Home.tsx èª¿ç”¨ /api/v1/agent-status/start â† æˆåŠŸï¼šqueue å·²å­˜åœ¨
```

---

## ğŸ§© çµ„ä»¶èªªæ˜

### 1. BrainIconï¼ˆå‘¼å¸å¤§è…¦åœ–æ¨™ï¼‰

**æ–‡ä»¶ä½ç½®**: `ai-bot/src/components/BrainIcon/BrainIcon.tsx`

**åŠŸèƒ½**:
- é¡¯ç¤ºå¸¶å‘¼å¸å‹•ç•«çš„å¤§è…¦åœ–æ¨™
- æ ¹æ“šç•¶å‰ç‹€æ…‹é¡¯ç¤ºä¸åŒé¡è‰²å’Œå‹•ç•«
- é»æ“Šæ™‚åˆ‡æ›è¦–çª—é–‹å•Ÿ/é—œé–‰

**ç‹€æ…‹**:

| ç‹€æ…‹ | é¡è‰² | å‹•ç•« | åœ–æ¨™ |
| ---- | ---- | ---- | ---- |
| idle | #666 | ç„¡ | è…¦éƒ¨åœ–æ¨™ |
| processing | #52c41a | å‘¼å¸å‹•ç•«ï¼ˆ2s é€±æœŸï¼‰ | è…¦éƒ¨åœ–æ¨™ |
| completed | #1890ff | ç„¡ | è…¦éƒ¨åœ–æ¨™ |
| error | #ff4d4f | ç„¡ | è…¦éƒ¨åœ–æ¨™ |

**å‘¼å¸å‹•ç•«**:
```css
@keyframes breathe {
  0%, 100% {
    color: #52c41a;
    opacity: 1;
  }
  50% {
    color: #999;
    opacity: 0.6;
  }
}
```

---

### 2. AIStatusWindowï¼ˆåŸ·è¡Œç‹€æ…‹è¦–çª—ï¼‰

**æ–‡ä»¶ä½ç½®**: `ai-bot/src/components/AIStatusWindow/AIStatusWindow.tsx`

**åŠŸèƒ½**:
- é¡¯ç¤º AI åŸ·è¡Œéç¨‹ä¸­çš„æ‰€æœ‰æ­¥é©Ÿ
- å¯¦æ™‚æ›´æ–°ç‹€æ…‹
- æ”¯æŒæ»¾å‹•æŸ¥çœ‹æ­·å²è¨˜éŒ„
- é¡¯ç¤ºé€£æ¥ç‹€æ…‹

**è¦–çª—çµæ§‹**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI åŸ·è¡Œç‹€æ…‹                    [X]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è™•ç†ä¸­] ğŸ• èªç¾©ç†è§£              â”‚
â”‚  â”‚ æ­£åœ¨é€²è¡Œèªç¾©åˆ†æ...            â”‚
â”‚  â”‚ 10:30:15                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å®Œæˆ] âœ… æ„åœ–åˆ†æ               â”‚
â”‚  â”‚ æª¢æ¸¬åˆ°çŸ¥è­˜åº«æŸ¥è©¢             â”‚
â”‚  â”‚ 10:30:16                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [è™•ç†ä¸­] ğŸ• ä»»å‹™è¦åŠƒ             â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%                 â”‚
â”‚  â”‚ 10:30:17                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         [â—] å·²é€£ç·š                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. aiStatusStoreï¼ˆç‹€æ…‹ç®¡ç†ï¼‰

**æ–‡ä»¶ä½ç½®**: `ai-bot/src/stores/aiStatusStore.ts`

**ç‹€æ…‹çµæ§‹**:
```typescript
interface AIStatusState {
  isWindowOpen: boolean;           // è¦–çª—æ˜¯å¦é–‹å•Ÿ
  toggleWindow: () => void;        // åˆ‡æ›è¦–çª—
  closeWindow: () => void;         // é—œé–‰è¦–çª—
  openWindow: () => void;          // é–‹å•Ÿè¦–çª—
  currentStatus: AIStatusType;     // ç•¶å‰ç‹€æ…‹
  setCurrentStatus: (status) => void;
  events: AIStatusEvent[];         // äº‹ä»¶åˆ—è¡¨ï¼ˆæœ€å¤š 50 æ¢ï¼‰
  addEvent: (event) => void;       // æ·»åŠ äº‹ä»¶
  clearEvents: () => void;         // æ¸…ç©ºäº‹ä»¶
  requestId: string | null;        // ç•¶å‰è«‹æ±‚ ID
  setRequestId: (id) => void;      // è¨­ç½®è«‹æ±‚ ID
  isConnected: boolean;            // æ˜¯å¦å·²é€£ç·š
  setIsConnected: (connected) => void;
}
```

**äº‹ä»¶é¡å‹**:
```typescript
interface AIStatusEvent {
  request_id: string;    // è«‹æ±‚ ID
  step: string;          // ç•¶å‰æ­¥é©Ÿåç¨±
  status: AIStatusType;  // ç‹€æ…‹
  message: string;       // ç‹€æ…‹æè¿°
  progress: number;      // é€²åº¦ 0-1
  timestamp: string;     // æ™‚é–“æˆ³
}
```

---

### 4. useAIStatusSSEï¼ˆSSE Hookï¼‰

**æ–‡ä»¶ä½ç½®**: `ai-bot/src/hooks/useAIStatusSSE.ts`

**åŠŸèƒ½**:
- ç®¡ç† SSE é€£æ¥
- æ¥æ”¶ç‹€æ…‹äº‹ä»¶ä¸¦æ›´æ–° store
- è‡ªå‹•é‡é€£æ©Ÿåˆ¶

**é€£æ¥é‚è¼¯**:
```typescript
useEffect(() => {
  if (isWindowOpen && requestId) {
    clearEvents();
    disconnect(); // æ–·é–‹èˆŠé€£æ¥
    connect();    // å»ºç«‹æ–°é€£æ¥
  }

  return () => {
    disconnect();
  };
}, [isWindowOpen, requestId]);
```

---

## ğŸ”Œ API æ¥å£

### 1. Agent Status APIï¼ˆç‹€æ…‹è¿½è¹¤æ¥å£ï¼‰

#### 1.1 é–‹å§‹è¿½è¹¤

**ç«¯é»**: `POST /api/v1/agent-status/start`

**è«‹æ±‚**:
```json
{
  "request_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

**éŸ¿æ‡‰**:
```json
{
  "status": "started",
  "request_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

---

#### 1.2 ç™¼é€ç‹€æ…‹äº‹ä»¶

**ç«¯é»**: `POST /api/v1/agent-status/event`

**è«‹æ±‚**:
```json
{
  "request_id": "550e8400-e29b-41d4-a716-446655440000",
  "step": "èªç¾©ç†è§£",
  "status": "processing",
  "message": "æ­£åœ¨é€²è¡Œèªç¾©åˆ†æ",
  "progress": 0.5
}
```

**éŸ¿æ‡‰**:
```json
{
  "status": "published",
  "request_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

---

#### 1.3 SSE ç‹€æ…‹æµ

**ç«¯é»**: `GET /api/v1/agent-status/stream/{request_id}`

**éŸ¿æ‡‰ Headers**:
```
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive
X-Accel-Buffering: no
Access-Control-Allow-Origin: *
```

**éŸ¿æ‡‰ Bodyï¼ˆSSE Streamï¼‰**:
```
data: {"request_id": "...", "step": "æ¥æ”¶è«‹æ±‚", "status": "processing", "message": "æ”¶åˆ°ç”¨æˆ¶è«‹æ±‚ï¼Œé–‹å§‹è™•ç†", "progress": 0.0, "timestamp": "2026-02-04T10:30:15.000Z"}

data: {"request_id": "...", "step": "å¿«é€Ÿè·¯å¾‘æª¢æ¸¬", "status": "processing", "message": "æª¢æ¸¬åˆ°æ™‚é–“æŸ¥è©¢ï¼Œä½¿ç”¨å¿«é€Ÿè·¯å¾‘", "progress": 0.1, "timestamp": "2026-02-04T10:30:16.000Z"}

data: {"request_id": "...", "step": "Task Analyzer", "status": "processing", "message": "é–‹å§‹ä»»å‹™åˆ†æï¼ˆL1-L5ï¼‰", "progress": 0.3, "timestamp": "2026-02-04T10:30:17.000Z"}

data: {"request_id": "...", "step": "L1 èªç¾©ç†è§£", "status": "completed", "message": "èªç¾©ç†è§£å®Œæˆï¼Œè­˜åˆ¥åˆ°çŸ¥è­˜åº«æŸ¥è©¢æ„åœ–", "progress": 0.4, "timestamp": "2026-02-04T10:30:18.000Z"}
```

**å¿ƒè·³**ï¼ˆæ¯ 5 ç§’ï¼‰:
```
data: {"request_id": "...", "step": "heartbeat", "status": "processing", "message": "AI æ­£åœ¨è™•ç†...", "progress": 0, "timestamp": "..."}
```

---

#### 1.4 çµæŸè¿½è¹¤

**ç«¯é»**: `POST /api/v1/agent-status/end`

**è«‹æ±‚**:
```json
{
  "request_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

---

## ğŸ“Š äº‹ä»¶æ ¼å¼èˆ‡åŸ·è¡Œæ­¥é©Ÿå®šç¾©

### AI åŸ·è¡Œç‹€æ…‹äº‹ä»¶

```typescript
interface AIStatusEvent {
  request_id: string;      // è«‹æ±‚ ID
  step: string;            // ç•¶å‰æ­¥é©Ÿåç¨±
  status: AIStatusType;    // ç‹€æ…‹
  message: string;         // ç‹€æ…‹æè¿°
  progress: number;        // é€²åº¦ 0-1
  timestamp: string;        // ISO 8601 æ™‚é–“æˆ³
}
```

**ç‹€æ…‹èªªæ˜**:

| status | èªªæ˜ | é¡¯ç¤ºåœ–æ¨™ |
| ------ | ---- | -------- |
| processing | è™•ç†ä¸­ | ğŸ• |
| completed | å®Œæˆ | âœ… |
| error | éŒ¯èª¤ | âš ï¸ |

---

### åŸ·è¡Œæ­¥é©Ÿå®šç¾©

#### Chat API æ ¸å¿ƒæ­¥é©Ÿ

| Step | èªªæ˜ | é€²åº¦ | ä½ç½® |
| ---- | ---- | ---- | ---- |
| æ¥æ”¶è«‹æ±‚ | æ”¶åˆ°ç”¨æˆ¶è«‹æ±‚ï¼Œé–‹å§‹è™•ç† | 0.0 | chat.py:2799 |
| å¿«é€Ÿè·¯å¾‘æª¢æ¸¬ | æª¢æ¸¬æ˜¯å¦ç‚ºå¿«é€Ÿè·¯å¾‘ï¼ˆæ™‚é–“æŸ¥è©¢ï¼‰ | 0.1 | chat.py:2876 |
| Task Analyzer | åŸ·è¡Œä»»å‹™åˆ†æï¼ˆL1-L5ï¼‰ | 0.3 | chat.py:2922 |
| L1 èªç¾©ç†è§£ | Router LLM é€²è¡Œèªç¾©åˆ†æ | 0.35 | âŒ å¾…å¯¦ä½œ |
| L2 æ„åœ–æŠ½è±¡ | Intent Matcher åŒ¹é…æ„åœ– | 0.45 | âŒ å¾…å¯¦ä½œ |
| L3 ä»»å‹™è¦åŠƒ | Task Planner ç”Ÿæˆä»»å‹™ DAG | 0.55 | âŒ å¾…å¯¦ä½œ |
| L4 ç´„æŸé©—è­‰ | Policy Service é©—è­‰ç´„æŸ | 0.65 | âŒ å¾…å¯¦ä½œ |
| L5 åŸ·è¡Œè§€å¯Ÿ | è¨˜éŒ„åŸ·è¡ŒæŒ‡æ¨™ | 0.75 | âŒ å¾…å¯¦ä½œ |
| è·¯ç”±æ±ºç­– | Task Analyzer å®Œæˆï¼Œè¿”å›è·¯ç”±æ±ºç­– | 0.8 | âŒ å¾…å¯¦ä½œ |
| Agent åŸ·è¡Œ | Agent åŸ·è¡Œå…·é«”ä»»å‹™ | 0.85 | âŒ å¾…å¯¦ä½œ |
| å·¥å…·èª¿ç”¨ | èª¿ç”¨å¤–éƒ¨å·¥å…·ï¼ˆMCP/WebSearchï¼‰ | 0.88 | âŒ å¾…å¯¦ä½œ |
| MoE èª¿ç”¨ | èª¿ç”¨ MoE ç”Ÿæˆå›æ‡‰ | 0.9 | âŒ å¾…å¯¦ä½œ |
| ä¸Šä¸‹æ–‡æª¢ç´¢ | æª¢ç´¢ç›¸é—œä¸Šä¸‹æ–‡ | 0.92 | âŒ å¾…å¯¦ä½œ |
| ç”Ÿæˆå›æ‡‰ | ç”Ÿæˆæœ€çµ‚å›æ‡‰ | 0.95 | âŒ å¾…å¯¦ä½œ |
| å®Œæˆè™•ç† | è™•ç†å®Œæˆ | 1.0 | âŒ å¾…å¯¦ä½œ |

---

#### è©³ç´°æ­¥é©Ÿèªªæ˜

**æ¥æ”¶è«‹æ±‚**ï¼ˆprogress=0.0ï¼‰
```
æ”¶åˆ°ç”¨æˆ¶è«‹æ±‚ï¼Œé–‹å§‹è™•ç†
- è¨˜éŒ„ request_id
- åˆå§‹åŒ–ç‹€æ…‹è¿½è¹¤
- æº–å‚™åŸ·è¡Œç’°å¢ƒ
```

**å¿«é€Ÿè·¯å¾‘æª¢æ¸¬**ï¼ˆprogress=0.1ï¼‰
```
æª¢æ¸¬åˆ°æ™‚é–“æŸ¥è©¢ï¼Œä½¿ç”¨å¿«é€Ÿè·¯å¾‘
- æª¢æ¸¬æ™‚é–“ç›¸é—œé—œéµè©
- å¦‚æœæ˜¯æ™‚é–“æŸ¥è©¢ï¼Œèª¿ç”¨ DateTimeTool
- è¿”å›çµæœï¼Œä¸é€²å…¥ Task Analyzer
```

**Task Analyzer L1 èªç¾©ç†è§£**ï¼ˆprogress=0.35ï¼‰
```
Router LLM é€²è¡Œèªç¾©åˆ†æ
- èª¿ç”¨ Router LLM
- åˆ†æç”¨æˆ¶æ„åœ–
- æå–é—œéµè©å’Œå¯¦é«”
```

**Task Analyzer L2 æ„åœ–æŠ½è±¡**ï¼ˆprogress=0.45ï¼‰
```
Intent Matcher åŒ¹é…æ„åœ–
- åŒ¹é…é å®šç¾©æ„åœ–æ¨¡æ¿
- è­˜åˆ¥ä»»å‹™é¡å‹ï¼ˆæŸ¥è©¢/å‰µå»º/ç·¨è¼¯/åŸ·è¡Œï¼‰
- é¸æ“‡æœ€ä½³æ„åœ–
```

**Task Analyzer L3 ä»»å‹™è¦åŠƒ**ï¼ˆprogress=0.55ï¼‰
```
Task Planner ç”Ÿæˆä»»å‹™ DAG
- åˆ†è§£ä»»å‹™ç‚ºå­ä»»å‹™
- ç¢ºå®šä»»å‹™ä¾è³´é—œä¿‚
- è¦åŠƒåŸ·è¡Œé †åº
```

**Task Analyzer L4 ç´„æŸé©—è­‰**ï¼ˆprogress=0.65ï¼‰
```
Policy Service é©—è­‰ç´„æŸ
- æª¢æŸ¥ç”¨æˆ¶æ¬Šé™
- é©—è­‰ä»»å‹™ç´„æŸ
- ç¢ºèªè³‡æºå¯ç”¨æ€§
```

**Task Analyzer L5 åŸ·è¡Œè§€å¯Ÿ**ï¼ˆprogress=0.75ï¼‰
```
è¨˜éŒ„åŸ·è¡ŒæŒ‡æ¨™
- è¨˜éŒ„é–‹å§‹æ™‚é–“
- åˆå§‹åŒ–æ€§èƒ½è¨ˆæ•¸å™¨
- è¨­ç½®ç›£æ§æ¨™èªŒ
```

**è·¯ç”±æ±ºç­–**ï¼ˆprogress=0.8ï¼‰
```
Task Analyzer å®Œæˆï¼Œè¿”å›è·¯ç”±æ±ºç­–
- é¸æ“‡çš„ Agentï¼ˆå¦‚æœæœ‰ï¼‰
- é¸æ“‡çš„ Toolsï¼ˆå¦‚æœæœ‰ï¼‰
- é¸æ“‡çš„ Model
```

**Agent åŸ·è¡Œ**ï¼ˆprogress=0.85ï¼‰
```
Agent åŸ·è¡Œå…·é«”ä»»å‹™
- åˆå§‹åŒ– Agent
- åŸ·è¡Œ Agent é‚è¼¯
- ç²å– Agent çµæœ
```

**å·¥å…·èª¿ç”¨**ï¼ˆprogress=0.88ï¼‰
```
èª¿ç”¨å¤–éƒ¨å·¥å…·
- MCP å·¥å…·èª¿ç”¨
- WebSearch å·¥å…·èª¿ç”¨
- DateTime å·¥å…·èª¿ç”¨
```

**MoE èª¿ç”¨**ï¼ˆprogress=0.9ï¼‰
```
èª¿ç”¨ MoE ç”Ÿæˆå›æ‡‰
- é¸æ“‡åˆé©çš„ Model
- æ§‹å»º Prompt
- èª¿ç”¨ LLM
```

**ä¸Šä¸‹æ–‡æª¢ç´¢**ï¼ˆprogress=0.92ï¼‰
```
æª¢ç´¢ç›¸é—œä¸Šä¸‹æ–‡
- å¾ Context Manager ç²å–æ­·å²
- å¾ Memory Service æª¢ç´¢ç›¸é—œè¨˜æ†¶
- å¾å‘é‡æ•¸æ“šåº«æª¢ç´¢ç›¸é—œæ–‡æª”
```

**ç”Ÿæˆå›æ‡‰**ï¼ˆprogress=0.95ï¼‰
```
ç”Ÿæˆæœ€çµ‚å›æ‡‰
- è™•ç† LLM è¼¸å‡º
- æ ¼å¼åŒ–å›æ‡‰å…§å®¹
- æº–å‚™æµå¼è¼¸å‡º
```

**å®Œæˆè™•ç†**ï¼ˆprogress=1.0ï¼‰
```
è™•ç†å®Œæˆ
- æ¸…ç†è³‡æº
- è¨˜éŒ„å®Œæˆç‹€æ…‹
- ç™¼é€å®Œæˆäº‹ä»¶
```

---

## ğŸ¨ é¡¯ç¤ºè¦ç¯„

### 1. BrainIcon è¦ç¯„

**ä½ç½®**:
- ChatInput å·¥å…·æ¬„å³å´
- å›ºå®šå¤§å°ï¼š40x40 px

**é¡è‰²æ–¹æ¡ˆ**:

| ç‹€æ…‹ | ä¸»è‰² | èƒŒæ™¯è‰² | é‚Šæ¡†è‰² |
| ---- | ---- | ------ | ------ |
| idle | #666 | #f5f5f5 | transparent |
| processing | #52c41a | #f5f5f5 | transparent |
| completed | #1890ff | #f5f5f5 | transparent |
| error | #ff4d4f | #f5f5f5 | transparent |

---

### 2. AIStatusWindow è¦ç¯„

**å°ºå¯¸**:
- å¯¬åº¦ï¼š400 px
- æœ€å°é«˜åº¦ï¼š200 px
- æœ€å¤§é«˜åº¦ï¼š600 pxï¼ˆè¶…å‡ºæ»¾å‹•ï¼‰

**å‹•ç•«**:
- æ·¡å…¥æ·¡å‡ºï¼š0.2s easeOut
- æ»‘å…¥ï¼šå¾ä¸‹å¾€ä¸Šï¼Œ10px
- ç¸®æ”¾ï¼š0.95 â†’ 1

**å…¨å±€é€²åº¦æ¢**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¸½é€²åº¦                    35%          â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ€§èƒ½çµ±è¨ˆ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â±ï¸ ç¸½è€—æ™‚: 2.3s    âš¡ æ­¥é©Ÿæ•¸: 5        â”‚
â”‚ ğŸ¢ æœ€è€—æ™‚: Agent åŸ·è¡Œ (1.5s)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº‹ä»¶åˆ—è¡¨é …**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ…] æ„åœ–åˆ†æ                            â”‚
â”‚      æª¢æ¸¬åˆ°çŸ¥è­˜åº«æŸ¥è©¢                    â”‚
â”‚      10:30:16        +520ms            â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é€²åº¦æ¢**:
```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%
```
- é«˜åº¦ï¼š4px
- é¡è‰²ï¼š#1890ff
- èƒŒæ™¯è‰²ï¼š#e8e8e8
- å‹•ç•«ï¼š0.2s ease

**è€—æ™‚è¦–è¦ºåŒ–æ¢**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ…] æ„åœ–åˆ†æ                            â”‚
â”‚      æª¢æ¸¬åˆ°çŸ¥è­˜åº«æŸ¥è©¢                    â”‚
â”‚      10:30:16        +520ms            â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80%  â† åº•éƒ¨è€—æ™‚è¦–è¦ºåŒ–æ¢     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“– ä½¿ç”¨å ´æ™¯

### å ´æ™¯ 1ï¼šæ­£å¸¸èŠå¤©æµç¨‹

```
ç”¨æˆ¶ï¼šå‘Šè¨´æˆ‘ä½ çš„è·è²¬
    â†“
BrainIcon: ç‹€æ…‹ â†’ processingï¼ˆå‘¼å¸å‹•ç•«ï¼‰
    â†“
AIStatusWindow: é¡¯ç¤ºåŸ·è¡Œæ­¥é©Ÿ
    - [è™•ç†ä¸­] ğŸ• æ¥æ”¶è«‹æ±‚
    - [è™•ç†ä¸­] ğŸ• å¿«é€Ÿè·¯å¾‘æª¢æ¸¬
    - [è™•ç†ä¸­] ğŸ• Task Analyzer
    - [è™•ç†ä¸­] ğŸ• L1 èªç¾©ç†è§£
    - [è™•ç†ä¸­] ğŸ• L2 æ„åœ–æŠ½è±¡
    - [è™•ç†ä¸­] ğŸ• L3 ä»»å‹™è¦åŠƒ
    - [è™•ç†ä¸­] ğŸ• L4 ç´„æŸé©—è­‰
    - [è™•ç†ä¸­] ğŸ• L5 åŸ·è¡Œè§€å¯Ÿ
    - [è™•ç†ä¸­] ğŸ• è·¯ç”±æ±ºç­–
    - [è™•ç†ä¸­] ğŸ• MoE èª¿ç”¨
    - [è™•ç†ä¸­] ğŸ• ç”Ÿæˆå›æ‡‰
    - [å®Œæˆ] âœ… å®Œæˆè™•ç†
    â†“
BrainIcon: ç‹€æ…‹ â†’ completed
```

### å ´æ™¯ 2ï¼šAgent åŸ·è¡Œ

```
ç”¨æˆ¶ï¼šæŸ¥è©¢æ–™è™Ÿ A12345 çš„åº«å­˜
    â†“
BrainIcon: ç‹€æ…‹ â†’ processing
    â†“
AIStatusWindow:
    - [è™•ç†ä¸­] ğŸ• æ¥æ”¶è«‹æ±‚
    - [è™•ç†ä¸­] ğŸ• å¿«é€Ÿè·¯å¾‘æª¢æ¸¬
    - [è™•ç†ä¸­] ğŸ• Task Analyzer
    - [è™•ç†ä¸­] ğŸ• L1 èªç¾©ç†è§£
    - [è™•ç†ä¸­] ğŸ• L2 æ„åœ–æŠ½è±¡
    - [è™•ç†ä¸­] ğŸ• L3 ä»»å‹™è¦åŠƒ
    - [è™•ç†ä¸­] ğŸ• è·¯ç”±æ±ºç­– â†’ é¸æ“‡ ka-agent
    - [è™•ç†ä¸­] ğŸ• Agent åŸ·è¡Œ â†’ ka-agent
    - [è™•ç†ä¸­] ğŸ• å·¥å…·èª¿ç”¨ â†’ mm_execute_task
    - [è™•ç†ä¸­] ğŸ• MoE èª¿ç”¨
    - [å®Œæˆ] âœ… å®Œæˆè™•ç†
    â†“
BrainIcon: ç‹€æ…‹ â†’ completed
```

### å ´æ™¯ 3ï¼šéŒ¯èª¤è™•ç†

```
ç”¨æˆ¶ï¼šæŸ¥è©¢ä¸å­˜åœ¨çš„æ–‡ä»¶
    â†“
BrainIcon: ç‹€æ…‹ â†’ processing
    â†“
AIStatusWindow:
    - [è™•ç†ä¸­] ğŸ• æ¥æ”¶è«‹æ±‚
    - [è™•ç†ä¸­] ğŸ• èªç¾©ç†è§£
    - [è™•ç†ä¸­] ğŸ• æ„åœ–åˆ†æ
    - [éŒ¯èª¤] âš ï¸ æ–‡ä»¶ä¸å­˜åœ¨
    â†“
BrainIcon: ç‹€æ…‹ â†’ error
```

---

## ğŸ”§ å¯¦æ–½è¨ˆåŠƒ

### Phase 1ï¼šä¿®å¾©ç¾æœ‰å•é¡Œï¼ˆå·²å®Œæˆï¼‰âœ…

1. **æ™‚åºå•é¡Œä¿®å¾©** âœ…
   - [x] Home.tsx: SSE é€£æ¥åœ¨ `/api/v1/agent-status/start` ä¹‹å‰å»ºç«‹
   - [x] ç¢ºä¿ request_id ä¸€è‡´æ€§

2. **ç¾æœ‰äº‹ä»¶å®Œå–„** âœ…
   - [x] chat.py: æ·»åŠ æ›´å¤šç‹€æ…‹ç™¼å¸ƒé»
   - [x] ç¢ºä¿å¿ƒè·³æ­£å¸¸é‹ä½œ

---

### Phase 2ï¼šå®Œæ•´ç‹€æ…‹æ¨é€ï¼ˆå·²å®Œæˆï¼‰âœ…

1. **Task Analyzer æ­¥é©Ÿ** âœ…
   - [x] L1 èªç¾©ç†è§£ï¼šèª¿ç”¨ Router LLM å‰ç™¼é€
   - [x] è·¯ç”±æ±ºç­–ï¼šTask Analyzer å®Œæˆå¾Œç™¼é€

2. **Agent åŸ·è¡Œ** âœ…
   - [x] Agent é–‹å§‹åŸ·è¡Œæ™‚ç™¼é€
   - [x] Agent å®Œæˆå¾Œç™¼é€

3. **MoE èª¿ç”¨** âœ…
   - [x] MoE é–‹å§‹æ™‚ç™¼é€
   - [x] MoE å®Œæˆå¾Œç™¼é€

4. **å®Œæˆè™•ç†** âœ…
   - [x] Stream çµæŸæ™‚ç™¼é€å®Œæˆç‹€æ…‹

---

### Phase 3ï¼šå®Œå–„é¡¯ç¤ºï¼ˆå·²å®Œæˆï¼‰âœ…

1. **å…¨å±€é€²åº¦æ¢** âœ…
   - [x] é ‚éƒ¨é¡¯ç¤ºç¸½é€²åº¦ç™¾åˆ†æ¯”
   - [x] é€²åº¦æ¢è¦–è¦ºåŒ–é¡¯ç¤º

2. **æ€§èƒ½çµ±è¨ˆ** âœ…
   - [x] é¡¯ç¤ºç¸½è€—æ™‚
   - [x] é¡¯ç¤ºæ­¥é©Ÿæ•¸
   - [x] æ¨™è¨˜æœ€è€—æ™‚çš„æ­¥é©Ÿ

3. **æ™‚é–“ç·š** âœ…
   - [x] é¡¯ç¤ºæ¯å€‹æ­¥é©Ÿçš„åŸ·è¡Œæ™‚é–“
   - [x] é¡¯ç¤ºè€—æ™‚å¢é‡ï¼ˆ+520msï¼‰
   - [x] è€—æ™‚è¦–è¦ºåŒ–æ¢

4. **è«‹æ±‚ ID é¡¯ç¤º** âœ…
   - [x] Footer é¡¯ç¤ºè«‹æ±‚ IDï¼ˆæˆªæ–·é¡¯ç¤ºï¼‰

---

### Phase 4ï¼šå¾…å¯¦ä½œï¼ˆæœªä¾†æ“´å±•ï¼‰

1. **æ›´è©³ç´°çš„æ­¥é©Ÿ**
   - [ ] L2 æ„åœ–æŠ½è±¡ï¼šIntent Matcher å®Œæˆå¾Œç™¼é€
   - [ ] L3 ä»»å‹™è¦åŠƒï¼šTask Planner å®Œæˆå¾Œç™¼é€
   - [ ] L4 ç´„æŸé©—è­‰ï¼šPolicy Service é©—è­‰å¾Œç™¼é€
   - [ ] L5 åŸ·è¡Œè§€å¯Ÿï¼šè¨˜éŒ„æŒ‡æ¨™å¾Œç™¼é€
   - [ ] å·¥å…·èª¿ç”¨ç‹€æ…‹

2. **Agent å·¥å…·èª¿ç”¨è¿½è¹¤**
   - [ ] è¿½è¹¤ MCP å·¥å…·èª¿ç”¨
   - [ ] è¿½è¹¤ WebSearch å·¥å…·èª¿ç”¨
   - [ ] è¿½è¹¤æ–‡ä»¶æ“ä½œå·¥å…·èª¿ç”¨

3. **ä¸Šä¸‹æ–‡æª¢ç´¢è¿½è¹¤**
   - [ ] è¿½è¹¤ Memory Service æª¢ç´¢
   - [ ] è¿½è¹¤å‘é‡æ•¸æ“šåº«æª¢ç´¢

4. **æ€§èƒ½åˆ†æ**
   - [ ] è¨ˆç®—æ¯å€‹æ­¥é©Ÿè€—æ™‚ç™¾åˆ†æ¯”
   - [ ] æ¨™è¨˜æ€§èƒ½ç“¶é ¸ï¼ˆ>500msï¼‰
   - [ ] æä¾›å„ªåŒ–å»ºè­°

5. **UI æ”¹é€²**
   - [ ] æ·»åŠ é€²åº¦å‹•ç•«
   - [ ] æ”¯æŒå±•é–‹/æ”¶èµ·è©³ç´°ä¿¡æ¯
   - [ ] æ·»åŠ æœç´¢/éæ¿¾åŠŸèƒ½
   - [ ] æª¢ç´¢é–‹å§‹æ™‚ç™¼é€
   - [ ] æª¢ç´¢å®Œæˆå¾Œç™¼é€

---

### Phase 3ï¼šå®Œå–„é¡¯ç¤º

1. **é€²åº¦æ¢**
   - [ ] æ·»åŠ å…¨å±€é€²åº¦æ¢
   - [ ] é¡¯ç¤ºç•¶å‰æ­¥é©Ÿé€²åº¦

2. **æ™‚é–“ç·š**
   - [ ] é¡¯ç¤ºæ¯å€‹æ­¥é©Ÿçš„åŸ·è¡Œæ™‚é–“
   - [ ] æ¨™è¨˜é—œéµè·¯å¾‘

3. **æ€§èƒ½åˆ†æ**
   - [ ] è¨ˆç®—æ¯å€‹æ­¥é©Ÿè€—æ™‚
   - [ ] æ¨™è¨˜æ€§èƒ½ç“¶é ¸

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [èªç¾©èˆ‡ä»»å‹™åˆ†æè©³ç´°èªªæ˜](./èªç¾©èˆ‡ä»»å‹™åˆ†æè©³ç´°èªªæ˜.md)
- [KA-Agent æˆæ¬Šç®¡ç†æ–‡æª”](./KA-Agentæˆæ¬Šç®¡ç†æ–‡æª”.md)
- [Agent Registry èªªæ˜](./Agent%20Registry%20èªªæ˜.md)
- [å‰ç«¯çµ„ä»¶é–‹ç™¼è¦ç¯„](./å‰ç«¯çµ„ä»¶é–‹ç™¼è¦ç¯„.md)

---

**æ–‡æª”ç‰ˆæœ¬**: v1.2
**æœ€å¾Œæ›´æ–°**: 2026-02-04
**ç¶­è­·äºº**: Daniel Chung

---

## ğŸ“ ä¿®æ”¹è¨˜éŒ„

### 2026-02-04 - v1.2 æ›´æ–°

#### ä¸»è¦è®Šæ›´

1. **æ·»åŠ  Phase 2ï¼šå®Œæ•´ç‹€æ…‹æ¨é€**
   - è©³ç´°å®šç¾© Task Analyzer L1-L5 æ­¥é©Ÿ
   - å®šç¾© Agent åŸ·è¡Œæ­¥é©Ÿ
   - å®šç¾© MoE èª¿ç”¨æ­¥é©Ÿ
   - å®šç¾©ä¸Šä¸‹æ–‡æª¢ç´¢æ­¥é©Ÿ

2. **æ·»åŠ æ™‚åºå•é¡Œèªªæ˜**
   - èªªæ˜æ­£ç¢ºçš„ SSE é€£æ¥æ™‚åº
   - èªªæ˜éŒ¯èª¤çš„ SSE é€£æ¥æ™‚åº

3. **æ›´æ–°ä½¿ç”¨å ´æ™¯**
   - æ·»åŠ  Agent åŸ·è¡Œå ´æ™¯
   - è©³ç´°èªªæ˜æ¯å€‹æ­¥é©Ÿçš„ç‹€æ…‹é¡¯ç¤º

#### å¾…å¯¦ä½œé …ç›®

- [ ] L1-L5 è©³ç´°æ­¥é©Ÿç‹€æ…‹æ¨é€
- [ ] Agent åŸ·è¡Œç‹€æ…‹æ¨é€
- [ ] MoE èª¿ç”¨ç‹€æ…‹æ¨é€
- [ ] ä¸Šä¸‹æ–‡æª¢ç´¢ç‹€æ…‹æ¨é€
- [ ] é€²åº¦æ¢å’Œæ™‚é–“ç·šé¡¯ç¤º

---

### 2026-02-03 - v1.1 æ›´æ–°

#### å¾Œç«¯ä¿®æ”¹

**1. Chat API (`api/routers/chat.py`)**
- âœ… å°å…¥ `start_status_tracking`, `publish_status`, `AgentStatusEvent`
- âœ… ç™¼é€ã€Œæ¥æ”¶è«‹æ±‚ã€ç‹€æ…‹äº‹ä»¶ï¼ˆprogress=0.0ï¼‰
- âœ… è¿”å› `X-Request-ID` header
- âœ… ç™¼é€ã€Œå¿«é€Ÿè·¯å¾‘æª¢æ¸¬ã€ç‹€æ…‹äº‹ä»¶ï¼ˆprogress=0.1ï¼‰
- âœ… ç™¼é€ã€ŒTask Analyzer é–‹å§‹ã€ç‹€æ…‹äº‹ä»¶ï¼ˆprogress=0.3ï¼‰

**2. Agent Status API (`api/routers/agent_status.py`)**
- âœ… ç§»é™¤ SSE ç«¯é»çš„èº«ä»½é©—è­‰
- âœ… æ·»åŠ  CORS headers
- âœ… æ·»åŠ  OPTIONS ç«¯é»è™•ç† CORS é æª¢è«‹æ±‚
- âœ… å¿ƒè·³åŠŸèƒ½ï¼ˆæ¯ 5 ç§’ï¼‰

**3. å‰ç«¯çµ„ä»¶**
- âœ… BrainIconï¼ˆå‘¼å¸å¤§è…¦åœ–æ¨™ï¼‰
- âœ… AIStatusWindowï¼ˆåŸ·è¡Œç‹€æ…‹è¦–çª—ï¼‰
- âœ… aiStatusStoreï¼ˆç‹€æ…‹ç®¡ç†ï¼‰
- âœ… useAIStatusSSEï¼ˆSSE Hookï¼‰

**4. API èª¿ç”¨**
- âœ… ä¿®æ”¹ `chatProductStream` è¿”å›å€¼é¡å‹
- âœ… è¿”å› `{ requestId, stream }` å°è±¡

---

## ğŸ› å·²çŸ¥å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œ 1: å‰ç«¯æœªæ”¶åˆ°ç‹€æ…‹äº‹ä»¶

**ç¾è±¡**ï¼š
- SSE é€£æ¥æˆåŠŸï¼ˆonopen è§¸ç™¼ï¼‰
- å¿ƒè·³æ­£å¸¸æ¥æ”¶
- ä½† AI åŸ·è¡Œéç¨‹ä¸­æ²’æœ‰æ”¶åˆ°ç‹€æ…‹äº‹ä»¶

**åŸå› **ï¼š
- chat.py ä¸­åªæœ‰ 3 å€‹ç‹€æ…‹ç™¼å¸ƒé»
- Task Analyzerã€Orchestratorã€Agent åŸ·è¡Œéç¨‹ä¸­æ²’æœ‰ç™¼é€ç‹€æ…‹

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- åœ¨ chat.py ä¸­æ·»åŠ æ›´å¤š `_publish_status_internal()` èª¿ç”¨
- åœ¨ Task Analyzer åŸ·è¡Œéç¨‹ä¸­ç™¼é€ç‹€æ…‹
- åœ¨ Agent åŸ·è¡Œéç¨‹ä¸­ç™¼é€ç‹€æ…‹

---

### å•é¡Œ 2: æ™‚åºå•é¡Œ

**ç¾è±¡**ï¼š
- SSE é€£æ¥åœ¨ `/api/v1/agent-status/start` ä¹‹å¾Œå»ºç«‹
- å°è‡´ queue ä¸å­˜åœ¨ï¼Œç‹€æ…‹äº‹ä»¶ç„¡æ³•æ¨é€

**åŸå› **ï¼š
- Home.tsx ä¸­ SSE é€£æ¥å»ºç«‹æ™‚æ©Ÿä¸æ­£ç¢º

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
```typescript
// éŒ¯èª¤
setRequestId(requestId);
connectAIStatus();           // é€£æ¥ SSE
fetch('/api/v1/agent-status/start'); // å•Ÿå‹•è¿½è¹¤ï¼ˆå¤±æ•—ï¼‰

// æ­£ç¢º
setRequestId(requestId);
connectAIStatus();           // 1. å…ˆé€£æ¥ SSE
fetch('/api/v1/agent-status/start'); // 2. å†å•Ÿå‹•è¿½è¹¤
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### æª¢æŸ¥ SSE é€£æ¥

1. **æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·**ï¼ˆF12ï¼‰

2. **é»æ“Šå‘¼å¸å¤§è…¦åœ–æ¨™**ï¼Œé–‹å•Ÿ AIStatusWindow

3. **æª¢æŸ¥æ§åˆ¶å°è¼¸å‡º**ï¼š
   ```
   [SSE] connect() targetRequestId: xxx
   [SSE] onopen
   [SSE] onmessage: {...}
   ```

4. **æ¸¬è©¦å¾Œç«¯ SSE**ï¼š
   ```bash
   # çµ‚ç«¯ 1ï¼šå•Ÿå‹•è¿½è¹¤
   curl -X POST "http://localhost:8000/api/v1/agent-status/start" \
     -H "Content-Type: application/json" \
     -d '{"request_id": "test-1"}'

   # çµ‚ç«¯ 2ï¼šç›£è½ SSE
   timeout 5 curl -N "http://localhost:8000/api/v1/agent-status/stream/test-1"

   # çµ‚ç«¯ 3ï¼šç™¼é€æ¸¬è©¦äº‹ä»¶
   curl -X POST "http://localhost:8000/api/v1/agent-status/event" \
     -H "Content-Type: application/json" \
     -d '{"request_id": "test-1", "step": "æ¸¬è©¦", "status": "processing", "message": "æ¸¬è©¦æ¶ˆæ¯", "progress": 0.5}'
   ```

---

## âœ… å®Œæˆç‹€æ…‹

### å·²å®Œæˆ âœ…

**1. åŸºç¤è¨­æ–½**
- âœ… å¾Œç«¯ SSE ç«¯é»æ­£å¸¸å·¥ä½œ
- âœ… æœ¬åœ°é€£æ¥æ¸¬è©¦æˆåŠŸ
- âœ… å¿ƒè·³åŠŸèƒ½æ­£å¸¸
- âœ… å‰ç«¯ SSE é€£æ¥æ­£å¸¸

**2. ç‹€æ…‹äº‹ä»¶æ¨é€**
- âœ… æ¥æ”¶è«‹æ±‚ (progress=0.0)
- âœ… å¿«é€Ÿè·¯å¾‘æª¢æ¸¬ (progress=0.1)
- âœ… Task Analyzer é–‹å§‹ (progress=0.3)
- âœ… L1 èªç¾©ç†è§£ (progress=0.35)
- âœ… è·¯ç”±æ±ºç­– (progress=0.8)
- âœ… Agent åŸ·è¡Œ (progress=0.85)
- âœ… MoE èª¿ç”¨ (progress=0.9, 0.95)
- âœ… å®Œæˆè™•ç† (progress=1.0)

**3. å‰ç«¯é¡¯ç¤º**
- âœ… BrainIconï¼ˆå‘¼å¸å¤§è…¦åœ–æ¨™ï¼‰
- âœ… AIStatusWindowï¼ˆåŸ·è¡Œç‹€æ…‹è¦–çª—ï¼‰
- âœ… å…¨å±€é€²åº¦æ¢
- âœ… æ€§èƒ½çµ±è¨ˆï¼ˆç¸½è€—æ™‚ã€æ­¥é©Ÿæ•¸ã€æœ€è€—æ™‚æ­¥é©Ÿï¼‰
- âœ… äº‹ä»¶åˆ—è¡¨ï¼ˆç‹€æ…‹ã€é€²åº¦ã€æ¶ˆæ¯ã€æ™‚é–“æˆ³ï¼‰
- âœ… è€—æ™‚å¢é‡é¡¯ç¤ºï¼ˆ+520msï¼‰
- âœ… è€—æ™‚è¦–è¦ºåŒ–æ¢
- âœ… è«‹æ±‚ ID é¡¯ç¤º

**4. æ™‚åºä¿®å¾©**
- âœ… SSE é€£æ¥åœ¨ `/api/v1/agent-status/start` ä¹‹å‰å»ºç«‹
- âœ… request_id ä¸€è‡´æ€§

### å¾…å¯¦ä½œï¼ˆPhase 4ï¼‰

- â³ L2-L5 è©³ç´°æ­¥é©Ÿç‹€æ…‹æ¨é€
- â³ å·¥å…·èª¿ç”¨è¿½è¹¤ï¼ˆMCPã€WebSearchï¼‰
- â³ ä¸Šä¸‹æ–‡æª¢ç´¢è¿½è¹¤
- â³ æ›´è©³ç´°çš„æ€§èƒ½åˆ†æ
- â³ éŒ¯èª¤è™•ç†å„ªåŒ–
