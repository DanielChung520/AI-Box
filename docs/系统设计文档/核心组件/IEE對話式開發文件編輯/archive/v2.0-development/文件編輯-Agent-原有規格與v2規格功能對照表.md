# 文件編輯 Agent 原有規格與 v2.0 規格功能對照表

**創建日期**: 2026-01-11
**創建人**: Daniel Chung
**最後修改日期**: 2026-01-11

---

## 📋 對照說明

本文檔對比《AI-Box-IEE-式-Markdown-文件編輯器開發規格書.md》（原有規格）與《文件編輯-Agent（Markdown）工程系統規格書-v2.md》（v2.0 規格），確認所有功能需求是否已包含在重構計劃中。

---

## 1. 前端功能對照

| 原有規格功能 | v2.0 規格 | 重構計劃書 | 狀態 | 備註 |
|------------|----------|-----------|------|------|
| **Monaco Editor 集成** | ❌ 未提及（前端範圍外） | ❌ 未包含 | ⚠️ 需補充 | 前端功能，不在 Agent 範圍內，但需確認 API 支持 |
| **IEE 編輯器界面（右側面板）** | ❌ 未提及（前端範圍外） | ❌ 未包含 | ⚠️ 需補充 | 前端功能，但需確認 API 接口支持 |
| **狀態管理與版本暫存（Draft Buffer）** | ❌ 未提及 | ❌ 未包含 | ⚠️ 需補充 | 前端功能，但後端需提供 Draft State API |
| **局部 Diff 渲染與互動** | ❌ 未提及（前端範圍外） | ❌ 未包含 | ⚠️ 需補充 | 前端功能，但需確認 Patch 格式支持 |
| **Mermaid 圖表即時預覽** | ✅ 提及（由專用渲染器處理） | ❌ 未包含 | ⚠️ 需補充 | 前端功能，但需確認 Mermaid 代碼生成支持 |
| **WebSocket/SSE 流式傳輸** | ✅ 提及（Preview 可選） | ✅ 已包含（階段四） | ✅ 已包含 | 在階段四前端整合中已包含 |

---

## 2. 後端核心功能對照

| 原有規格功能 | v2.0 規格 | 重構計劃書 | 狀態 | 備註 |
|------------|----------|-----------|------|------|
| **Search-and-Replace 協議** | ✅ 支持（Text Patch unified diff） | ✅ 已包含（Block Patch → Text Patch） | ✅ 已包含 | v2.0 通過 Block Patch → Text Patch 轉換實現 |
| **串流解析（Streaming Parser）** | ✅ 提及（Preview 流式返回） | ⚠️ 部分包含 | ⚠️ 需補充 | 需明確實現流式 Patch 生成與傳輸 |
| **上下文注入策略** | ✅ 已包含（最小上下文策略） | ✅ 已包含（階段二） | ✅ 已包含 | v2.0 的最小上下文策略更完善 |
| **模糊匹配算法（Fuzzy Matching）** | ❌ 未明確提及 | ❌ 未包含 | ⚠️ 需補充 | 原有規格的重要功能，需補充 |
| **偏移量校準（Anchor Offset Correction）** | ✅ 已包含（版本檢查） | ✅ 已包含（併發編輯） | ✅ 已包含 | v2.0 通過版本檢查實現 |
| **提交與回滾機制（Commit & Rollback）** | ✅ 已包含（版本控制交互） | ⚠️ 部分包含 | ⚠️ 需補充 | 需明確實現 Commit API 和 Rollback 功能 |

---

## 3. 文件處理功能對照

| 原有規格功能 | v2.0 規格 | 重構計劃書 | 狀態 | 備註 |
|------------|----------|-----------|------|------|
| **PDF/Word 轉 Markdown** | ❌ 未提及（OUT OF SCOPE） | ❌ 未包含 | ⚠️ 需補充 | 原有規格的重要功能，但 v2.0 明確為 OUT OF SCOPE |
| **AST 驅動切片** | ✅ 已包含（AST 解析） | ✅ 已包含（階段一） | ✅ 已包含 | v2.0 的 AST 解析更完善 |
| **向量化與知識圖譜集成** | ❌ 未提及（OUT OF SCOPE） | ❌ 未包含 | ⚠️ 需補充 | 原有規格的重要功能，但 v2.0 明確為 OUT OF SCOPE |

---

## 4. 審查與發布功能對照

| 原有規格功能 | v2.0 規格 | 重構計劃書 | 狀態 | 備註 |
|------------|----------|-----------|------|------|
| **AI 智慧變更摘要** | ✅ 已包含（Semantic Patch） | ⚠️ 部分包含 | ⚠️ 需補充 | v2.0 的 Semantic Patch 可提供摘要，但需明確實現 |
| **全局審查模式（Review Mode）** | ❌ 未提及（前端範圍外） | ❌ 未包含 | ⚠️ 需補充 | 前端功能，但後端需提供 Diff API |
| **提交流水線（增量向量化）** | ❌ 未提及（OUT OF SCOPE） | ❌ 未包含 | ⚠️ 需補充 | 原有規格的重要功能，但 v2.0 明確為 OUT OF SCOPE |

---

## 5. 模組化文檔架構對照

| 原有規格功能 | v2.0 規格 | 重構計劃書 | 狀態 | 備註 |
|------------|----------|-----------|------|------|
| **1+N 主從架構** | ❌ 未提及 | ❌ 未包含 | ⚠️ 需補充 | 原有規格的重要功能，需評估是否包含 |
| **智慧鏈接與解構（Transclusion）** | ❌ 未提及 | ❌ 未包含 | ⚠️ 需補充 | 原有規格的重要功能，需評估是否包含 |
| **虛擬合併預覽** | ❌ 未提及（前端範圍外） | ❌ 未包含 | ⚠️ 需補充 | 前端功能，但需確認後端支持 |
| **導出編譯引擎** | ❌ 未提及（OUT OF SCOPE） | ❌ 未包含 | ⚠️ 需補充 | 原有規格的功能，但可能超出 Agent 範圍 |

---

## 6. 其他功能對照

| 原有規格功能 | v2.0 規格 | 重構計劃書 | 狀態 | 備註 |
|------------|----------|-----------|------|------|
| **Token 消耗優化** | ✅ 已包含（最小上下文策略） | ✅ 已包含 | ✅ 已包含 | v2.0 的最小上下文策略更完善 |
| **隱私與資料脫敏** | ✅ 已包含（安全治理） | ✅ 已包含（階段三） | ✅ 已包含 | v2.0 的安全治理更完善 |
| **FIM (Fill-In-the-Middle)** | ❌ 未明確提及 | ❌ 未包含 | ⚠️ 需補充 | 原有規格的功能，需評估是否包含 |
| **多 Agent 協作** | ✅ 已包含（與 Orchestrator 交互） | ✅ 已包含 | ✅ 已包含 | v2.0 明確說明與 Orchestrator 的交互 |

---

## 7. 遺漏功能分析

### 7.1 必須補充的功能（P0）

1. **模糊匹配算法（Fuzzy Matching）**
   - **原因**：原有規格的重要功能，用於處理文件內容微幅變動
   - **位置**：應在階段二的 Target Locator 中實現
   - **實現方式**：當精確匹配失敗時，使用 Levenshtein Distance 或 Bitap 算法進行模糊匹配

2. **流式 Patch 生成與傳輸**
   - **原因**：原有規格要求流式傳輸，v2.0 僅提及 Preview 可選
   - **位置**：應在階段四的前端整合中明確實現
   - **實現方式**：支持 WebSocket/SSE 流式返回 Patch，前端實時渲染

3. **Commit & Rollback API**
   - **原因**：原有規格要求提交與回滾機制
   - **位置**：應在階段四的前端整合中實現
   - **實現方式**：實現 Commit API（提交變更）和 Rollback API（回滾到指定版本）

### 7.2 建議補充的功能（P1）

1. **AI 智慧變更摘要**
   - **原因**：原有規格要求 AI 自動生成變更摘要
   - **位置**：可在階段三的觀測性與審計中實現
   - **實現方式**：基於 Semantic Patch 生成人類可讀的變更摘要

2. **Draft State API**
   - **原因**：原有規格要求 Draft Buffer 機制
   - **位置**：應在階段四的前端整合中實現
   - **實現方式**：提供 Draft State 的保存、讀取、應用 API

3. **Diff API（用於 Review Mode）**
   - **原因**：原有規格要求全局審查模式（雙欄對比）
   - **位置**：應在階段四的前端整合中實現
   - **實現方式**：提供 Diff API，返回兩個版本的對比結果

### 7.3 超出範圍的功能（需評估）

1. **PDF/Word 轉 Markdown**
   - **原因**：v2.0 明確標記為 OUT OF SCOPE
   - **建議**：由其他服務處理，DEA 僅處理 Markdown 文件

2. **向量化與知識圖譜集成**
   - **原因**：v2.0 明確標記為 OUT OF SCOPE（僅在 Intent 指示且授權下使用）
   - **建議**：由 Orchestrator 提供上下文，DEA 不直接調用

3. **增量向量化（Re-indexing）**
   - **原因**：v2.0 明確標記為 OUT OF SCOPE（由 Version Controller 處理）
   - **建議**：由 Version Controller 處理，DEA 僅提供 Patch

4. **模組化文檔架構（1+N 主從架構）**
   - **原因**：原有規格的功能，但可能超出 Agent 範圍
   - **建議**：評估是否為 Agent 職責，或由其他服務處理

---

## 8. 補充建議

### 8.1 必須補充到重構計劃書的功能

1. **模糊匹配算法**（階段二：Target Locator）
2. **流式 Patch 生成與傳輸**（階段四：前端整合）
3. **Commit & Rollback API**（階段四：前端整合）
4. **Draft State API**（階段四：前端整合）
5. **Diff API**（階段四：前端整合）

### 8.2 建議補充到重構計劃書的功能

1. **AI 智慧變更摘要**（階段三：觀測性與審計）
2. **Mermaid 代碼生成支持**（階段二：Content Generator）

### 8.3 需評估的功能

1. **模組化文檔架構**：評估是否為 Agent 職責
2. **PDF/Word 轉 Markdown**：評估是否由其他服務處理

---

## 9. 結論

### 9.1 功能覆蓋度

- **已包含功能**：約 **60-70%**
- **需補充功能**：約 **20-30%**
- **超出範圍功能**：約 **10%**

### 9.2 必須補充的功能清單

1. ✅ 模糊匹配算法（Fuzzy Matching）
2. ✅ 流式 Patch 生成與傳輸（WebSocket/SSE）
3. ✅ Commit & Rollback API
4. ✅ Draft State API
5. ✅ Diff API（用於 Review Mode）

### 9.3 建議

1. **立即補充**：將必須補充的功能添加到重構計劃書的對應階段
2. **評估決策**：對超出範圍的功能進行評估，決定是否包含或由其他服務處理
3. **前端協調**：與前端團隊確認前端功能的實現計劃，確保 API 接口匹配

---

**文件版本**: v1.0
**最後更新日期**: 2026-01-11
**維護人**: Daniel Chung
