# 規格書對比分析與文檔歸檔建議

**創建日期**: 2026-01-11
**創建人**: Daniel Chung
**最後修改日期**: 2026-01-11

---

## 📋 執行摘要

本文檔對比分析新規格書（v2.0 系統規格書）與原有規格書（Notion 中的原始規格書）的內容，並提供診斷指南和問題修復報告的歸檔建議。

---

## 1. 規格書對比分析

### 1.1 核心設計原則對比

| 原有規格書原則 | 新規格書 v2.0 | 狀態 | 說明 |
|--------------|--------------|------|------|
| **Document ≠ File** | ✅ 包含（第 2.1.3 條） | ✅ 完全繼承 | 文件是具備生命週期、版本與治理規則的「知識物件」 |
| **Edit ≠ Generate** | ✅ 包含（第 2.1.4 條） | ✅ 完全繼承 | 所有編輯行為必須以 Patch/Diff 形式表達 |
| **Intent-driven Editing** | ✅ 包含（md-editor 規格） | ✅ 完全繼承 | 編輯必須由結構化 Intent 觸發 |
| **Governance-first** | ✅ 包含（第 2.1.5 條） | ✅ 完全繼承 | 無 DocumentContext、無合法版本狀態，不得編輯 |
| **Auditable & Deterministic** | ✅ 包含（第 2.1.6 條） | ✅ 完全繼承 | 每一次操作皆可追溯，結果必須可重現 |

**結論**：新規格書 v2.0 **完全繼承**了原有規格書的所有核心設計原則。

### 1.2 系統定位對比

| 原有規格書 | 新規格書 v2.0 | 狀態 |
|-----------|--------------|------|
| Domain Execution Layer Agent | ✅ 包含（md-editor 和 xls-editor 都是 Domain Execution Layer Agent） | ✅ 一致 |
| 專職處理 Markdown 文件的結構化編輯 | ✅ 擴展（md-editor 處理 Markdown，xls-editor 處理 Excel） | ✅ 擴展 |
| 永遠在 Orchestrator Agent 授權之後才能被調用 | ✅ 包含（所有 Agent 都遵循此原則） | ✅ 一致 |

**結論**：新規格書 v2.0 **繼承並擴展**了原有規格書的系統定位。

### 1.3 系統邊界對比

#### 原有規格書的 IN SCOPE

| 原有規格書 IN SCOPE | 新規格書 v2.0 | 狀態 |
|-------------------|--------------|------|
| Markdown 文件解析（AST / Block Level） | ✅ md-editor 包含 | ✅ 完全覆蓋 |
| 編輯意圖（Edit Intent）解析與驗證 | ✅ md-editor 和 xls-editor 都包含 | ✅ 完全覆蓋 |
| 編輯位置定位（章節 / Block / Anchor） | ✅ md-editor 包含（Target Selector） | ✅ 完全覆蓋 |
| Patch / Diff 生成 | ✅ md-editor 和 xls-editor 都包含 | ✅ 完全覆蓋 |
| 編輯後文件重組 | ✅ md-editor 包含 | ✅ 完全覆蓋 |
| 編輯結果驗證（結構 / 約束） | ✅ md-editor 和 xls-editor 都包含 | ✅ 完全覆蓋 |

#### 原有規格書的 OUT OF SCOPE

| 原有規格書 OUT OF SCOPE | 新規格書 v2.0 | 狀態 |
|------------------------|--------------|------|
| 任務意圖理解（由 Orchestrator 負責） | ✅ 明確說明（所有 Agent 都不負責） | ✅ 一致 |
| 文件註冊 / DocID 生成 | ✅ 明確說明（由基礎設施層負責） | ✅ 一致 |
| 版本授權與合法性裁決 | ✅ 明確說明（由 Version Controller 負責） | ✅ 一致 |
| 使用者權限與安全稽核 | ✅ 明確說明（由基礎設施層負責） | ✅ 一致 |
| 模型資源選擇（MoE） | ✅ 明確說明（由 Orchestrator 負責） | ✅ 一致 |
| 文件最終提交與發布 | ✅ 明確說明（由 Version Controller 負責） | ✅ 一致 |

**結論**：新規格書 v2.0 **完全保持**了原有規格書的系統邊界定義。

### 1.4 核心資料模型對比

#### DocumentContext

| 原有規格書 | 新規格書 v2.0 | 狀態 |
|-----------|--------------|------|
| doc_id | ✅ 包含 | ✅ 一致 |
| task_id | ✅ 包含 | ✅ 一致 |
| current_version_id | ✅ 包含（version_id） | ✅ 一致 |
| file_path | ✅ 包含 | ✅ 一致 |
| format: markdown | ✅ 包含（擴展為多格式） | ✅ 擴展 |

**結論**：新規格書 v2.0 **繼承並擴展**了原有規格書的 DocumentContext 模型。

#### Edit Intent DSL

| 原有規格書 | 新規格書 v2.0 | 狀態 |
|-----------|--------------|------|
| Intent DSL 基本結構 | ✅ md-editor 完全包含 | ✅ 完全繼承 |
| Intent Type 語義定義 | ✅ md-editor 包含 | ✅ 完全繼承 |
| Target Selector DSL | ✅ md-editor 包含 | ✅ 完全繼承 |
| Action Mode 語義 | ✅ md-editor 包含 | ✅ 完全繼承 |
| Constraints（約束子語言） | ✅ md-editor 包含 | ✅ 完全繼承 |
| Intent → Patch 映射規則 | ✅ md-editor 包含 | ✅ 完全繼承 |

**結論**：新規格書 v2.0 **完全繼承**了原有規格書的 Edit Intent DSL 設計。

#### Patch / Diff Model

| 原有規格書 | 新規格書 v2.0 | 狀態 |
|-----------|--------------|------|
| Text Patch（Unified Diff） | ✅ md-editor 包含 | ✅ 完全繼承 |
| Block Patch（結構化 Patch） | ✅ md-editor 包含 | ✅ 完全繼承 |
| Semantic Patch（語義 Patch） | ✅ md-editor 包含（可選） | ✅ 完全繼承 |
| Patch 轉換關係 | ✅ md-editor 包含 | ✅ 完全繼承 |

**結論**：新規格書 v2.0 **完全繼承**了原有規格書的 Patch/Diff 模型。

### 1.5 內部模組架構對比

| 原有規格書模組 | 新規格書 v2.0 | 狀態 |
|--------------|--------------|------|
| Intent Validator | ✅ md-editor 包含 | ✅ 完全繼承 |
| Markdown Parser (AST) | ✅ md-editor 包含 | ✅ 完全繼承 |
| Target Locator | ✅ md-editor 包含 | ✅ 完全繼承 |
| Content Generator (LLM-bound) | ✅ md-editor 包含 | ✅ 完全繼承 |
| Patch Generator | ✅ md-editor 包含 | ✅ 完全繼承 |
| Validator & Linter | ✅ md-editor 包含 | ✅ 完全繼承 |

**結論**：新規格書 v2.0 **完全繼承**了原有規格書的內部模組架構。

### 1.6 執行流程對比

| 原有規格書流程 | 新規格書 v2.0 | 狀態 |
|--------------|--------------|------|
| 接收 DocumentContext + Edit Intent | ✅ md-editor 包含 | ✅ 完全繼承 |
| Intent Validator | ✅ md-editor 包含 | ✅ 完全繼承 |
| Parse Markdown → AST | ✅ md-editor 包含 | ✅ 完全繼承 |
| Locate Target Block | ✅ md-editor 包含 | ✅ 完全繼承 |
| Assemble Minimal Context | ✅ md-editor 包含 | ✅ 完全繼承 |
| Generate Content (LLM) | ✅ md-editor 包含 | ✅ 完全繼承 |
| Build Patch / Diff | ✅ md-editor 包含 | ✅ 完全繼承 |
| Validate Result | ✅ md-editor 包含 | ✅ 完全繼承 |
| Return Patch + Preview | ✅ md-editor 包含 | ✅ 完全繼承 |

**結論**：新規格書 v2.0 **完全繼承**了原有規格書的執行流程。

### 1.7 非功能性需求對比

| 原有規格書 NFR | 新規格書 v2.0 | 狀態 |
|--------------|--------------|------|
| Determinism（可重現性） | ✅ 包含（LLM 配置：temperature=0, fixed seed） | ✅ 完全繼承 |
| Latency（延遲） | ✅ 包含（實現計劃中定義 SLA） | ✅ 完全繼承 |
| Observability（可觀測性） | ✅ 包含（審計日誌、事件模型） | ✅ 完全繼承 |
| Extensibility（可擴展性） | ✅ 包含（支持多格式擴展） | ✅ 擴展 |

**結論**：新規格書 v2.0 **完全繼承並擴展**了原有規格書的非功能性需求。

---

## 2. 新規格書的擴展內容

### 2.1 新增功能

1. **多格式支持**
   - Excel 編輯（xls-editor）
   - 格式轉換（md-to-pdf, xls-to-pdf, pdf-to-md）

2. **Agent 分類**
   - 編輯類 Agents（Editing Agents）
   - 轉換類 Agents（Conversion Agents）

3. **統一接口規範**
   - 所有 Agent 遵循相同的 MCP Tool 接口規範
   - 編輯類 Agent 統一使用 Intent DSL + Patch 模型
   - 轉換類 Agent 統一使用轉換配置 + 輸出文件

### 2.2 新增設計原則

1. **單一職責原則**
   - 每個 Agent 只負責一種格式的編輯或轉換
   - 編輯 Agent 和轉換 Agent 職責分離

2. **統一接口規範**
   - 所有 Agent 遵循相同的 MCP Tool 接口規範

---

## 3. 結論：新規格書是否包含原有規格書的精神與要求？

### ✅ 完全包含

**新規格書 v2.0 完全繼承了原有規格書的所有核心精神與要求**：

1. ✅ **核心設計原則**：100% 繼承（5/5）
2. ✅ **系統定位**：100% 繼承並擴展
3. ✅ **系統邊界**：100% 保持一致
4. ✅ **核心資料模型**：100% 繼承並擴展
5. ✅ **內部模組架構**：100% 繼承
6. ✅ **執行流程**：100% 繼承
7. ✅ **非功能性需求**：100% 繼承並擴展

### 📈 擴展內容

新規格書 v2.0 在繼承原有規格書的基礎上，還增加了：

1. **多格式支持**：從單一 Markdown 擴展到 Markdown + Excel
2. **格式轉換**：新增 3 個轉換類 Agent
3. **模組化設計**：明確的 Agent 分類和職責分離
4. **統一接口**：所有 Agent 遵循相同的接口規範

### 📝 詳細規格引用

新規格書 v2.0 在 md-editor 部分明確引用：
> 詳細規格請參考：《文件編輯-Agent（Markdown）工程系統規格書-v2.md》

這表明新規格書 v2.0 是**系統級規格書**，而原有規格書的詳細內容作為 **md-editor 的詳細規格參考**保留。

---

## 4. 診斷指南和問題修復報告歸檔建議

### 4.1 文檔性質分析

| 文檔名稱 | 類型 | 創建日期 | 性質 | 建議 |
|---------|------|---------|------|------|
| **通用助理文件編輯問題修復報告.md** | 問題修復報告 | 2026-01-06 | 特定問題的修復記錄 | ⚠️ 建議歸檔 |
| **測試Data任務文件生成問題診斷指南.md** | 診斷指南 | 2026-01-06 | 特定任務的問題診斷 | ⚠️ 建議歸檔 |
| **超時問題診斷指南.md** | 診斷指南 | 2026-01-06 | 通用診斷指南 | ✅ 保留（通用指南） |

### 4.2 歸檔建議詳解

#### 建議歸檔的文檔

1. **通用助理文件編輯問題修復報告.md**
   - **原因**：
     - 這是特定問題的修復記錄（2026-01-06）
     - 問題可能已經修復，文檔已過時
     - 屬於歷史記錄，不屬於當前規格或指南
   - **建議**：歸檔到 `archive/v1.0/` 或創建 `archive/issues/` 目錄

2. **測試Data任務文件生成問題診斷指南.md**
   - **原因**：
     - 這是特定任務的問題診斷（2026-01-06）
     - 問題可能已經解決，文檔已過時
     - 屬於歷史記錄，不屬於當前規格或指南
   - **建議**：歸檔到 `archive/v1.0/` 或創建 `archive/issues/` 目錄

#### 建議保留的文檔

3. **超時問題診斷指南.md**
   - **原因**：
     - 這是通用的診斷指南，不是特定問題的記錄
     - 對未來類似問題有參考價值
     - 屬於運維文檔，應該保留
   - **建議**：保留在主目錄，或移動到 `docs/運維/` 目錄

### 4.3 其他診斷指南評估

| 文檔名稱 | 類型 | 建議 |
|---------|------|------|
| **文件編輯問題診斷指南.md** | 通用診斷指南 | ✅ 保留（通用指南） |
| **文件生成日誌追蹤指南.md** | 日誌追蹤指南 | ✅ 保留（運維文檔） |

---

## 5. 歸檔執行建議

### 5.1 創建問題歸檔目錄

建議創建 `archive/issues/` 目錄，專門存放已解決的問題修復報告和特定問題的診斷指南。

### 5.2 歸檔執行步驟

1. **創建歸檔目錄**：

   ```bash
   mkdir -p archive/issues/2026-01
   ```

2. **移動問題修復報告**：
   - `通用助理文件編輯問題修復報告.md` → `archive/issues/2026-01/`
   - `測試Data任務文件生成問題診斷指南.md` → `archive/issues/2026-01/`

3. **更新 README.md**：
   - 在 README.md 中說明問題歸檔目錄的用途
   - 列出歸檔的問題文檔

### 5.3 保留的文檔組織

建議將運維相關文檔組織到子目錄：

```
IEE對話式開發文件編輯/
├── 系統規格書（v2.0）/
│   ├── 文件編輯-Agent-系統規格書-v2.0.md
│   └── ...
├── 運維文檔/
│   ├── 超時問題診斷指南.md
│   ├── 文件編輯問題診斷指南.md
│   └── 文件生成日誌追蹤指南.md
└── archive/
    ├── v1.0/（舊規格書）
    └── issues/（問題修復報告）
```

---

## 6. 總結

### 6.1 規格書對比結論

✅ **新規格書 v2.0 完全包含原有規格書的精神與要求**

- 100% 繼承核心設計原則
- 100% 保持系統邊界定義
- 100% 繼承核心資料模型
- 100% 繼承內部模組架構
- 100% 繼承執行流程
- 100% 繼承非功能性需求

同時，新規格書 v2.0 還擴展了：

- 多格式支持（Markdown + Excel）
- 格式轉換功能（3 個轉換類 Agent）
- 模組化設計（明確的 Agent 分類）

### 6.2 文檔歸檔建議

**建議歸檔**：

- `通用助理文件編輯問題修復報告.md` → `archive/issues/2026-01/`
- `測試Data任務文件生成問題診斷指南.md` → `archive/issues/2026-01/`

**建議保留**：

- `超時問題診斷指南.md`（通用診斷指南）
- `文件編輯問題診斷指南.md`（通用診斷指南）
- `文件生成日誌追蹤指南.md`（運維文檔）

---

**文件版本**: v1.0
**最後更新日期**: 2026-01-11
**維護人**: Daniel Chung
