# 文件編輯功能使用指南

**版本**: 1.0
**創建日期**: 2026-01-06
**創建人**: Daniel Chung
**最後修改日期**: 2026-01-06

---

## 📋 概述

文件編輯功能允許您通過與 AI 對話的方式，對 Markdown 文件進行智能編輯。系統支持流式編輯預覽、實時修改顯示和編輯確認機制，確保編輯過程流暢且安全。

---

## 🚀 快速開始

### 1. 選擇支持文件編輯的 Assistant

1. 在聊天界面中，點擊 Assistant 選擇器
2. 選擇一個支持文件編輯的 Assistant（系統會自動檢測並顯示文件選擇器）
3. 如果 Assistant 不支持文件編輯，文件選擇器將不會顯示

### 2. 選擇要編輯的文件

1. 點擊輸入框 header 中的「選擇文件」按鈕
2. 在文件搜索模態框中選擇一個 Markdown 文件（.md 或 .markdown）
3. 選中後，文件名會顯示在 header 中

**注意**: 僅支持 Markdown 文件編輯。選擇其他格式的文件會顯示錯誤提示。

### 3. 輸入編輯指令

1. 在輸入框中輸入編輯指令（自然語言）
2. 例如：「在開頭添加一個標題」、「優化這段文字」、「在第二章添加一個段落」
3. 點擊發送按鈕或按 Enter 鍵提交

### 4. 查看實時預覽

1. 編輯指令提交後，系統會開始流式生成修改
2. 在文件預覽區（右側面板）中，您會看到修改的實時預覽
3. 修改會以高亮形式顯示（綠色表示新增，紅色劃線表示刪除）

### 5. 確認或拒絕修改

當檢測到文件有修改時，header 中會顯示三個按鈕：

- **接受**: 接受當前修改，將其應用到預覽
- **拒絕**: 拒絕修改，恢復原始內容
- **提交**: 將修改保存到後端，觸發向量化和知識圖譜更新

---

## 📖 基本操作流程

### 完整編輯流程

```
選擇 Assistant（支持文件編輯）
    ↓
選擇 Markdown 文件
    ↓
輸入編輯指令
    ↓
查看流式預覽
    ↓
接受/拒絕/提交修改
```

### 多次編輯

您可以連續進行多次編輯：

1. 第一次編輯後，點擊「接受」應用修改
2. 繼續輸入新的編輯指令
3. 重複上述流程
4. 最後點擊「提交」保存所有修改

---

## 💡 編輯指令範例

### 文字優化

```
指令：優化這段文字，讓它更簡潔易懂
```

### 內容插入

```
指令：在「系統架構」標題下添加一個關於「快取機制」的子章節
```

### 內容修改

```
指令：將這段程式碼範例改為 Python 3.11 語法
```

### 結構調整

```
指令：將這個列表改為表格格式
```

### Mermaid 圖表生成

```
指令：為這個流程生成一個 Mermaid 流程圖
```

---

## 🔍 文件選擇和驗證

### 支持的文件類型

- ✅ `.md` - Markdown 文件
- ✅ `.markdown` - Markdown 文件
- ❌ `.pdf` - PDF 文件（不支持編輯）
- ❌ `.docx` - Word 文件（不支持編輯）
- ❌ `.txt` - 純文本文件（不支持編輯）

### 文件驗證

- 系統會自動驗證文件類型
- 非 Markdown 文件會顯示錯誤提示：「僅支持 Markdown 文件（.md, .markdown）」
- 錯誤提示會在 3 秒後自動消失

---

## 📊 流式編輯預覽

### 實時更新

- 編輯指令提交後，修改會以流式方式實時顯示
- 無需等待完整響應，即可看到修改預覽
- 預覽區會顯示「正在應用編輯修改...」的加載狀態

### 預覽提示

當有編輯修改時，預覽區頂部會顯示：

```
正在顯示 N 個編輯修改的預覽（內容已更新）
```

### Diff 高亮

- **綠色背景**: 新增的內容
- **紅色劃線**: 刪除的內容
- **正常顯示**: 未修改的內容

---

## ✅ 編輯確認操作

### 接受修改

- **操作**: 點擊「接受」按鈕
- **效果**: 將修改應用到預覽，清除操作按鈕
- **狀態**: 修改仍在本地，尚未保存到後端

### 拒絕修改

- **操作**: 點擊「拒絕」按鈕
- **效果**: 恢復原始內容，清除修改狀態
- **狀態**: 所有修改被丟棄

### 提交修改

- **操作**: 點擊「提交」按鈕
- **效果**:
  - 保存修改到後端存儲（SeaweedFS）
  - 觸發向量化處理（異步）
  - 觸發知識圖譜提取（異步）
  - 更新文件版本
- **狀態**: 修改已永久保存

**注意**: 提交後無法撤銷，請確認修改無誤後再提交。

---

## ⚠️ 常見問題

### Q1: 為什麼看不到文件選擇器？

**A**: 請確認：

1. 選擇的 Assistant 是否支持文件編輯（檢查 `allowedTools` 是否包含 `document_editing`）
2. 瀏覽器控制台是否有錯誤信息
3. 嘗試刷新頁面

### Q2: 選擇文件時提示「僅支持 Markdown 文件」？

**A**: 文件編輯功能僅支持 Markdown 文件。請選擇 `.md` 或 `.markdown` 格式的文件。

### Q3: 編輯指令沒有反應？

**A**: 請檢查：

1. 是否已選擇文件
2. 文件是否為 Markdown 格式
3. 網絡連接是否正常
4. 查看瀏覽器控制台的錯誤信息

### Q4: 流式預覽不顯示？

**A**: 請檢查：

1. SSE 連接是否正常建立
2. 瀏覽器是否支持 Server-Sent Events
3. 網絡防火牆是否阻止 SSE 連接

### Q5: 提交修改失敗？

**A**: 可能的原因：

1. 文件版本衝突（其他用戶已修改文件）
2. 網絡連接問題
3. 權限不足

**解決方案**:

- 刷新頁面，重新選擇文件
- 檢查文件版本是否衝突
- 聯繫管理員檢查權限設置

### Q6: 大文件編輯緩慢？

**A**: 系統已優化大文件處理：

- 文件 > 10MB 時，只處理游標附近的上下文窗口
- 流式更新使用防抖處理，避免頻繁更新
- 如果仍然緩慢，建議將大文件拆分為多個小文件

---

## 🎯 最佳實踐

### 1. 編輯指令撰寫

**✅ 好的指令範例**:

- 「在『系統架構』標題下添加一個關於『快取機制』的子章節，包含 Redis 和 Memcached 的比較」
- 「優化這段文字，讓它更簡潔易懂，保留技術細節」
- 「將這個列表改為表格格式，包含名稱、描述、狀態三列」

**❌ 不好的指令範例**:

- 「改一下」（太模糊）
- 「全部重寫」（違反非侵入式編輯原則）
- 「隨便改改」（沒有明確目標）

### 2. 多次編輯策略

1. **累積修改**: 可以進行多次編輯，累積多個修改後一次性提交
2. **及時接受**: 每次編輯後及時點擊「接受」，確保修改應用到預覽
3. **定期提交**: 完成一個邏輯單元後就提交，避免累積太多修改

### 3. 大文件處理

1. **拆分文件**: 對於超過 10MB 的文件，建議拆分為多個小文件
2. **使用游標位置**: 在編輯大文件時，將游標放在要修改的位置附近
3. **明確指令**: 提供明確的編輯指令，幫助 AI 精確定位

### 4. 版本管理

1. **重要節點提交**: 完成重要章節後創建版本
2. **填寫摘要**: 提交時填寫清晰的變更摘要
3. **定期備份**: 重要文件定期備份

---

## 🔧 高級功能

### 游標上下文

編輯指令可以包含游標位置信息：

- 將游標放在要修改的位置
- 系統會自動將游標位置傳遞給 AI
- AI 會優先處理游標附近的內容

### 批量編輯

支持一次指令進行多處修改：

```
指令：將所有「API」改為「接口」，將所有「用戶」改為「使用者」
```

### 結構化輸出

支持生成 Mermaid 圖表：

```
指令：為這個流程生成一個 Mermaid 流程圖
```

---

## 📚 相關文檔

- [IEE 編輯器操作說明](./IEE編輯器操作說明.md)
- [文件編輯 Agent 開發規劃書](./文件編輯Agent開發規劃書.md)
- [文件編輯 API 文檔](../API文档/文件編輯API.md)

---

**最後更新日期**: 2026-01-06
**文檔版本**: 1.0
**維護人**: Daniel Chung
