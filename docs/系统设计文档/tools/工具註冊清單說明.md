# 工具註冊清單說明

**創建日期**: 2025-12-30
**創建人**: Daniel Chung
**最後修改日期**: 2025-12-30

**更新記錄**:

- 2025-12-30: 初始版本，JSON 文件存儲
- 2025-12-30: 遷移到 ArangoDB 存儲，添加完整的 API 接口

**關聯文檔**: [工具API文档](./工具API文档.md)、[工具使用指南](./工具使用指南.md)

---

## 📋 概述

工具註冊清單存儲在 **ArangoDB** 中（Collection: `tools_registry`），同時保留 JSON 文件作為備份和初始數據源。包含所有工具的詳細說明，供 AI 任務分析使用。

### 存儲位置

- **ArangoDB Collection**: `tools_registry`（主要存儲）
- **JSON 文件**（備份）: `tools/tools_registry.json`
- **載入器模組**: `tools/registry_loader.py`（優先從 ArangoDB 讀取，回退到 JSON）
- **Store Service**: `services/api/services/tool_registry_store_service.py`
- **API 路由**: `api/routers/tools_registry.py`

---

## 🗄️ ArangoDB 存儲結構

### Collection 信息

- **Collection 名稱**: `tools_registry`
- **類型**: Document Collection
- **多租戶**: ❌ 否（工具註冊清單是全局共享的）
- **TTL**: ❌ 否

### 文檔結構

每個工具註冊記錄包含以下字段：

| 字段 | 類型 | 說明 |
|------|------|------|
| `_key` | `str` | 工具名稱（唯一標識） |
| `name` | `str` | 工具名稱 |
| `version` | `str` | 工具版本號 |
| `category` | `str` | 工具類別 |
| `description` | `str` | 工具簡短描述 |
| `purpose` | `str` | 工具用途說明 |
| `use_cases` | `List[str]` | 使用場景列表 |
| `input_parameters` | `Dict` | 輸入參數說明 |
| `output_fields` | `Dict` | 輸出字段說明 |
| `example_scenarios` | `List[str]` | 示例場景 |
| `is_active` | `bool` | 是否啟用（默認 true） |
| `created_at` | `str` | 創建時間（ISO 8601） |
| `updated_at` | `str` | 更新時間（ISO 8601） |
| `created_by` | `str` | 創建者（可選） |
| `updated_by` | `str` | 更新者（可選） |

### 索引

| 索引名稱 | 類型 | 字段 | 說明 |
|---------|------|------|------|
| `idx_tools_registry_name` | persistent | `["name"]` | 工具名稱索引（唯一） |
| `idx_tools_registry_category` | persistent | `["category"]` | 工具類別索引 |
| `idx_tools_registry_is_active` | persistent | `["is_active"]` | 啟用狀態索引 |
| `idx_tools_registry_category_active` | persistent | `["category", "is_active"]` | 類別和狀態複合索引 |

---

## 📊 JSON 結構（備份格式）

### 頂層結構

```json
{
  "version": "1.0.0",
  "last_updated": "2025-12-30",
  "description": "AI-Box 工具註冊清單，包含所有工具的詳細說明，供 AI 任務分析使用",
  "tools": [
    {
      "name": "工具名稱",
      "version": "1.0.0",
      "category": "工具類別",
      "description": "工具簡短描述",
      "purpose": "工具用途說明",
      "use_cases": ["使用場景1", "使用場景2"],
      "input_parameters": {...},
      "output_fields": {...},
      "example_scenarios": ["示例場景1", "示例場景2"]
    }
  ]
}
```

### 工具信息字段說明

| 字段 | 類型 | 說明 |
|------|------|------|
| `name` | `str` | 工具名稱（唯一標識） |
| `version` | `str` | 工具版本號 |
| `category` | `str` | 工具類別（如 "時間與日期"、"天氣"） |
| `description` | `str` | 工具簡短描述 |
| `purpose` | `str` | 工具用途說明（詳細說明工具的用途） |
| `use_cases` | `List[str]` | 使用場景列表（工具適用的場景） |
| `input_parameters` | `Dict` | 輸入參數說明（參數名稱、類型、必填、描述） |
| `output_fields` | `Dict` | 輸出字段說明（字段名稱和描述） |
| `example_scenarios` | `List[str]` | 示例場景（具體的使用示例） |

---

## 🔧 使用方法

### API 使用

#### 1. 查詢工具列表

```bash
# 獲取所有工具
GET /api/v1/tools/registry

# 根據類別過濾
GET /api/v1/tools/registry?category=時間與日期

# 分頁查詢
GET /api/v1/tools/registry?page=1&page_size=10
```

#### 2. 獲取單個工具信息

```bash
GET /api/v1/tools/registry/{tool_name}
```

#### 3. 註冊新工具

```bash
POST /api/v1/tools/registry
Content-Type: application/json

{
  "name": "new_tool",
  "version": "1.0.0",
  "category": "測試",
  "description": "新工具描述",
  "purpose": "工具用途說明",
  "use_cases": ["場景1", "場景2"],
  "input_parameters": {...},
  "output_fields": {...},
  "example_scenarios": ["示例1"]
}
```

#### 4. 更新工具信息

```bash
PUT /api/v1/tools/registry/{tool_name}
Content-Type: application/json

{
  "version": "1.1.0",
  "description": "更新後的描述"
}
```

#### 5. 刪除工具（軟刪除）

```bash
DELETE /api/v1/tools/registry/{tool_name}
```

#### 6. 搜索工具

```bash
GET /api/v1/tools/registry/search?keyword=日期
```

#### 7. 獲取所有類別

```bash
GET /api/v1/tools/registry/categories/list
```

### Python 代碼使用

### 1. 載入工具註冊清單

```python
from tools.registry_loader import load_tools_registry

# 載入完整清單
registry = load_tools_registry()
print(f"版本: {registry['version']}")
print(f"工具數量: {len(registry['tools'])}")
```

### 2. 獲取單個工具信息

```python
from tools.registry_loader import get_tool_info

# 獲取指定工具的詳細信息
tool_info = get_tool_info("datetime")
if tool_info:
    print(f"工具名稱: {tool_info['name']}")
    print(f"用途: {tool_info['purpose']}")
    print(f"使用場景: {tool_info['use_cases']}")
```

### 3. 列出所有工具

```python
from tools.registry_loader import list_all_tools

# 列出所有工具
tools = list_all_tools()
for tool in tools:
    print(f"{tool['name']}: {tool['description']}")
```

### 4. 根據類別獲取工具

```python
from tools.registry_loader import get_tools_by_category

# 獲取所有時間與日期工具
time_tools = get_tools_by_category("時間與日期")
for tool in time_tools:
    print(f"{tool['name']}: {tool['description']}")
```

### 5. 搜索工具

```python
from tools.registry_loader import search_tools

# 根據關鍵字搜索工具
results = search_tools("天氣")
for tool in results:
    print(f"{tool['name']}: {tool['description']}")
```

### 6. 獲取用於 AI 任務分析的工具清單

```python
from tools.registry_loader import get_tools_for_task_analysis

# 獲取格式化的工具清單（適合 AI 分析）
analysis_tools = get_tools_for_task_analysis()
print(f"工具總數: {analysis_tools['total_count']}")

for tool in analysis_tools['tools']:
    print(f"\n工具: {tool['name']}")
    print(f"類別: {tool['category']}")
    print(f"用途: {tool['purpose']}")
    print(f"使用場景: {tool['use_cases']}")
    print(f"示例場景: {tool['example_scenarios']}")
```

---

## 🤖 AI 任務分析使用示例

### 場景 1: 用戶詢問當前時間

```python
from tools.registry_loader import search_tools

# 搜索與時間相關的工具
time_tools = search_tools("時間")

# AI 分析：用戶詢問「現在幾點？」
# 找到 datetime 工具，用途是「獲取當前日期時間」
# 使用場景包含「獲取當前日期時間用於日誌記錄」
# 示例場景包含「用戶詢問：『現在幾點？』→ 使用 datetime 工具獲取當前時間」

tool = time_tools[0]  # datetime 工具
# 使用 tool['input_parameters'] 了解需要什麼參數
# 使用 tool['output_fields'] 了解會返回什麼結果
```

### 場景 2: 用戶詢問天氣

```python
from tools.registry_loader import get_tool_info

# 獲取天氣工具信息
weather_tool = get_tool_info("weather")

# AI 分析：
# - 用途：提供實時天氣信息
# - 使用場景：用戶詢問當前天氣、根據天氣調整建議
# - 輸入參數：需要 city 或 lat/lon
# - 輸出字段：包含 temperature, description 等

# 根據工具信息，AI 可以：
# 1. 理解需要什麼參數（city 或 lat/lon）
# 2. 知道會返回什麼結果（溫度、描述等）
# 3. 選擇合適的工具（weather 而不是 forecast）
```

### 場景 3: 單位轉換需求

```python
from tools.registry_loader import get_tools_by_category

# 獲取所有單位轉換工具
conversion_tools = get_tools_by_category("單位轉換")

# AI 分析：用戶詢問「100 英尺等於多少米？」
# 1. 識別這是長度單位轉換
# 2. 找到 length_converter 工具
# 3. 查看 input_parameters 了解需要 from_unit 和 to_unit
# 4. 使用工具進行轉換
```

---

## 📝 工具類別列表

| 類別 | 工具數量 | 工具名稱 |
|------|---------|---------|
| 時間與日期 | 3 | datetime, date_formatter, date_calculator |
| 天氣 | 2 | weather, forecast |
| 地理位置 | 4 | ip_location, geocoding, distance, timezone |
| 單位轉換 | 6 | length_converter, weight_converter, temperature_converter, currency_converter, volume_converter, area_converter |
| 計算 | 2 | math_calculator, statistics_calculator |
| 文本處理 | 4 | text_formatter, text_cleaner, text_converter, text_summarizer |

**總計**: 21 個工具

---

## 🔄 更新工具註冊清單

### 方式一：通過 API（推薦）

#### 添加新工具

```bash
curl -X POST http://localhost:8000/api/v1/tools/registry \
  -H "Content-Type: application/json" \
  -d '{
    "name": "new_tool",
    "version": "1.0.0",
    "category": "測試",
    "description": "新工具描述",
    "purpose": "工具用途說明",
    "use_cases": ["場景1", "場景2"],
    "input_parameters": {...},
    "output_fields": {...},
    "example_scenarios": ["示例1"]
  }'
```

#### 更新現有工具

```bash
curl -X PUT http://localhost:8000/api/v1/tools/registry/{tool_name} \
  -H "Content-Type: application/json" \
  -d '{
    "version": "1.1.0",
    "description": "更新後的描述"
  }'
```

### 方式二：通過 JSON 文件（備份方式）

#### 添加新工具

1. 在 `tools/tools_registry.json` 的 `tools` 數組中添加新工具條目
2. 確保包含所有必需字段：
   - `name`: 工具名稱（必須與工具類的 `name` 屬性一致）
   - `version`: 版本號
   - `category`: 工具類別
   - `description`: 簡短描述
   - `purpose`: 詳細用途說明
   - `use_cases`: 使用場景列表
   - `input_parameters`: 輸入參數說明
   - `output_fields`: 輸出字段說明
   - `example_scenarios`: 示例場景列表

3. 更新 `last_updated` 字段為當前日期
4. 運行遷移腳本將 JSON 數據導入 ArangoDB

#### 更新現有工具

1. 直接修改 `tools_registry.json` 中對應工具的字段
2. 更新 `last_updated` 字段
3. 運行遷移腳本同步到 ArangoDB

### 初始化 ArangoDB（首次使用）

```bash
# 1. 初始化 Collection 和索引
python scripts/migration/init_tools_registry_collection.py

# 2. 從 JSON 文件遷移數據到 ArangoDB
python scripts/migration/migrate_tools_registry_to_arangodb.py
```

### 驗證 JSON 格式

```bash
# 使用 Python 驗證 JSON 格式
python -m json.tool tools/tools_registry.json > /dev/null && echo "JSON 格式正確"
```

---

## 💡 最佳實踐

### 1. 用途說明（purpose）

- **清晰明確**：說明工具的主要用途
- **簡潔**：1-2 句話概括
- **具體**：避免過於抽象的描述

**示例**：

- ✅ 好：`"提供準確的當前日期時間信息，支持不同時區和格式需求"`
- ❌ 差：`"處理時間相關的任務"`

### 2. 使用場景（use_cases）

- **具體**：列出具體的使用場景
- **多樣**：涵蓋不同的使用情況
- **實用**：基於實際使用需求

**示例**：

```json
"use_cases": [
  "獲取當前日期時間用於日誌記錄",
  "根據用戶時區顯示本地時間",
  "任務調度需要當前時間",
  "多租戶環境下不同地區的時間顯示"
]
```

### 3. 示例場景（example_scenarios）

- **具體**：包含具體的用戶查詢或任務
- **完整**：展示從問題到工具使用的完整流程
- **易懂**：使用自然語言描述

**示例**：

```json
"example_scenarios": [
  "用戶詢問：『現在幾點？』→ 使用 datetime 工具獲取當前時間",
  "任務需要記錄執行時間 → 使用 datetime 工具獲取時間戳",
  "顯示用戶本地時間 → 使用 datetime 工具，指定用戶時區"
]
```

---

## 🔍 工具選擇指南（供 AI 使用）

### 根據任務類型選擇工具

1. **時間相關任務**
   - 獲取當前時間 → `datetime`
   - 日期格式化 → `date_formatter`
   - 日期計算 → `date_calculator`

2. **天氣相關任務**
   - 當前天氣 → `weather`
   - 天氣預報 → `forecast`

3. **位置相關任務**
   - IP 定位 → `ip_location`
   - 地址轉坐標 → `geocoding` (forward)
   - 坐標轉地址 → `geocoding` (reverse)
   - 距離計算 → `distance`
   - 時區查詢 → `timezone`

4. **單位轉換任務**
   - 根據單位類型選擇對應的轉換工具
   - 長度 → `length_converter`
   - 重量 → `weight_converter`
   - 溫度 → `temperature_converter`
   - 貨幣 → `currency_converter`
   - 體積 → `volume_converter`
   - 面積 → `area_converter`

5. **計算任務**
   - 數學計算 → `math_calculator`
   - 統計計算 → `statistics_calculator`

6. **文本處理任務**
   - 格式化 → `text_formatter`
   - 清理 → `text_cleaner`
   - 格式轉換 → `text_converter`
   - 摘要 → `text_summarizer`

---

## 📚 相關文檔

- [工具API文档](./工具API文档.md) - 完整的 API 說明
- [工具使用指南](./工具使用指南.md) - 使用指南和最佳實踐
- [工具組開發規格](./工具組開發規格.md) - 開發規格說明

---

---

## 📚 相關文檔

- [工具API文档](./工具API文档.md) - 所有工具的 API 詳細說明
- [工具使用指南](./工具使用指南.md) - 工具使用指南和最佳實踐
- [工具組需求分析](./工具組需求分析.md) - 工具組需求分析
- [工具組開發規格](./工具組開發規格.md) - 工具組開發規格

---

## 🔗 API 端點列表

| 方法 | 端點 | 說明 |
|------|------|------|
| `POST` | `/api/v1/tools/registry` | 註冊新工具 |
| `GET` | `/api/v1/tools/registry/{tool_name}` | 獲取指定工具信息 |
| `PUT` | `/api/v1/tools/registry/{tool_name}` | 更新工具信息 |
| `DELETE` | `/api/v1/tools/registry/{tool_name}` | 刪除工具（軟刪除） |
| `GET` | `/api/v1/tools/registry` | 列出所有工具（支持分類、分頁） |
| `GET` | `/api/v1/tools/registry/search` | 搜索工具（關鍵字搜索） |
| `GET` | `/api/v1/tools/registry/categories/list` | 獲取所有類別 |

---

**最後更新日期**: 2025-12-30
**維護人**: Daniel Chung
