# v4 æ¸¬è©¦å‰æº–å‚™æª¢æŸ¥å ±å‘Š

**æª¢æŸ¥æ—¥æœŸ**: 2026-01-12  
**æª¢æŸ¥äºº**: AI Assistant  
**æ¸¬è©¦è¨ˆåŠƒæ–‡æª”**: `docs/ç³»ç»Ÿè®¾è®¡æ–‡æ¡£/æ ¸å¿ƒç»„ä»¶/èªç¾©èˆ‡ä»»å‹™åˆ†æ/æ–‡ä»¶ç·¨è¼¯Agentèªç¾©è·¯ç”±æ¸¬è©¦è¨ˆåŠƒ-v4.md`

---

## ğŸ“‹ æª¢æŸ¥çµæœæ‘˜è¦

| æª¢æŸ¥é¡åˆ¥ | ç¸½é …æ•¸ | é€šé | å¤±æ•— | è­¦å‘Š | ç‹€æ…‹ |
|---------|--------|------|------|------|------|
| System Agent è¨»å†Šç‹€æ…‹ | 6 | 0 | 6 | 0 | âŒ éœ€è¦ä¿®å¾© |
| v4 æ¶æ§‹çµ„ä»¶ç‹€æ…‹ | 7 | 2 | 5 | 0 | âŒ éœ€è¦ä¿®å¾© |
| æ¸¬è©¦ç’°å¢ƒ | 3 | 0 | 2 | 1 | âŒ éœ€è¦ä¿®å¾© |
| **ç¸½è¨ˆ** | **16** | **2** | **13** | **1** | **âŒ æœªå°±ç·’** |

---

## 1. System Agent è¨»å†Šç‹€æ…‹æª¢æŸ¥

### æª¢æŸ¥çµæœ

| Agent ID | System Registry | Agent Registry | is_active | status | ç‹€æ…‹ |
|----------|----------------|----------------|-----------|--------|------|
| `md-editor` | âŒ ç„¡æ³•æª¢æŸ¥ | âŒ ç„¡æ³•æª¢æŸ¥ | - | - | âŒ éœ€è¦ä¿®å¾© |
| `xls-editor` | âŒ ç„¡æ³•æª¢æŸ¥ | âŒ ç„¡æ³•æª¢æŸ¥ | - | - | âŒ éœ€è¦ä¿®å¾© |
| `md-to-pdf` | âŒ ç„¡æ³•æª¢æŸ¥ | âŒ ç„¡æ³•æª¢æŸ¥ | - | - | âŒ éœ€è¦ä¿®å¾© |
| `xls-to-pdf` | âŒ ç„¡æ³•æª¢æŸ¥ | âŒ ç„¡æ³•æª¢æŸ¥ | - | - | âŒ éœ€è¦ä¿®å¾© |
| `pdf-to-md` | âŒ ç„¡æ³•æª¢æŸ¥ | âŒ ç„¡æ³•æª¢æŸ¥ | - | - | âŒ éœ€è¦ä¿®å¾© |
| `document-editing-agent` | âŒ ç„¡æ³•æª¢æŸ¥ | âŒ ç„¡æ³•æª¢æŸ¥ | - | - | âŒ éœ€è¦ä¿®å¾© |

### å•é¡Œåˆ†æ

**ä¸»è¦å•é¡Œ**: ArangoDB é€£æ¥å¤±æ•—
- **éŒ¯èª¤ä¿¡æ¯**: `[HTTP 401][ERR 11] not authorized to execute this request`
- **åŸå› **: ArangoDB èªè­‰é…ç½®å•é¡Œ
- **å½±éŸ¿**: ç„¡æ³•æª¢æŸ¥ System Agent Registry ä¸­çš„ Agent è¨»å†Šç‹€æ…‹

### ä¿®å¾©å»ºè­°

1. **æª¢æŸ¥ ArangoDB é…ç½®**:
   - ç¢ºèª `.env` æ–‡ä»¶ä¸­çš„ ArangoDB èªè­‰ä¿¡æ¯æ­£ç¢º
   - ç¢ºèª `ARANGO_USERNAME` å’Œ `ARANGO_PASSWORD` ç’°å¢ƒè®Šæ•¸å·²è¨­ç½®
   - ç¢ºèª ArangoDB æœå‹™æ­£åœ¨é‹è¡Œ

2. **é©—è­‰é€£æ¥**:
   ```bash
   # æ¸¬è©¦ ArangoDB é€£æ¥
   python3 -c "
   from database.arangodb.client import ArangoDBClient
   client = ArangoDBClient()
   print('ArangoDB é€£æ¥æˆåŠŸ')
   "
   ```

3. **æª¢æŸ¥ Agent è¨»å†Š**:
   - ç¢ºèªæ‰€æœ‰ Agent å·²é€šé `agents/builtin/__init__.py` è¨»å†Š
   - ç¢ºèª `document-editing-agent` å·²æ¨™è¨˜ç‚º `is_active=False`

---

## 2. v4 æ¶æ§‹çµ„ä»¶ç‹€æ…‹æª¢æŸ¥

### æª¢æŸ¥çµæœ

| çµ„ä»¶åç¨± | ç‹€æ…‹ | èªªæ˜ |
|---------|------|------|
| **Intent Registry** | âŒ ç„¡æ³•æª¢æŸ¥ | ArangoDB é€£æ¥å¤±æ•— |
| **Capability Registry** | âŒ å¾ªç’°å°å…¥ | å­˜åœ¨å¾ªç’°å°å…¥å•é¡Œ |
| **RAG-2 (Capability Discovery)** | âŒ ç„¡æ³•æª¢æŸ¥ | ArangoDB é€£æ¥å¤±æ•— |
| **RAG-3 (Policy & Constraint)** | âŒ ç„¡æ³•æª¢æŸ¥ | ArangoDB é€£æ¥å¤±æ•— |
| **Policy Service** | âŒ ç„¡æ³•æª¢æŸ¥ | ArangoDB é€£æ¥å¤±æ•— |
| **Task Planner** | âœ… æ­£å¸¸ | é¡å®šç¾©å­˜åœ¨ä¸”å¯å°å…¥ |
| **ExecutionRecord Store** | âŒ å°å…¥å¤±æ•— | é¡åä¸åŒ¹é… |

### å•é¡Œåˆ†æ

#### 2.1 Intent Registry
- **ç‹€æ…‹**: âŒ ç„¡æ³•æª¢æŸ¥ï¼ˆArangoDB é€£æ¥å¤±æ•—ï¼‰
- **é æœŸ**: æ‡‰åŒ…å« 30 å€‹æ ¸å¿ƒ Intent
- **ä¿®å¾©**: ä¿®å¾© ArangoDB é€£æ¥å¾Œé‡æ–°æª¢æŸ¥

#### 2.2 Capability Registry
- **ç‹€æ…‹**: âŒ å¾ªç’°å°å…¥å•é¡Œ
- **éŒ¯èª¤ä¿¡æ¯**: `cannot import name 'get_capability_registry_store_service' from partially initialized module`
- **åŸå› **: `capability_registry_store_service.py` èˆ‡ `rag_service.py` ä¹‹é–“å­˜åœ¨å¾ªç’°å°å…¥
- **ä¿®å¾©å»ºè­°**:
  1. æª¢æŸ¥ `services/api/services/capability_registry_store_service.py` çš„å°å…¥
  2. æª¢æŸ¥ `agents/task_analyzer/rag_service.py` çš„å°å…¥
  3. ä½¿ç”¨å»¶é²å°å…¥ï¼ˆlazy importï¼‰æˆ–é‡æ§‹å°å…¥çµæ§‹

#### 2.3 RAG-2 å’Œ RAG-3
- **ç‹€æ…‹**: âŒ ç„¡æ³•æª¢æŸ¥ï¼ˆArangoDB é€£æ¥å¤±æ•—ï¼‰
- **ä¿®å¾©**: ä¿®å¾© ArangoDB é€£æ¥å¾Œé‡æ–°æª¢æŸ¥

#### 2.4 Policy Service
- **ç‹€æ…‹**: âŒ ç„¡æ³•æª¢æŸ¥ï¼ˆArangoDB é€£æ¥å¤±æ•—ï¼‰
- **ä¿®å¾©**: ä¿®å¾© ArangoDB é€£æ¥å¾Œé‡æ–°æª¢æŸ¥

#### 2.5 Task Planner
- **ç‹€æ…‹**: âœ… æ­£å¸¸
- **èªªæ˜**: é¡å®šç¾©å­˜åœ¨ä¸”å¯å°å…¥

#### 2.6 ExecutionRecord Store
- **ç‹€æ…‹**: âŒ å°å…¥å¤±æ•—
- **éŒ¯èª¤ä¿¡æ¯**: `cannot import name 'ExecutionRecordStore' from 'agents.task_analyzer.execution_record'`
- **åŸå› **: å¯¦éš›é¡åç‚º `ExecutionRecordStoreService`ï¼Œä¸æ˜¯ `ExecutionRecordStore`
- **ä¿®å¾©å»ºè­°**: 
  - æ›´æ–°å°å…¥èªå¥ï¼š`from agents.task_analyzer.execution_record import ExecutionRecordStoreService`
  - æˆ–æ·»åŠ åˆ¥åï¼š`ExecutionRecordStore = ExecutionRecordStoreService`

---

## 3. æ¸¬è©¦ç’°å¢ƒæª¢æŸ¥

### æª¢æŸ¥çµæœ

| é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| **æ¸¬è©¦è…³æœ¬** | âŒ ä¸å­˜åœ¨ | `tests/agents/test_file_editing_agent_routing_v4.py` æœªå‰µå»º |
| **æ¸¬è©¦å ´æ™¯å®šç¾©** | âŒ ç„¡æ³•æª¢æŸ¥ | æ¸¬è©¦è…³æœ¬ä¸å­˜åœ¨ |
| **ArangoDB Client** | âŒ é€£æ¥å¤±æ•— | èªè­‰å•é¡Œ |
| **ChromaDB** | âš ï¸ æœªæª¢æŸ¥ | éœ€è¦å¯¦éš›é€£æ¥æ¸¬è©¦ |

### å•é¡Œåˆ†æ

#### 3.1 æ¸¬è©¦è…³æœ¬
- **ç‹€æ…‹**: âŒ ä¸å­˜åœ¨
- **é æœŸæ–‡ä»¶**: `tests/agents/test_file_editing_agent_routing_v4.py`
- **ä¿®å¾©å»ºè­°**: 
  1. åƒè€ƒ `tests/agents/test_file_editing_agent_routing.py`ï¼ˆv3 ç‰ˆæœ¬ï¼‰
  2. æ ¹æ“šæ¸¬è©¦è¨ˆåŠƒæ–‡æª”å‰µå»º v4 ç‰ˆæœ¬æ¸¬è©¦è…³æœ¬
  3. åŒ…å« 90 å€‹åŸºç¤å ´æ™¯ + L1-L5 å±¤ç´šæ¸¬è©¦

#### 3.2 ArangoDB Client
- **ç‹€æ…‹**: âŒ é€£æ¥å¤±æ•—
- **ä¿®å¾©**: ä¿®å¾© ArangoDB èªè­‰é…ç½®

---

## ğŸ”§ ä¿®å¾©å„ªå…ˆç´š

### é«˜å„ªå…ˆç´šï¼ˆå¿…é ˆä¿®å¾©ï¼‰

1. **ArangoDB é€£æ¥å•é¡Œ** âš ï¸ **é˜»å¡æ€§å•é¡Œ**
   - å½±éŸ¿æ‰€æœ‰éœ€è¦ ArangoDB çš„æª¢æŸ¥é …
   - å¿…é ˆå„ªå…ˆä¿®å¾©

2. **Capability Registry å¾ªç’°å°å…¥** âš ï¸ **é˜»å¡æ€§å•é¡Œ**
   - å½±éŸ¿ RAG-2 å’Œ Capability æª¢ç´¢åŠŸèƒ½
   - å¿…é ˆä¿®å¾©

3. **ExecutionRecord Store å°å…¥å•é¡Œ**
   - å½±éŸ¿ L5 å±¤ç´šæ¸¬è©¦
   - ä¿®å¾©ç°¡å–®ï¼Œå„ªå…ˆè™•ç†

4. **å‰µå»ºæ¸¬è©¦è…³æœ¬**
   - æ¸¬è©¦ç„¡æ³•åŸ·è¡Œ
   - å¿…é ˆå‰µå»º

### ä¸­å„ªå…ˆç´š

5. **System Agent è¨»å†Šç‹€æ…‹æª¢æŸ¥**
   - ä¾è³´ ArangoDB é€£æ¥ä¿®å¾©
   - ä¿®å¾©é€£æ¥å¾Œé‡æ–°æª¢æŸ¥

6. **Intent Registry æª¢æŸ¥**
   - ä¾è³´ ArangoDB é€£æ¥ä¿®å¾©
   - ç¢ºèªæ˜¯å¦åŒ…å« 30 å€‹æ ¸å¿ƒ Intent

### ä½å„ªå…ˆç´š

7. **ChromaDB é€£æ¥æ¸¬è©¦**
   - éœ€è¦å¯¦éš›é€£æ¥æ¸¬è©¦
   - å¯åœ¨æ¸¬è©¦åŸ·è¡Œæ™‚é©—è­‰

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡Œå‹•è¨ˆåŠƒ

### ç«‹å³åŸ·è¡Œ

1. **ä¿®å¾© ArangoDB é€£æ¥**
   ```bash
   # æª¢æŸ¥ .env æ–‡ä»¶
   cat .env | grep ARANGO
   
   # æ¸¬è©¦é€£æ¥
   python3 -c "from database.arangodb.client import ArangoDBClient; client = ArangoDBClient(); print('OK')"
   ```

2. **ä¿®å¾© Capability Registry å¾ªç’°å°å…¥**
   - æª¢æŸ¥ `services/api/services/capability_registry_store_service.py`
   - æª¢æŸ¥ `agents/task_analyzer/rag_service.py`
   - ä½¿ç”¨å»¶é²å°å…¥æˆ–é‡æ§‹

3. **ä¿®å¾© ExecutionRecord Store å°å…¥**
   - æ›´æ–°å°å…¥èªå¥æˆ–æ·»åŠ åˆ¥å

4. **å‰µå»ºæ¸¬è©¦è…³æœ¬**
   - åƒè€ƒ v3 ç‰ˆæœ¬æ¸¬è©¦è…³æœ¬
   - æ ¹æ“šæ¸¬è©¦è¨ˆåŠƒå‰µå»º v4 ç‰ˆæœ¬

### ä¿®å¾©å¾Œé‡æ–°æª¢æŸ¥

5. **é‡æ–°é‹è¡Œæª¢æŸ¥è…³æœ¬**
   - ç¢ºèªæ‰€æœ‰æª¢æŸ¥é …é€šé
   - ç¢ºèª System Agent è¨»å†Šç‹€æ…‹æ­£ç¢º
   - ç¢ºèª v4 æ¶æ§‹çµ„ä»¶æ­£å¸¸

6. **åŸ·è¡Œæ¸¬è©¦**
   - é‹è¡Œæ¸¬è©¦è…³æœ¬
   - é©—è­‰æ¸¬è©¦çµæœ

---

## âœ… æª¢æŸ¥æ¸…å–®

æ ¹æ“šæ¸¬è©¦è¨ˆåŠƒæ–‡æª”çš„æª¢æŸ¥æ¸…å–®ï¼š

### 1. System Agent è¨»å†Šç‹€æ…‹ âœ…

- [ ] ç¢ºèªæ‰€æœ‰ System Agents å·²è¨»å†Šåˆ° System Agent Registry Store
- [ ] ç¢ºèª `md-editor` å·²è¨»å†Šä¸” `is_active=True`, `status="online"`
- [ ] ç¢ºèª `xls-editor` å·²è¨»å†Šä¸” `is_active=True`, `status="online"`
- [ ] ç¢ºèª `md-to-pdf` å·²è¨»å†Šä¸” `is_active=True`, `status="online"`
- [ ] ç¢ºèª `xls-to-pdf` å·²è¨»å†Šä¸” `is_active=True`, `status="online"`
- [ ] ç¢ºèª `pdf-to-md` å·²è¨»å†Šä¸” `is_active=True`, `status="online"`
- [ ] **ç¢ºèª `document-editing-agent` å·²æ¨™è¨˜ç‚º `is_active=False`, `status="offline"`**

### 2. v4 æ¶æ§‹çµ„ä»¶ç‹€æ…‹ âœ…

- [ ] ç¢ºèª Intent Registry å·²åˆå§‹åŒ–ä¸¦åŒ…å« 30 å€‹æ ¸å¿ƒ Intent
- [ ] ç¢ºèª Capability Registry å·²åˆå§‹åŒ–ä¸¦åŒ…å«æ‰€æœ‰ Agent çš„ Capability
- [ ] ç¢ºèª RAG-2ï¼ˆCapability Discoveryï¼‰å·²åˆå§‹åŒ–ä¸¦åŒ…å« Capability å‘é‡
- [ ] ç¢ºèª RAG-3ï¼ˆPolicy & Constraintï¼‰å·²åˆå§‹åŒ–ä¸¦åŒ…å«ç­–ç•¥å‘é‡
- [ ] ç¢ºèª Policy Service å·²é…ç½®ä¸¦åŒ…å«å¿…è¦çš„è¦å‰‡
- [ ] ç¢ºèª Task Planner å·²å¯¦ç¾ä¸¦å¯ä»¥ç”Ÿæˆ Task DAG
- [ ] ç¢ºèª ExecutionRecord Store å·²é…ç½®

### 3. æ¸¬è©¦ç’°å¢ƒ âœ…

- [ ] ç¢ºèªæ¸¬è©¦è…³æœ¬å·²å‰µå»ºï¼ˆ`test_file_editing_agent_routing_v4.py`ï¼‰
- [ ] ç¢ºèªæ¸¬è©¦å ´æ™¯å·²å®šç¾©ï¼ˆ90 å€‹åŸºç¤å ´æ™¯ + L1-L5 å±¤ç´šæ¸¬è©¦ï¼‰
- [ ] ç¢ºèªæ¸¬è©¦ç’°å¢ƒé…ç½®æ­£ç¢ºï¼ˆArangoDB é€£æ¥ã€ChromaDB é€£æ¥ã€LLM é…ç½®ç­‰ï¼‰

---

## ğŸ“Š ç¸½çµ

**ç•¶å‰ç‹€æ…‹**: âŒ **æœªå°±ç·’**

**ä¸»è¦å•é¡Œ**:
1. ArangoDB é€£æ¥å¤±æ•—ï¼ˆé˜»å¡æ€§å•é¡Œï¼‰
2. Capability Registry å¾ªç’°å°å…¥ï¼ˆé˜»å¡æ€§å•é¡Œï¼‰
3. ExecutionRecord Store å°å…¥å•é¡Œ
4. æ¸¬è©¦è…³æœ¬æœªå‰µå»º

**å»ºè­°**: 
- å„ªå…ˆä¿®å¾© ArangoDB é€£æ¥å•é¡Œ
- ä¿®å¾©å¾ªç’°å°å…¥å•é¡Œ
- å‰µå»ºæ¸¬è©¦è…³æœ¬
- ä¿®å¾©å¾Œé‡æ–°æª¢æŸ¥æ‰€æœ‰é …ç›®

**é è¨ˆä¿®å¾©æ™‚é–“**: 1-2 å°æ™‚

---

**æœ€å¾Œæ›´æ–°æ—¥æœŸ**: 2026-01-12
