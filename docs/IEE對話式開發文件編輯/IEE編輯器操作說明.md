# IEE 式 Markdown 文件編輯器操作說明

**版本**: 1.0
**創建日期**: 2025-01-27
**創建人**: Daniel Chung
**最後修改日期**: 2025-01-27

---

## 📖 目錄

1. [概述](#概述)
2. [快速開始](#快速開始)
3. [基本操作](#基本操作)
4. [AI 編輯功能](#ai-編輯功能)
5. [審查與提交](#審查與提交)
6. [高級功能](#高級功能)
7. [快捷鍵參考](#快捷鍵參考)
8. [常見問題](#常見問題)
9. [最佳實踐](#最佳實踐)

---

## 概述

### 什麼是 IEE 編輯器？

IEE（Intelligent Editing Environment，智能編輯環境）是一個 AI 驅動的 Markdown 文件編輯器，類似於代碼開發 IDE。它允許您：

- 🤖 **與 AI 對話編輯文件**：透過自然語言指令，讓 AI 精準修改長篇文檔
- 📝 **非侵入式編輯**：所有修改先預覽，確認後才生效
- 🔍 **精準定位**：AI 能理解上下文，精確修改特定段落
- 📊 **結構化輸出**：支持 Mermaid 流程圖即時渲染
- 🔒 **安全控制**：編輯內容需經審查與提交後才生效

### 核心特性

1. **精準定位**：解決長文件中 AI 難以精確修改特定段落的痛點
2. **上下文理解**：整合 RAG（向量檢索）與知識圖譜，使 AI 能理解跨章節、跨檔案的關聯
3. **結構化輸出**：支持 Mermaid 流程圖即時渲染，讓文字與圖表同步協作
4. **安全控制**：編輯內容需經人工審查（Review）與正式提交（Commit）後才生效

---

## 快速開始

### 1. 打開編輯器

1. 登入 AI-Box 系統
2. 在右側文件面板中選擇要編輯的 Markdown 文件
3. 點擊右側面板頂部的「編輯」模式按鈕（位於「文件」和「預覽」按鈕旁邊）

### 2. 首次使用

首次打開編輯器時，系統會自動：

- 載入文件內容
- 建立編輯 Session
- 初始化 AI 助手

### 3. 界面介紹

IEE 編輯器集成在右側面板中，整體頁面布局如下：

```
┌─────────────────────────────────────────────────────────────────┐
│  左側聊天區域          │  右側面板（文件/預覽/編輯）            │
│                       │  ┌───────────────────────────────────┐ │
│  [聊天對話框]          │  │ [文件] [預覽] [編輯] ← 模式切換   │ │
│                       │  ├───────────────────────────────────┤ │
│  [輸入消息...]         │  │                                   │ │
│                       │  │     編輯器主區域                  │ │
│                       │  │   (Monaco Editor)                 │ │
│                       │  │                                   │ │
│                       │  │   [工具欄: 保存/審查/提交]        │ │
│                       │  │                                   │ │
│                       │  │   [大綱導航]                      │ │
│                       │  │                                   │ │
│                       │  │   [狀態欄]                        │ │
│                       │  └───────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

**右側面板三種模式**:

- **文件模式**: 顯示文件目錄樹和文件列表
- **預覽模式**: 顯示文件預覽（支持 Markdown、PDF、Word、Excel 等格式）
- **編輯模式**: 顯示 IEE 編輯器（僅支持 Markdown 文件）

**編輯模式特點**:

- 點擊「編輯」按鈕後，右側面板會推開，類似預覽模式的行為
- 編輯器佔據整個右側面板區域
- 與左側聊天區域並排顯示，不影響整體頁面布局
- 支持在編輯模式和預覽模式之間無縫切換

---

## 基本操作

### 打開文件

#### 方法 1：從右側面板打開（推薦）

1. 在右側面板的「文件」模式中，找到要編輯的 Markdown 文件
2. 點擊文件選中它
3. 點擊右側面板頂部的「編輯」模式按鈕
4. 編輯器會自動載入文件內容並進入編輯模式

**注意**:
- 只有 Markdown 文件（.md）才能進入編輯模式
- 其他格式（PDF、Word、Excel）只能使用預覽模式

#### 方法 2：從文件菜單打開

1. 在文件列表中，找到要編輯的 Markdown 文件
2. 右鍵點擊文件，選擇「使用 IEE 編輯器打開」
3. 系統會自動切換到右側面板的「編輯」模式

#### 方法 3：導入新文件

1. 在右側面板的「文件」模式中，點擊「新建」或「導入」按鈕
2. 選擇文件類型：
   - **Markdown 文件** (.md)：可以直接進入編輯模式
   - **PDF 文件** (.pdf)：需要先轉換為 Markdown（使用預覽模式查看轉換結果）
   - **Word 文件** (.docx)：需要先轉換為 Markdown（使用預覽模式查看轉換結果）
3. 等待文件處理完成後，Markdown 文件可以直接進入編輯模式

### 編輯文件

#### 手動編輯

- 直接在編輯器中輸入和修改文字
- 支持標準 Markdown 語法
- 語法高亮自動顯示

#### 自動保存

- 編輯器會自動保存您的修改（每 2 秒或停止輸入後）
- 狀態欄會顯示「已保存」或「保存中...」

### 查看文件大綱

在編輯模式下，編輯器左側會顯示大綱面板：

- 所有標題（H1-H6）
- 點擊標題可快速跳轉到對應位置
- 當前位置會自動高亮顯示

### 切換模式

在右側面板頂部，您可以隨時切換三種模式：

- **文件模式**: 查看和管理文件
- **預覽模式**: 預覽文件內容（支持多種格式）
- **編輯模式**: 編輯 Markdown 文件（僅支持 .md 文件）

**切換方式**:
- 點擊對應的模式按鈕即可切換
- 編輯模式會自動保存當前編輯內容
- 切換到預覽模式可以查看渲染效果

### 搜索和替換

1. 按 `Ctrl+F` (Windows/Linux) 或 `Cmd+F` (Mac) 打開搜索框
2. 輸入要搜索的文字
3. 使用 `Enter` 或點擊箭頭按鈕跳轉到下一個匹配項
4. 按 `Ctrl+H` 打開替換功能

---

## AI 編輯功能

### 基本使用流程

1. **選擇要編輯的內容**（可選）
   - 選中要修改的文字段落
   - 或將游標放在要修改的位置

2. **輸入編輯指令**
   - 在底部 AI 助手對話框中輸入指令
   - 例如：「幫我優化這段文字」、「在標題下添加一個段落」

3. **AI 處理**
   - AI 會分析您的指令和上下文
   - 生成修改建議

4. **預覽修改**
   - 編輯器中會顯示修改建議（綠色高亮表示新增，紅色劃線表示刪除）
   - 側邊欄會顯示 `✓` (接受) 和 `✗` (拒絕) 按鈕

5. **接受或拒絕**
   - 點擊 `✓` 接受修改
   - 點擊 `✗` 拒絕修改
   - 可以逐個審查每個修改建議

### 編輯指令範例

#### 文字優化

```
指令：幫我優化這段文字，讓它更簡潔易懂
選中：要優化的文字段落
```

#### 內容插入

```
指令：在「系統架構」標題下添加一個關於「快取機制」的子章節
游標位置：放在「系統架構」標題下方
```

#### 內容修改

```
指令：將這段程式碼範例改為 Python 3.11 語法
選中：程式碼區塊
```

#### 結構調整

```
指令：將這個列表改為表格格式
選中：列表內容
```

#### Mermaid 圖表生成

```
指令：為這個流程生成一個 Mermaid 流程圖
選中：流程描述文字
```

### 流式預覽

當 AI 正在生成修改建議時：

- 編輯器中會即時顯示正在生成的內容（綠色高亮）
- 您可以隨時中斷生成過程
- 生成完成後，可以審查完整的修改建議

### 模糊匹配

如果文件在 AI 處理期間被修改：

- 系統會自動使用模糊匹配算法定位修改位置
- 如果無法匹配，會提示您重新應用修改

---

## 審查與提交

### 審查模式

當您完成編輯後，可以進入審查模式：

1. **點擊「審查」按鈕**
   - 編輯器會切換到審查視圖
   - 顯示雙欄對比（左側：原始版本，右側：修改後版本）

2. **逐條確認修改**
   - 使用「上一個變更」/「下一個變更」按鈕導航
   - 每個修改點都會高亮顯示
   - 可以逐個接受或拒絕修改

3. **查看變更摘要**
   - AI 會自動生成變更摘要
   - 顯示在審查視圖頂部
   - 您可以手動編輯摘要

### 提交修改

1. **確認所有修改**
   - 在審查模式中確認所有修改
   - 或直接點擊「提交」按鈕

2. **填寫提交信息**
   - 系統會預填 AI 生成的變更摘要
   - 您可以手動編輯或補充

3. **提交**
   - 點擊「確認提交」按鈕
   - 系統會：
     - 保存修改到文件
     - 創建新版本
     - 更新向量索引（僅針對修改的段落）
     - 更新知識圖譜（如涉及實體變更）

4. **版本歷史**
   - 提交後，可以在版本歷史中查看所有版本
   - 支持版本回滾

### 版本管理

#### 查看版本歷史

1. 點擊「版本歷史」按鈕
2. 查看所有版本的列表
3. 點擊版本可查看該版本的內容

#### 版本回滾

1. 在版本歷史中選擇要回滾的版本
2. 點擊「回滾到此版本」
3. 確認回滾操作

---

## 高級功能

### Mermaid 圖表

#### 創建 Mermaid 圖表

1. 在編輯器中輸入 Mermaid 代碼塊：

   ````markdown
   ```mermaid
   graph TD
       A[開始] --> B[處理]
       B --> C[結束]
   ```
   ````

2. 編輯器會自動在代碼塊下方顯示渲染後的圖表

3. 支持以下圖表類型：
   - 流程圖 (flowchart)
   - 序列圖 (sequenceDiagram)
   - 甘特圖 (gantt)
   - 類圖 (classDiagram)
   - 狀態圖 (stateDiagram)

#### 使用 AI 生成 Mermaid 圖表

```
指令：為這個流程生成一個 Mermaid 流程圖
選中：流程描述文字
```

### 模組化文檔

對於超長文件，可以使用模組化架構：

#### 創建主文檔

- 主文檔包含目錄和各分段的引用
- 使用 `![[filename]]` 語法引用分文檔

#### 自動拆解

- 導入長篇 PDF/Word 時，系統會自動：
  - 根據 H1-H3 標題自動切分
  - 創建主文檔和分文檔
  - 建立引用關係

#### 虛擬合併預覽

- 在主文檔中滾動時，系統會自動載入分文檔內容
- 呈現如同單一文件的連續視感

### 上下文引用

#### 使用 @ 提及

- 在編輯指令中使用 `@文件名` 引用其他文件
- AI 會自動檢索相關內容作為上下文

範例：

```
指令：參考 @系統架構.md 中的設計，更新這段描述
```

### 多文件編輯

#### 同時編輯多個文件

1. 打開多個文件標籤
2. 在 AI 指令中指定要編輯的文件
3. AI 會自動切換到對應文件進行編輯

---

## 快捷鍵參考

### 編輯快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| `Ctrl+S` / `Cmd+S` | 保存文件 |
| `Ctrl+F` / `Cmd+F` | 搜索 |
| `Ctrl+H` / `Cmd+H` | 替換 |
| `Ctrl+Z` / `Cmd+Z` | 撤銷 |
| `Ctrl+Y` / `Cmd+Y` | 重做 |
| `Ctrl+/` / `Cmd+/` | 切換註釋 |
| `Alt+↑/↓` | 移動行 |
| `Shift+Alt+↑/↓` | 複製行 |

### 導航快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| `Ctrl+G` / `Cmd+G` | 跳轉到行 |
| `Ctrl+P` / `Cmd+P` | 快速打開文件 |
| `Ctrl+B` / `Cmd+B` | 切換側邊欄 |
| `Ctrl+J` / `Cmd+J` | 切換面板 |

### AI 編輯快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| `Ctrl+Enter` / `Cmd+Enter` | 接受當前修改建議（在編輯模式中） |
| `Ctrl+Shift+Enter` / `Cmd+Shift+Enter` | 拒絕當前修改建議（在編輯模式中） |
| `Ctrl+K` / `Cmd+K` | 快速 AI 編輯（選中文字後，需在聊天區域使用） |
| `Esc` | 取消當前 AI 建議 |

### 審查快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| `Ctrl+Shift+R` / `Cmd+Shift+R` | 進入審查模式（待實現） |
| `Ctrl+.]` | 下一個變更（待實現） |
| `Ctrl+,[` | 上一個變更（待實現） |
| `Ctrl+Enter` | 接受當前修改（在編輯模式中） |
| `Ctrl+Shift+Enter` | 拒絕當前修改（在編輯模式中） |

---

## 常見問題

### Q1: AI 修改建議不準確怎麼辦？

**A**: 您可以：

1. 拒絕不準確的修改建議
2. 提供更詳細的編輯指令
3. 選中更具體的上下文範圍
4. 使用 `@文件名` 引用相關文件提供更多上下文

### Q2: 如何撤銷 AI 的修改？

**A**:

- **未提交前**：使用 `Ctrl+Z` 撤銷，或點擊 `✗` 拒絕修改建議
- **已提交後**：在版本歷史中回滾到之前的版本

### Q3: 文件太大，編輯器反應慢怎麼辦？

**A**:

- 使用模組化文檔架構，將大文件拆分為多個小文件
- 系統會自動使用虛擬合併預覽，保持流暢體驗

### Q4: Mermaid 圖表無法渲染？

**A**:

- 檢查 Mermaid 語法是否正確
- 查看編輯器底部的錯誤提示
- 參考 [Mermaid 官方文檔](https://mermaid.js.org/)

### Q5: PDF/Word 轉換後格式不對？

**A**:

- 系統會盡量保留原始格式，但複雜的排版可能需要手動調整
- 建議：
  - 使用結構清晰的原始文件
  - 轉換後檢查並手動調整格式

### Q6: 如何查看文件的修改歷史？

**A**:

1. 點擊「版本歷史」按鈕
2. 查看所有版本的列表和摘要
3. 點擊版本可查看詳細內容

### Q7: 可以同時編輯多個文件嗎？

**A**:

- 目前不支持同時編輯多個文件
- 您可以：
  - 在編輯模式中編輯一個文件
  - 切換到文件模式選擇另一個文件
  - 再切換回編輯模式編輯新文件
  - 系統會自動保存當前編輯內容

### Q8: AI 編輯會消耗 Token 嗎？

**A**:

- 是的，AI 編輯會消耗 Token
- 系統使用增量更新策略，只重新索引修改的段落，節省 Token
- 可以在設置中查看 Token 使用情況

---

## 最佳實踐

### 1. 編輯指令撰寫技巧

#### ✅ 好的指令範例

- 「在『系統架構』標題下添加一個關於『快取機制』的子章節，包含 Redis 和 Memcached 的比較」
- 「優化這段文字，讓它更簡潔易懂，保留技術細節」
- 「將這個列表改為表格格式，包含名稱、描述、狀態三列」

#### ❌ 不好的指令範例

- 「改一下」（太模糊）
- 「全部重寫」（違反非侵入式編輯原則）
- 「隨便改改」（沒有明確目標）

### 2. 文件組織建議

#### 使用模組化架構

- 對於超過 10,000 字的文件，建議使用模組化架構
- 主文檔包含目錄和引用
- 分文檔專注於具體章節內容

#### 標題層級清晰

- 使用清晰的標題層級（H1-H3）
- 有助於 AI 理解文件結構
- 有助於自動切片和導航

### 3. 審查流程建議

1. **先預覽再提交**
   - 使用審查模式逐條確認修改
   - 不要直接提交未審查的修改

2. **填寫清晰的提交信息**
   - 使用 AI 生成的摘要作為基礎
   - 補充重要的變更說明

3. **定期提交**
   - 完成一個邏輯單元後就提交
   - 避免累積太多修改一次性提交

### 4. 版本管理建議

1. **重要節點創建版本**
   - 完成重要章節後創建版本
   - 重大修改前創建版本

2. **使用有意義的版本摘要**
   - 清楚描述本次修改的內容
   - 方便後續查找和回滾

### 5. 性能優化建議

1. **避免過大的文件**
   - 單個文件建議不超過 50,000 字
   - 使用模組化架構拆分大文件

2. **合理使用 AI 編輯**
   - 避免頻繁的小修改
   - 累積多個相關修改後一次性處理

3. **定期清理未使用的版本**
   - 保留重要版本
   - 刪除臨時和測試版本

---

## 技術支持

### 獲取幫助

- **文檔**: 查看 [開發規格書](./AI-Box-IEE-式-Markdown-文件編輯器開發規格書.md)
- **問題反饋**: 提交 GitHub Issue
- **功能建議**: 聯繫開發團隊

### 系統要求

- **瀏覽器**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **網絡**: 穩定的網絡連接（AI 功能需要）
- **權限**: 文件編輯權限

---

**文檔版本**: 1.1
**最後更新**: 2025-12-20
**維護者**: Daniel Chung

---

## 📋 更新記錄

### 2025-12-20 更新

- ✅ **UI 布局調整**: IEE 編輯器改為右側面板的「編輯」模式
  - 右側面板新增「編輯」模式按鈕，與「文件」和「預覽」模式並列
  - 編輯模式類似預覽模式，會推開右側區域
  - 編輯模式僅支持 Markdown 文件（.md）
  - 支持在編輯模式和預覽模式之間無縫切換
- ✅ **操作流程優化**:
  - 更新了打開編輯器的方法說明
  - 更新了界面介紹，說明新的布局方式
  - 更新了快捷鍵說明，反映實際功能
