# ç¬¬ä¸‰éšæ®µå‰ç«¯ç•Œé¢é–‹ç™¼ - å®Œæˆç¸½çµ

**å®Œæˆæ—¥æœŸ**: 2026-01-17
**å‰µå»ºäºº**: Daniel Chung

---

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. API å‡½æ•¸ (lib/api.ts)

å·²åœ¨ `ai-bot/src/lib/api.ts` ä¸­æ·»åŠ å®Œæ•´çš„ç³»çµ±ç®¡ç† API å‡½æ•¸:

- **æœå‹™ç›£æ§ API**: `getServices()`, `getServiceStatus()`, `checkServiceHealth()`, `getServiceLogs()`
- **ç”¨æˆ¶ç®¡ç† API**: `getUsers()`, `getUserDetail()`, `createUser()`, `updateUser()`, `deleteUser()`, `resetUserPassword()`, `toggleUserActive()`
- **ç³»çµ±é…ç½® API**: `getSystemConfigs()`, `getSystemConfig()`, `updateSystemConfig()`
- **Agent ç”³è«‹ç®¡ç† API**: `getAgentRequests()`, `getAgentRequestDetail()`, `approveAgentRequest()`, `rejectAgentRequest()`, `revokeAgentRequest()`

### 2. ç³»çµ±ç®¡ç†é é¢çµ„ä»¶

#### 2.1 ç³»çµ±æœå‹™ç‹€æ…‹é é¢ (SystemServiceStatus.tsx)

- **ä½ç½®**: `ai-bot/src/pages/SystemServiceStatus.tsx`
- **åŠŸèƒ½**:
  - é¡¯ç¤ºæ‰€æœ‰ç³»çµ±æœå‹™ç‹€æ…‹å¡ç‰‡
  - æ•´é«”å¥åº·ç‹€æ…‹ç™¾åˆ†æ¯”
  - è‡ªå‹•åˆ·æ–° (æ¯ 30 ç§’)
  - æœå‹™è©³æƒ…æŸ¥çœ‹
  - æœå‹™æ—¥èªŒæŸ¥çœ‹
  - Dashboard æµ®å‹•è¦–çª—

#### 2.2 è³¬è™Ÿ/å®‰å…¨ç¾¤çµ„è¨­ç½®é é¢ (AccountSecuritySettings.tsx)

- **ä½ç½®**: `ai-bot/src/pages/AccountSecuritySettings.tsx`
- **åŠŸèƒ½**:
  - ç”¨æˆ¶åˆ—è¡¨å±•ç¤º (è¡¨æ ¼å½¢å¼)
  - ç”¨æˆ¶æœç´¢å’Œåˆ†é 
  - å‰µå»º/ç·¨è¼¯/åˆªé™¤ç”¨æˆ¶
  - é‡ç½®ç”¨æˆ¶å¯†ç¢¼
  - åˆ‡æ›ç”¨æˆ¶å•Ÿç”¨/ç¦ç”¨ç‹€æ…‹
  - ç”¨æˆ¶è§’è‰²ç®¡ç†

#### 2.3 ç³»çµ±è¨­ç½®é é¢ (SystemSettings.tsx)

- **ä½ç½®**: `ai-bot/src/pages/SystemSettings.tsx`
- **åŠŸèƒ½**:
  - é…ç½®åˆ—è¡¨å±•ç¤º (æŒ‰é¡åˆ¥åˆ†çµ„)
  - é…ç½®æœç´¢
  - é…ç½®ç·¨è¼¯å™¨ (æ”¯æŒå­—ç¬¦ä¸²ã€æ•¸å­—ã€å¸ƒçˆ¾å€¼ã€JSON å°è±¡)
  - é…ç½®é¡åˆ¥æ¨™ç±¤é  (åŸºç¤é…ç½®ã€åŠŸèƒ½é–‹é—œã€æ€§èƒ½åƒæ•¸ã€å®‰å…¨åƒæ•¸ã€æ¥­å‹™åƒæ•¸)

#### 2.4 Agent ç”³è«‹å¯©æŸ¥é é¢ (AgentRequestManagement.tsx)

- **ä½ç½®**: `ai-bot/src/pages/AgentRequestManagement.tsx`
- **åŠŸèƒ½**:
  - Agent ç”³è«‹åˆ—è¡¨å±•ç¤º (è¡¨æ ¼å½¢å¼)
  - ç”³è«‹ç‹€æ…‹éæ¿¾ (å¾…å¯©æ ¸/å·²æ‰¹å‡†/å·²æ‹’çµ•/å·²æ’¤éŠ·)
  - ç”³è«‹è©³æƒ…æŸ¥çœ‹ (åŸºæœ¬ä¿¡æ¯ã€ç”³è«‹è€…ä¿¡æ¯ã€Agent é…ç½®ã€è«‹æ±‚çš„æ¬Šé™)
  - æ‰¹å‡†ç”³è«‹ (ç”Ÿæˆ Secret ID/Key,åƒ…é¡¯ç¤ºä¸€æ¬¡)
  - æ‹’çµ•ç”³è«‹ (éœ€å¡«å¯«åŸå› )
  - æ’¤éŠ·å·²æ‰¹å‡†çš„ç”³è«‹ (éœ€å¡«å¯«åŸå› )

### 3. æ”¯æŒçµ„ä»¶

#### 3.1 æœå‹™ç‹€æ…‹å¡ç‰‡ (ServiceStatusCard.tsx)

- **ä½ç½®**: `ai-bot/src/components/SystemAdmin/ServiceStatusCard.tsx`
- **åŠŸèƒ½**: é¡¯ç¤ºå–®å€‹æœå‹™çš„ç‹€æ…‹ã€å¥åº·åº¦ã€å…ƒæ•¸æ“šã€æ“ä½œæŒ‰éˆ•

#### 3.2 æœå‹™æ—¥èªŒæŸ¥çœ‹å™¨ (ServiceLogViewer.tsx)

- **ä½ç½®**: `ai-bot/src/components/SystemAdmin/ServiceLogViewer.tsx`
- **åŠŸèƒ½**: æ—¥èªŒæŸ¥çœ‹ã€æ™‚é–“ç¯„åœéæ¿¾ã€æ—¥èªŒç´šåˆ¥éæ¿¾ã€é—œéµå­—æœç´¢ã€å…¨å±æ¨¡å¼

#### 3.3 Dashboard æµ®å‹•è¦–çª— (DashboardModal.tsx)

- **ä½ç½®**: `ai-bot/src/components/SystemAdmin/DashboardModal.tsx`
- **åŠŸèƒ½**: åœ¨ Modal ä¸­é¡¯ç¤ºæœå‹™ Dashboard (ArangoDB, RQ, SeaweedFS)

### 4. è·¯ç”±é…ç½® (App.tsx)

#### 4.1 æ›´æ–° AuthContext

- **æ–‡ä»¶**: `ai-bot/src/contexts/authContext.ts`
- **æ›´æ–°å…§å®¹**:
  - æ·»åŠ  `User` æ¥å£ (åŒ…å« `roles` å­—æ®µ)
  - æ›´æ–° `AuthContextType` æ¥å£,æ·»åŠ  `currentUser` å’Œ `setCurrentUser`

#### 4.2 æ·»åŠ ç³»çµ±ç®¡ç†è·¯ç”±

- **æ–‡ä»¶**: `ai-bot/src/App.tsx`
- **è·¯ç”±åˆ—è¡¨**:
  - `/admin/services` - ç³»çµ±æœå‹™ç‹€æ…‹
  - `/admin/accounts` - è³¬è™Ÿ/å®‰å…¨ç¾¤çµ„è¨­ç½®
  - `/admin/settings` - ç³»çµ±è¨­ç½®
  - `/admin/agent-requests` - Agent ç”³è«‹å¯©æŸ¥

#### 4.3 æ¬Šé™æª¢æŸ¥çµ„ä»¶ (AdminRoute)

- **åŠŸèƒ½**: æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦å…·æœ‰ `system_admin` è§’è‰²,éç³»çµ±ç®¡ç†å“¡ç„¡æ³•è¨ªå•

---

## ğŸ“‹ å¾…å®Œæˆå·¥ä½œ

### 1. åœ¨ä¸»é é¢æ·»åŠ ç³»çµ±ç®¡ç†èœå–®å…¥å£ âš ï¸ **é‡è¦**

æ ¹æ“šæ–‡æª”è¦æ ¼,ç³»çµ±ç®¡ç†èœå–®æ‡‰è©²åœ¨"ai-bot å‰ç«¯å³ä¸Šè§’ System è¨­ç½®æŒ‰éˆ•ä¸‹"ã€‚éœ€è¦å®Œæˆä»¥ä¸‹æ­¥é©Ÿ:

#### 1.1 æ‰¾åˆ°æˆ–å‰µå»º System è¨­ç½®æŒ‰éˆ•

- åœ¨ Home.tsx æˆ–ä¸»è¦å¸ƒå±€çµ„ä»¶ä¸­æ·»åŠ  System è¨­ç½®æŒ‰éˆ•
- ä½ç½®å»ºè­°:å³ä¸Šè§’,ç”¨æˆ¶é ­åƒæˆ–ä¸»èœå–®æ—é‚Š

#### 1.2 æ·»åŠ ä¸‹æ‹‰èœå–®

å‰µå»ºåŒ…å«ä»¥ä¸‹é¸é …çš„ä¸‹æ‹‰èœå–® (åƒ…å° `system_admin` è§’è‰²ç”¨æˆ¶é¡¯ç¤º):

```
System (è¨­ç½®æŒ‰éˆ•)
â”œâ”€â”€ System Service Status (ç³»çµ±æœå‹™ç‹€æ…‹) â†’ /admin/services
â”œâ”€â”€ Account / Security Group Settings (è³¬è™Ÿ/å®‰å…¨ç¾¤çµ„è¨­ç½®) â†’ /admin/accounts
â”œâ”€â”€ Agent Request Management (Agent ç”³è«‹å¯©æŸ¥) â†’ /admin/agent-requests
â””â”€â”€ System Setting (ç³»çµ±è¨­ç½®) â†’ /admin/settings
```

#### 1.3 å¯¦ç¾å»ºè­°

å¯ä»¥åœ¨ `Home.tsx` ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç¢¼çµæ§‹:

```typescript
// åœ¨ Home.tsx ä¸­æ·»åŠ ç‹€æ…‹
const { currentUser } = useContext(AuthContext);
const [showSystemMenu, setShowSystemMenu] = useState(false);
const isSystemAdmin = currentUser?.roles?.includes('system_admin') || false;

// åœ¨æ¸²æŸ“éƒ¨åˆ†æ·»åŠ èœå–®æŒ‰éˆ• (å»ºè­°æ”¾åœ¨å³ä¸Šè§’)
{isSystemAdmin && (
  <div className="relative">
    <button
      onClick={() => setShowSystemMenu(!showSystemMenu)}
      className="p-2 rounded-full hover:bg-gray-200 transition-colors"
      title="ç³»çµ±ç®¡ç†"
    >
      <Settings size={24} />
    </button>

    {showSystemMenu && (
      <div className="absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg border border-gray-200 z-50">
        <Link to="/admin/services" className="block px-4 py-2 hover:bg-gray-100">
          ç³»çµ±æœå‹™ç‹€æ…‹
        </Link>
        <Link to="/admin/accounts" className="block px-4 py-2 hover:bg-gray-100">
          è³¬è™Ÿ/å®‰å…¨ç¾¤çµ„è¨­ç½®
        </Link>
        <Link to="/admin/agent-requests" className="block px-4 py-2 hover:bg-gray-100">
          Agent ç”³è«‹å¯©æŸ¥
        </Link>
        <Link to="/admin/settings" className="block px-4 py-2 hover:bg-gray-100">
          ç³»çµ±è¨­ç½®
        </Link>
      </div>
    )}
  </div>
)}
```

### 2. ç”¨æˆ¶ç™»éŒ„æ™‚ä¿å­˜ç”¨æˆ¶è§’è‰²ä¿¡æ¯

ç¢ºä¿åœ¨ç”¨æˆ¶ç™»éŒ„æ™‚,å°‡ç”¨æˆ¶è§’è‰²ä¿¡æ¯ä¿å­˜åˆ° `localStorage`:

```typescript
// åœ¨ LoginPage.tsx æˆ–ç™»éŒ„è™•ç†å‡½æ•¸ä¸­
localStorage.setItem('currentUser', JSON.stringify({
  user_id: userData.user_id,
  username: userData.username,
  email: userData.email,
  roles: userData.roles, // ç¢ºä¿åŒ…å«è§’è‰²ä¿¡æ¯
}));
```

### 3. æ¸¬è©¦æ¬Šé™æª¢æŸ¥

- æ¸¬è©¦éç³»çµ±ç®¡ç†å“¡ç”¨æˆ¶ç„¡æ³•è¨ªå•ç³»çµ±ç®¡ç†é é¢ (æ‡‰é‡å®šå‘åˆ° `/home`)
- æ¸¬è©¦ç³»çµ±ç®¡ç†å“¡ç”¨æˆ¶å¯ä»¥æ­£å¸¸è¨ªå•æ‰€æœ‰ç³»çµ±ç®¡ç†é é¢

### 4. æ¨£å¼å„ªåŒ– (å¯é¸)

- æ ¹æ“šé …ç›®çš„æ•´é«”è¨­è¨ˆé¢¨æ ¼èª¿æ•´é¡è‰²ã€å­—é«”ã€é–“è·ç­‰
- ç¢ºä¿æ‰€æœ‰çµ„ä»¶åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹éƒ½èƒ½æ­£å¸¸é¡¯ç¤º (éŸ¿æ‡‰å¼è¨­è¨ˆ)

---

## ğŸ”§ æŠ€è¡“ç´°ç¯€

### çµ„ä»¶çµæ§‹

```
ai-bot/src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ SystemServiceStatus.tsx          # ç³»çµ±æœå‹™ç‹€æ…‹é é¢
â”‚   â”œâ”€â”€ AccountSecuritySettings.tsx      # è³¬è™Ÿ/å®‰å…¨ç¾¤çµ„è¨­ç½®é é¢
â”‚   â”œâ”€â”€ SystemSettings.tsx               # ç³»çµ±è¨­ç½®é é¢
â”‚   â””â”€â”€ AgentRequestManagement.tsx       # Agent ç”³è«‹å¯©æŸ¥é é¢
â”œâ”€â”€ components/
â”‚   â””â”€â”€ SystemAdmin/
â”‚       â”œâ”€â”€ ServiceStatusCard.tsx        # æœå‹™ç‹€æ…‹å¡ç‰‡
â”‚       â”œâ”€â”€ ServiceLogViewer.tsx         # æœå‹™æ—¥èªŒæŸ¥çœ‹å™¨
â”‚       â””â”€â”€ DashboardModal.tsx           # Dashboard æµ®å‹•è¦–çª—
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ api.ts                           # API å‡½æ•¸ (å·²æ“´å±•)
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ authContext.ts                   # èªè­‰ä¸Šä¸‹æ–‡ (å·²æ›´æ–°)
â””â”€â”€ App.tsx                              # è·¯ç”±é…ç½® (å·²æ›´æ–°)
```

### ä¾è³´é …

ç¢ºä¿é …ç›®å·²å®‰è£ä»¥ä¸‹ä¾è³´:

- `react-router-dom` - è·¯ç”±ç®¡ç†
- `lucide-react` - åœ–æ¨™åº« (ç”¨æ–¼çµ„ä»¶ä¸­çš„åœ–æ¨™)

### API ç«¯é»å‡è¨­

æ‰€æœ‰ API å‡½æ•¸å‡è¨­å¾Œç«¯æä¾›ä»¥ä¸‹ç«¯é»:

- `GET /api/admin/services` - ç²å–æœå‹™åˆ—è¡¨
- `GET /api/admin/services/{service_name}` - ç²å–æœå‹™è©³æƒ…
- `POST /api/admin/services/{service_name}/check` - æ‰‹å‹•è§¸ç™¼å¥åº·æª¢æŸ¥
- `GET /api/admin/services/{service_name}/logs` - ç²å–æœå‹™æ—¥èªŒ
- `GET /api/admin/users` - ç²å–ç”¨æˆ¶åˆ—è¡¨
- `POST /api/admin/users` - å‰µå»ºç”¨æˆ¶
- `PUT /api/admin/users/{user_id}` - æ›´æ–°ç”¨æˆ¶
- `DELETE /api/admin/users/{user_id}` - åˆªé™¤ç”¨æˆ¶
- `POST /api/admin/users/{user_id}/reset-password` - é‡ç½®å¯†ç¢¼
- `POST /api/admin/users/{user_id}/toggle-active` - åˆ‡æ›å•Ÿç”¨ç‹€æ…‹
- `GET /api/admin/system-configs` - ç²å–ç³»çµ±é…ç½®åˆ—è¡¨
- `PUT /api/admin/system-configs/{scope}` - æ›´æ–°ç³»çµ±é…ç½®
- `GET /api/admin/agent-requests` - ç²å– Agent ç”³è«‹åˆ—è¡¨
- `GET /api/admin/agent-requests/{request_id}` - ç²å–ç”³è«‹è©³æƒ…
- `POST /api/admin/agent-requests/{request_id}/approve` - æ‰¹å‡†ç”³è«‹
- `POST /api/admin/agent-requests/{request_id}/reject` - æ‹’çµ•ç”³è«‹
- `POST /api/admin/agent-requests/{request_id}/revoke` - æ’¤éŠ·ç”³è«‹

---

## ğŸ“ å¾ŒçºŒå»ºè­°

1. **å¯¦ç¾ç³»çµ±èœå–®å…¥å£**: é€™æ˜¯ä½¿ç”¨ç³»çµ±ç®¡ç†åŠŸèƒ½çš„å”¯ä¸€æ–¹å¼,å„ªå…ˆç´šæœ€é«˜
2. **æ¸¬è©¦æ‰€æœ‰é é¢**: ç¢ºä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ,API èª¿ç”¨æˆåŠŸ
3. **éŒ¯èª¤è™•ç†å„ªåŒ–**: æ·»åŠ æ›´å‹å¥½çš„éŒ¯èª¤æç¤ºå’Œè™•ç†
4. **æ€§èƒ½å„ªåŒ–**: è€ƒæ…®æ·»åŠ åŠ è¼‰ç‹€æ…‹ã€åˆ†é å„ªåŒ–ç­‰
5. **å®‰å…¨æ€§å¢å¼·**: ç¢ºä¿æ‰€æœ‰æ•æ„Ÿæ“ä½œéƒ½æœ‰ç¢ºèªå°è©±æ¡†

---

## ğŸ¯ é …ç›®é€²åº¦æ›´æ–°å»ºè­°

è«‹åœ¨ `docs/ç³»ç»Ÿè®¾è®¡æ–‡æ¡£/æ ¸å¿ƒç»„ä»¶/ç³»çµ±ç®¡ç†/ç³»çµ±ç®¡ç†åŠŸèƒ½é–‹ç™¼è¨ˆåŠƒ.md` ä¸­æ›´æ–°ç¬¬ä¸‰éšæ®µçš„é€²åº¦:

- ä»»å‹™ 2.6: å‰ç«¯ç³»çµ±æœå‹™ç‹€æ…‹é é¢ - âœ… å·²å®Œæˆ
- ä»»å‹™ 3.4: å‰ç«¯è³¬è™Ÿ/å®‰å…¨ç¾¤çµ„è¨­ç½®é é¢ - âœ… å·²å®Œæˆ
- ä»»å‹™ 5.4: å‰ç«¯ç³»çµ±è¨­ç½®é é¢ - âœ… å·²å®Œæˆ
- ä»»å‹™ 4.7: Agent ç”³è«‹å¯©æŸ¥å‰ç«¯é é¢ - âœ… å·²å®Œæˆ

**éšæ®µé€²åº¦**: 80% (4/5 ä»»å‹™å®Œæˆ,å‰©é¤˜èœå–®å…¥å£é›†æˆ)
