# å¤§è¦æ¨¡æ‰¹é‡æ¸¬è©¦ä½¿ç”¨èªªæ˜

**å‰µå»ºæ—¥æœŸ**: 2026-01-02
**å‰µå»ºäºº**: Daniel Chung
**æœ€å¾Œä¿®æ”¹æ—¥æœŸ**: 2026-01-02

---

## ğŸ“‹ æ¦‚è¿°

æœ¬èªªæ˜æ–‡æª”ä»‹ç´¹å¦‚ä½•ä½¿ç”¨å¤§è¦æ¨¡æ‰¹é‡æ¸¬è©¦è…³æœ¬é€²è¡Œ100å€‹æ–‡ä»¶çš„ä¸Šå‚³ã€å‘é‡åŒ–å’ŒçŸ¥è­˜åœ–è­œæå–æ¸¬è©¦ã€‚

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. æº–å‚™ç’°å¢ƒ

ç¢ºä¿æ‰€æœ‰æœå‹™æ­£å¸¸é‹è¡Œï¼š

```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
./scripts/start_services.sh status

# ç¢ºèª RQ Worker æ­£åœ¨é‹è¡Œ
ps aux | grep rq_worker

# ç¢ºèª API æœå‹™æ­£åœ¨é‹è¡Œ
ps aux | grep uvicorn
```

### 2. é‹è¡Œæ¸¬è©¦

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨é‹è¡Œè…³æœ¬ï¼ˆæ¨è–¦ï¼‰

```bash
# å¾Œå°é‹è¡Œæ¸¬è©¦
./scripts/run_batch_test_100.sh
```

#### æ–¹æ³•äºŒï¼šç›´æ¥é‹è¡Œ Python è…³æœ¬

```bash
# å¾Œå°é‹è¡Œ
nohup python3 scripts/kg_extract_batch_test_100.py \
    --file-list scripts/batch_test_100_files.txt \
    --max-files 100 \
    --concurrent 5 \
    --output batch_test_100_results.json \
    --progress batch_test_100_progress.json \
    --retry-failed \
    > batch_test_100.log 2>&1 &

# æŸ¥çœ‹ PID
echo $! > batch_test_100.pid
```

---

## ğŸ“Š ç›£æ§æ¸¬è©¦é€²åº¦

### å¯¦æ™‚ç›£æ§

```bash
# ä½¿ç”¨ç›£æ§è…³æœ¬ï¼ˆè‡ªå‹•åˆ·æ–°ï¼Œæ¯5ç§’ï¼‰
./scripts/monitor_batch_test.sh batch_test_100_progress.json

# è‡ªå®šç¾©åˆ·æ–°é–“éš”ï¼ˆæ¯10ç§’ï¼‰
./scripts/monitor_batch_test.sh batch_test_100_progress.json 10
```

### æŸ¥çœ‹æ—¥èªŒ

```bash
# æŸ¥çœ‹å¯¦æ™‚æ—¥èªŒ
tail -f batch_test_100.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥èªŒ
tail -100 batch_test_100.log

# æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ
grep -i error batch_test_100.log | tail -50
```

### æª¢æŸ¥é€²åº¦æ–‡ä»¶

```bash
# æŸ¥çœ‹é€²åº¦æ‘˜è¦ï¼ˆä½¿ç”¨ jqï¼Œå¦‚æœå·²å®‰è£ï¼‰
cat batch_test_100_progress.json | jq '.summary'

# æŸ¥çœ‹æœ€è¿‘è™•ç†çš„æ–‡ä»¶
cat batch_test_100_progress.json | jq '.files[-10:]'
```

---

## ğŸ”§ è…³æœ¬åƒæ•¸èªªæ˜

### `kg_extract_batch_test_100.py`

| åƒæ•¸ | èªªæ˜ | é»˜èªå€¼ | å¿…å¡« |
|------|------|--------|------|
| `--file-list` | æ–‡ä»¶åˆ—è¡¨æ–‡ä»¶è·¯å¾‘ï¼ˆæ¯è¡Œä¸€å€‹æ–‡ä»¶è·¯å¾‘ï¼‰ | - | å¦ï¼ˆå¯èˆ‡ `--input-dir` äº’æ›ï¼‰ |
| `--input-dir` | è¼¸å…¥ç›®éŒ„ï¼ˆå°‡è™•ç†ç›®éŒ„ä¸‹æ‰€æœ‰ .md æ–‡ä»¶ï¼‰ | - | å¦ |
| `--max-files` | æœ€å¤§è™•ç†æ–‡ä»¶æ•¸ | 100 | å¦ |
| `--concurrent` | ä¸¦ç™¼ä»»å‹™æ•¸ | 5 | å¦ |
| `--output` | è¼¸å‡ºçµæœæ–‡ä»¶ | `batch_test_100_results.json` | å¦ |
| `--progress` | é€²åº¦æ–‡ä»¶ | `batch_test_100_progress.json` | å¦ |
| `--retry-failed` | æ˜¯å¦é‡è©¦å¤±æ•—çš„æ–‡ä»¶ | False | å¦ |

### ä½¿ç”¨ç¤ºä¾‹

```bash
# ä½¿ç”¨æ–‡ä»¶åˆ—è¡¨
python3 scripts/kg_extract_batch_test_100.py \
    --file-list scripts/batch_test_100_files.txt \
    --max-files 100 \
    --concurrent 5 \
    --retry-failed

# ä½¿ç”¨è¼¸å…¥ç›®éŒ„
python3 scripts/kg_extract_batch_test_100.py \
    --input-dir "docs/ç³»ç»Ÿè®¾è®¡æ–‡æ¡£" \
    --max-files 100 \
    --concurrent 5 \
    --retry-failed

# è‡ªå®šç¾©è¼¸å‡ºæ–‡ä»¶
python3 scripts/kg_extract_batch_test_100.py \
    --file-list scripts/batch_test_100_files.txt \
    --output my_results.json \
    --progress my_progress.json \
    --retry-failed
```

---

## ğŸ“ çµæœæ–‡ä»¶èªªæ˜

### 1. çµæœæ–‡ä»¶ (`batch_test_100_results.json`)

åŒ…å«å®Œæ•´çš„æ¸¬è©¦çµæœï¼Œçµæ§‹å¦‚ä¸‹ï¼š

```json
{
  "summary": {
    "total_files": 100,
    "success_count": 95,
    "failed_count": 5,
    "timeout_count": 0,
    "success_rate": 95.0,
    "total_processing_time": 3600.0,
    "avg_processing_time": 37.89,
    "total_entities": 1234,
    "total_relations": 567,
    "test_timestamp": "2026-01-02T00:00:00",
    "test_duration_seconds": 3600.0
  },
  "results": [
    {
      "file_path": "docs/.../file.md",
      "file_name": "file.md",
      "file_index": 1,
      "upload_time": 0.5,
      "processing_time": 45.2,
      "status": "completed",
      "file_id": "xxx-xxx-xxx",
      "kg_stats": {...},
      "detailed_record": {
        "file_info": {...},
        "vectorization": {...},
        "kg_extraction": {...},
        "error_record": {...},
        "test_info": {...}
      }
    },
    ...
  ]
}
```

### 2. é€²åº¦æ–‡ä»¶ (`batch_test_100_progress.json`)

ç”¨æ–¼å¯¦æ™‚ç›£æ§ï¼Œçµæ§‹å¦‚ä¸‹ï¼š

```json
{
  "last_update": "2026-01-02T00:00:00",
  "summary": {
    "total_files": 100,
    "success_count": 95,
    "failed_count": 5,
    ...
  },
  "files": [
    {
      "file_name": "file.md",
      "file_index": 1,
      "status": "completed",
      "progress": 100
    },
    ...
  ]
}
```

### 3. è©³ç´°è¨˜éŒ„çµæ§‹

æ¯å€‹æ–‡ä»¶çš„ `detailed_record` åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼ˆæŒ‰ç…§æ¸¬è©¦è¨ˆåŠƒè¦æ±‚ï¼‰ï¼š

#### æ–‡ä»¶åŸºæœ¬ä¿¡æ¯
- `file_name`: æ–‡ä»¶åç¨±
- `file_path`: æ–‡ä»¶è·¯å¾‘
- `file_size`: æ–‡ä»¶å¤§å°ï¼ˆå­—ç¯€ï¼‰
- `file_type`: æ–‡ä»¶é¡å‹ï¼ˆMIME typeï¼‰
- `upload_time`: ä¸Šå‚³æ™‚é–“
- `processing_start_time`: è™•ç†é–‹å§‹æ™‚é–“
- `processing_end_time`: è™•ç†çµæŸæ™‚é–“
- `file_id`: æ–‡ä»¶ID

#### å‘é‡åŒ–è¨˜éŒ„
- `status`: å‘é‡åŒ–ç‹€æ…‹ï¼ˆâœ…/âŒï¼‰
- `vectorization_time`: å‘é‡åŒ–æ™‚é–“ï¼ˆç§’ï¼‰
- `chunk_count`: åˆ†å¡Šæ•¸é‡
- `chunk_strategy`: åˆ†å¡Šç­–ç•¥
- `collection_name`: ChromaDB collection åç¨±
- `embedding_dimension`: å‘é‡åµŒå…¥ç¶­åº¦

#### çŸ¥è­˜åœ–è­œæå–è¨˜éŒ„
- `status`: æå–ç‹€æ…‹ï¼ˆâœ…/âŒï¼‰
- `extraction_time`: æå–æ™‚é–“ï¼ˆç§’ï¼‰
- `ontology`: Ontology ä½¿ç”¨æƒ…æ³
  - `base_ontology`: æ˜¯å¦ä½¿ç”¨ Base Ontology
  - `domain_ontology`: Domain Ontology åç¨±
  - `major_ontology`: Major Ontology åç¨±
- `ner`: NER è¨˜éŒ„
  - `entity_count`: å¯¦é«”æ•¸é‡
  - `entity_types`: å¯¦é«”é¡å‹åˆ—è¡¨
- `re`: RE è¨˜éŒ„
  - `relation_count`: é—œä¿‚æ•¸é‡
  - `relation_types`: é—œä¿‚é¡å‹åˆ—è¡¨
- `rt`: RT è¨˜éŒ„
  - `relation_type_count`: é—œä¿‚é¡å‹è­˜åˆ¥æ•¸é‡
- `arangodb`: ArangoDB å­˜å„²è¨˜éŒ„
  - `entities_collection`: å¯¦é«”é›†åˆåç¨±
  - `relations_collection`: é—œä¿‚é›†åˆåç¨±
  - `entities_count`: å¯¦é«”æ–‡æª”æ•¸
  - `relations_count`: é—œä¿‚æ–‡æª”æ•¸

#### éŒ¯èª¤è¨˜éŒ„ï¼ˆå¦‚æœå¤±æ•—ï¼‰
- `error_type`: éŒ¯èª¤é¡å‹
- `error_message`: éŒ¯èª¤æ¶ˆæ¯
- `error_stack`: éŒ¯èª¤å †æ£§
- `failed_stage`: å¤±æ•—éšæ®µï¼ˆ`ä¸Šå‚³` / `å‘é‡åŒ–` / `çŸ¥è­˜åœ–è­œæå–`ï¼‰

#### æ¸¬è©¦ä¿¡æ¯
- `file_index`: æ–‡ä»¶ç´¢å¼•
- `test_timestamp`: æ¸¬è©¦æ™‚é–“æˆ³
- `retry_count`: é‡è©¦æ¬¡æ•¸
- `notes`: å‚™è¨»åˆ—è¡¨

---

## ğŸ”„ å¤±æ•—é‡è©¦æ©Ÿåˆ¶

æ¸¬è©¦è…³æœ¬æ”¯æŒè‡ªå‹•é‡è©¦å¤±æ•—çš„æ–‡ä»¶ï¼š

```bash
# å•Ÿç”¨å¤±æ•—é‡è©¦
python3 scripts/kg_extract_batch_test_100.py \
    --file-list scripts/batch_test_100_files.txt \
    --retry-failed
```

**é‡è©¦ç­–ç•¥**ï¼š
1. ç¬¬ä¸€è¼ªè™•ç†æ‰€æœ‰100å€‹æ–‡ä»¶
2. æ”¶é›†å¤±æ•—çš„æ–‡ä»¶ï¼ˆç‹€æ…‹ç‚º `failed`ã€`error` æˆ– `timeout`ï¼‰
3. å°å¤±æ•—çš„æ–‡ä»¶é€²è¡Œç¬¬äºŒè¼ªè™•ç†
4. åœ¨ `detailed_record.test_info.notes` ä¸­è¨˜éŒ„é‡è©¦ä¿¡æ¯
5. æœ€çµ‚çµæœæ–‡ä»¶å‘½åç‚º `batch_test_100_results_with_retry.json`

---

## ğŸ›‘ åœæ­¢æ¸¬è©¦

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PID æ–‡ä»¶

```bash
# æŸ¥çœ‹ PID
cat batch_test_100.pid

# åœæ­¢æ¸¬è©¦
kill $(cat batch_test_100.pid)

# å¼·åˆ¶åœæ­¢
kill -9 $(cat batch_test_100.pid)
```

### æ–¹æ³•äºŒï¼šæŸ¥æ‰¾é€²ç¨‹

```bash
# æŸ¥æ‰¾æ¸¬è©¦é€²ç¨‹
ps aux | grep kg_extract_batch_test_100.py

# åœæ­¢æ¸¬è©¦ï¼ˆæ›¿æ› PIDï¼‰
kill <PID>
```

---

## ğŸ“ˆ æ€§èƒ½ç›£æ§

### æª¢æŸ¥ RQ éšŠåˆ—ç‹€æ…‹

```bash
# ä½¿ç”¨ Redis CLI æª¢æŸ¥
redis-cli
> LLEN rq:queue:file_processing
> LLEN rq:queue:kg_extraction
> LLEN rq:queue:vectorization
```

### æª¢æŸ¥ç³»çµ±è³‡æº

```bash
# CPU å’Œå…§å­˜ä½¿ç”¨
top -pid $(pgrep -f kg_extract_batch_test_100)

# æˆ–ä½¿ç”¨ htop
htop
```

---

## ğŸ§¹ æ¸…ç†æ¸¬è©¦æ•¸æ“š

æ¸¬è©¦å®Œæˆå¾Œï¼Œå¦‚éœ€æ¸…ç†æ¸¬è©¦æ•¸æ“šï¼š

```bash
# æ¸…ç† RQ éšŠåˆ—å’Œä»»å‹™
python3 scripts/clear_rq_jobs.py

# æ¸…ç† Redis ç‹€æ…‹è¨˜éŒ„
python3 -c "
import redis
from database.rq.queue import get_redis_connection
redis_conn = get_redis_connection()
status_keys = redis_conn.keys('processing:status:*')
for key in status_keys:
    redis_conn.delete(key)
print(f'æ¸…ç†äº† {len(status_keys)} å€‹è™•ç†ç‹€æ…‹')
"
```

---

## â“ å¸¸è¦‹å•é¡Œ

### 1. æ¸¬è©¦é€²åº¦æ–‡ä»¶ä¸å­˜åœ¨

**å•é¡Œ**ï¼šç›£æ§è…³æœ¬æç¤ºé€²åº¦æ–‡ä»¶ä¸å­˜åœ¨

**è§£æ±º**ï¼š
- ç¢ºèªæ¸¬è©¦è…³æœ¬æ­£åœ¨é‹è¡Œ
- æª¢æŸ¥æ—¥èªŒæ–‡ä»¶æ˜¯å¦æœ‰éŒ¯èª¤
- ç­‰å¾…å¹¾ç§’é˜è®“æ¸¬è©¦è…³æœ¬å‰µå»ºé€²åº¦æ–‡ä»¶

### 2. æ¸¬è©¦é€Ÿåº¦å¤ªæ…¢

**å•é¡Œ**ï¼šè™•ç†é€Ÿåº¦é ä½æ–¼é æœŸ

**è§£æ±º**ï¼š
- æª¢æŸ¥ RQ Worker æ˜¯å¦æ­£å¸¸é‹è¡Œ
- æª¢æŸ¥ Ollama æœå‹™æ˜¯å¦æ­£å¸¸
- è€ƒæ…®èª¿æ•´ `--concurrent` åƒæ•¸ï¼ˆä½†ä¸è¦è¨­ç½®éé«˜ï¼‰
- æª¢æŸ¥ç³»çµ±è³‡æºä½¿ç”¨æƒ…æ³

### 3. å¤§é‡æ–‡ä»¶å¤±æ•—

**å•é¡Œ**ï¼šå¾ˆå¤šæ–‡ä»¶è™•ç†å¤±æ•—

**è§£æ±º**ï¼š
- æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒï¼š`grep -i error batch_test_100.log`
- æª¢æŸ¥å¤±æ•—éšæ®µï¼ˆä¸Šå‚³/å‘é‡åŒ–/çŸ¥è­˜åœ–è­œæå–ï¼‰
- å•Ÿç”¨ `--retry-failed` é€²è¡Œé‡è©¦
- æª¢æŸ¥ Ollama æœå‹™ç‹€æ…‹å’Œè³‡æºä½¿ç”¨

### 4. æ¸¬è©¦ä¸­æ–·å¾Œå¦‚ä½•ç¹¼çºŒ

**å•é¡Œ**ï¼šæ¸¬è©¦ä¸­é€”ä¸­æ–·ï¼Œå¦‚ä½•ç¹¼çºŒ

**è§£æ±º**ï¼š
- æ¸¬è©¦è…³æœ¬ä¸æ”¯æŒæ–·é»çºŒå‚³
- éœ€è¦é‡æ–°é‹è¡Œæ¸¬è©¦
- å»ºè­°ä½¿ç”¨ `--file-list` åƒæ•¸ï¼Œå¯ä»¥è¼•é¬†é‡æ–°é‹è¡Œ

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [æ–‡ä»¶ä¸Šå‚³å‘é‡åœ–è­œåŒ–æ¸¬è©¦è¨ˆåŠƒ](./æ–‡ä»¶ä¸Šå‚³å‘é‡åœ–è­œåŒ–æ¸¬è©¦è¨ˆåŠƒ.md)
- [Embeddingæœå‹™ä¸¦ç™¼æ§åˆ¶ä¿®å¾©å ±å‘Š](./Embeddingæœå‹™ä¸¦ç™¼æ§åˆ¶ä¿®å¾©å ±å‘Š.md)
- [ç¬¬ä¸€éšæ®µæ¸¬è©¦å ±å‘Š](./ç¬¬ä¸€éšæ®µæ¸¬è©¦å ±å‘Š.md)

---

**æœ€å¾Œæ›´æ–°æ—¥æœŸ**: 2026-01-02

