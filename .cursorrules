# ⚠️ AI 開發規範 - 強制執行規則

## 🔴 最高優先級規則

### 每次代碼修改後必須執行的檢查流程

1. **更新文件頭註釋**（優先級最高）
   - 確認當前日期（使用網絡搜索工具）
   - 更新「最後修改日期」為當前日期
   - 格式：`# 最後修改日期: YYYY-MM-DD`

2. **代碼格式檢查**（必須全部通過）
   - 運行 `black <文件>` 格式化代碼
   - 運行 `ruff check --fix <文件>` 檢查代碼風格
   - 運行 `mypy <文件>` 進行類型檢查

3. **檢查結果處理**
   - 如果任何檢查失敗，必須修復錯誤
   - 修復後重新運行失敗的檢查
   - 只有所有檢查通過後才能標記任務完成

### 禁止行為

- ❌ 跳過文件頭日期更新
- ❌ 跳過代碼格式檢查
- ❌ 跳過類型檢查
- ❌ 在檢查失敗時標記任務為完成

### 必須遵循的規範

- ✅ 所有函數參數必須有類型注解
- ✅ 所有返回值必須有類型注解
- ✅ 使用 `Optional[T]` 而不是 `T = None`
- ✅ 所有可能為 None 的值都必須檢查
- ✅ 數據庫連接使用前必須檢查
- ✅ 模型對象使用前必須檢查可用性

## 📚 詳細規範文檔

請參閱：
- `AI_開發規範檢查清單.md` - 完整的檢查清單和流程
- `docs/第三次整改/系統整改計劃.md` - 開發規範詳細說明
- `services/api/pyproject.toml` - 項目配置與工具設置

## ⚡ 快速檢查腳本

使用項目根目錄的 `check_code_quality.py` 腳本：

```bash
python check_code_quality.py <文件路徑>
```

該腳本會自動執行所有檢查步驟。

