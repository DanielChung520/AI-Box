{# DuckDB Prompt Template - å®Œæ•´ç‰ˆ #}
{% set outer_loop = namespace(idx=0) %}
ã€ç³»çµ±ã€‘{{ system.name }} | æ–¹è¨€: {{ system.dialect }} | Bucket: {{ system.bucket }}

ã€è¡¨æ ¼å®šç¾©ã€‘
{% for table in tables %}{% if table.aliases %}
{% set outer_loop.idx = outer_loop.idx + 1 %}
ğŸ“‹ {{ table.description }} ({{ table.names['tiptop'] }})
   Alias: t{{ outer_loop.idx }} â† å¿…é ˆä½¿ç”¨é€™å€‹ aliasï¼
{% endif %}{% endfor %}

{% set outer_loop.idx = 0 %}
ã€æ¬„ä½å®šç¾©ã€‘
{% for table in tables %}{% if table.aliases %}
{% set outer_loop.idx = outer_loop.idx + 1 %}
ğŸ“Š {{ table.names['tiptop'] }} (alias: t{{ outer_loop.idx }})
{% for col_id, col in table.columns.items() %}
   â€¢ t{{ outer_loop.idx }}.{{ col.names['tiptop'] }} â†’ {{ col.description }}{% if col.example %} [ç¯„ä¾‹: {{ col.example }}]{% endif %}
{% endfor %}{% endif %}{% endfor %}

{% set outer_loop.idx = 0 %}
ã€é—œè¯é—œä¿‚ã€‘
{% for table in tables %}{% set outer_loop.idx = outer_loop.idx + 1 %}
{% for rel in table.relationships %}
ğŸ”— t{{ outer_loop.idx }}.{{ rel.from_column }} â†’ {{ rel.to_table }}.{{ rel.to_column }}
{% endfor %}{% endfor %}

ã€é‡è¦è·¯å¾‘æ ¼å¼ - å¿…é ˆéµå®ˆã€‘
æ¯å€‹è¡¨å¿…é ˆä½¿ç”¨å®Œæ•´è·¯å¾‘ï¼š
read_parquet('s3://tiptop-raw/raw/v1/{table}/year=*/month=*/data.parquet', hive_partitioning=true)

ã€SQL å¯«ä½œè¦å‰‡ã€‘
1. æ¯å€‹è¡¨éƒ½å¿…é ˆç”¨ read_parquet() åŒ…è£
2. **å¼·çƒˆå»ºè­°**ï¼šä½¿ç”¨æ¸…æ™°çš„ä½ç½®å¼•ç”¨ï¼Œä¾‹å¦‚ï¼š
   - ç¬¬ä¸€å€‹è¡¨ç”¨ t1
   - ç¬¬äºŒå€‹è¡¨ç”¨ t2
   - ç¬¬ä¸‰å€‹è¡¨ç”¨ t3
3. **çµ•å°ç¦æ­¢**ï¼šæ··åˆä½¿ç”¨ table namesï¼ˆå¦‚ img_fileï¼‰å’Œ aliasesï¼ˆå¦‚ t1ï¼‰
4. **æ­£ç¢ºåšæ³•**ï¼šå¦‚æœæŸ¥è©¢ item_masterï¼ˆç¬¬ä¸€å€‹è¡¨ï¼‰ï¼Œå¿…é ˆç”¨ t1.ima01ï¼Œçµ•å°ä¸èƒ½ç”¨ img_file.ima01 æˆ– ima01 ç›´æ¥
5. **JOIN èªæ³•**ï¼š
   âŒ éŒ¯èª¤ï¼šJOIN pmc_file ON ...
   âœ… æ­£ç¢ºï¼šJOIN read_parquet(...) t3 ON t2.pmm04 = t3.pmc01
6. **åªè¿”å› SQLï¼Œä¸è¦å…¶ä»–èªªæ˜**
7. **å¿…é ˆåŒ…å« LIMIT**

ã€æ­£ç¢ºæ—¥æœŸå‡½æ•¸ã€‘
âœ… CURRENT_DATE - ç•¶å‰æ—¥æœŸ
âœ… date_diff('month', date1, date2) - æœˆä»½å·®
âœ… date_trunc('month', date) - æœˆä»½æˆªæ–·
âœ… strftime(date, '%Y-%m') - æ ¼å¼åŒ–æœˆä»½
âœ… CAST(string AS DATE) - å­—ä¸²è½‰æ—¥æœŸ
âœ… date >= CURRENT_DATE - INTERVAL 30 DAY - 30å¤©å‰

ã€å¸¸è¦‹éŒ¯èª¤ - è«‹é¿é–‹ã€‘
âŒ WHERE tlf06 >= curdate() - curdate() ä¸å­˜åœ¨ï¼ç”¨ CURRENT_DATE
âŒ WHERE img01 = '10-0001' - æ²’æŒ‡å®š aliasï¼ç”¨ t1.img01
âŒ JOIN pmc_file ON t2.pmm04 = pmc01 - æ²’ç”¨ read_parquet åŒ…è£ï¼
âŒ FROM img_file t1 - ä¸èƒ½æ··ç”¨ table name å’Œ aliasï¼

ã€æ­£ç¢º SQL ç¯„ä¾‹ã€‘

ç¯„ä¾‹ 1 - å–®è¡¨æŸ¥è©¢ï¼š
Q: æŸ¥è©¢ W01 å€‰åº«åº«å­˜
SQL: SELECT t1.img01, t1.img10 FROM read_parquet('s3://tiptop-raw/raw/v1/img_file/year=*/month=*/data.parquet', hive_partitioning=true) t1 WHERE t1.img02 = 'W01' LIMIT 10

ç¯„ä¾‹ 2 - å–®è¡¨æŸ¥è©¢ï¼š
Q: æŸ¥è©¢æ–™è™Ÿ 10-0001 çš„å“å
SQL: SELECT t1.ima02 FROM read_parquet('s3://tiptop-raw/raw/v1/ima_file/year=*/month=*/data.parquet', hive_partitioning=true) t1 WHERE t1.ima01 = '10-0001' LIMIT 10

ç¯„ä¾‹ 3 - æŸ¥è©¢ 2024 å¹´äº¤æ˜“æ•¸é‡ï¼š
Q: æŸ¥è©¢ 2024 å¹´æœ‰å¤šå°‘ç­†äº¤æ˜“
SQL: SELECT COUNT(*) FROM read_parquet('s3://tiptop-raw/raw/v1/tlf_file/year=*/month=*/data.parquet', hive_partitioning=true) t1 WHERE strftime(t1.tlf06, '%Y') = '2024' LIMIT 10

ç¯„ä¾‹ 4 - å¤šè¡¨ JOINï¼ˆæ­£ç¢ºä½¿ç”¨ aliasï¼‰ï¼š
Q: æŸ¥è©¢ RM10-008 çš„ä¾›æ‡‰å•†åç¨±
SQL: SELECT t3.pmc03 FROM read_parquet('s3://tiptop-raw/raw/v1/pmn_file/year=*/month=*/data.parquet') t1 JOIN read_parquet('s3://tiptop-raw/raw/v1/pmm_file/year=*/month=*/data.parquet') t2 ON t1.pmn01 = t2.pmm01 JOIN read_parquet('s3://tiptop-raw/raw/v1/pmc_file/year=*/month=*/data.parquet') t3 ON t2.pmm04 = t3.pmc01 WHERE t1.pmn04 = 'RM10-008' LIMIT 10

ç¯„ä¾‹ 5 - å¤šè¡¨ JOINï¼š
Q: æŸ¥è©¢æ–™è™Ÿ 10-0001 çš„åº«å­˜å’Œå“å
SQL: SELECT t1.img02, t1.img10, t2.ima02 FROM read_parquet('s3://tiptop-raw/raw/v1/img_file/year=*/month=*/data.parquet') t1 JOIN read_parquet('s3://tiptop-raw/raw/v1/ima_file/year=*/month=*/data.parquet') t2 ON t1.img01 = t2.ima01 WHERE t1.img01 = '10-0001' LIMIT 10

ç¯„ä¾‹ 6 - æŒ‰æœˆä»½çµ±è¨ˆï¼š
Q: æŒ‰æœˆä»½çµ±è¨ˆäº¤æ˜“
SQL: SELECT strftime(t1.tlf06, '%Y-%m') AS month, COUNT(*) AS cnt FROM read_parquet('s3://tiptop-raw/raw/v1/tlf_file/year=*/month=*/data.parquet', hive_partitioning=true) t1 GROUP BY month ORDER BY month LIMIT 100

ç¯„ä¾‹ 7 - è¤‡é›œ JOINï¼š
Q: æŸ¥è©¢ä¾›æ‡‰å•†çš„æ–™è™Ÿã€åº«å­˜å’Œå“å
SQL: SELECT t1.pmn04, t4.ima02, SUM(t2.img10) FROM read_parquet('s3://tiptop-raw/raw/v1/pmn_file/year=*/month=*/data.parquet') t1 JOIN read_parquet('s3://tiptop-raw/raw/v1/pmm_file/year=*/month=*/data.parquet') t3 ON t1.pmn01 = t3.pmm01 LEFT JOIN read_parquet('s3://tiptop-raw/raw/v1/img_file/year=*/month=*/data.parquet') t2 ON t1.pmn04 = t2.img01 JOIN read_parquet('s3://tiptop-raw/raw/v1/ima_file/year=*/month=*/data.parquet') t4 ON t1.pmn04 = t4.ima01 WHERE t3.pmm04 = 'VND005' GROUP BY t1.pmn04, t4.ima02 LIMIT 10

ã€ç”¨æˆ¶æŸ¥è©¢ã€‘{{ user_query }}

ã€SQLã€‘

