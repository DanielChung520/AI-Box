# MM-Agentï¼ˆç‰©æ–™ç®¡ç†ä»£ç†ï¼‰è¦æ ¼æ›¸

**ç‰ˆæœ¬**ï¼š4.0
**å‰µå»ºæ—¥æœŸ**ï¼š2026-01-13
**æœ€å¾Œä¿®æ”¹æ—¥æœŸ**ï¼š2026-01-31
**é©ç”¨ç’°å¢ƒ**ï¼šAI-Box Agent Platform v4.0

---

## 1. æ¦‚è¿°

### 1.1 å®šä½

**MM-Agentï¼ˆMaterial Management Agentï¼‰** æ˜¯ BPAï¼ˆBusiness Process Agentï¼‰é¡å‹ä¸‹çš„ç‰©æ–™ç®¡ç†æ¥­å‹™å¯¦ç¾ï¼Œè² è²¬è™•ç†åº«å­˜ã€é€²è²¨ã€å‡ºè²¨ã€å‘†æ»¯ç­‰ç‰©æ–™ç®¡ç†ç›¸é—œæŸ¥è©¢ã€‚

### 1.2 AI-Box æ¶æ§‹ä½ç½®

```
AI-Box Agent Platform v4.0
â”‚
â”œâ”€â”€ å”èª¿å±¤ï¼ˆå…§å»ºæœå‹™ï¼‰
â”‚   â”œâ”€â”€ Agent Registryï¼ˆè¨»å†Šè¡¨ï¼‰
â”‚   â”œâ”€â”€ Agent Orchestratorï¼ˆå”èª¿å™¨ï¼‰
â”‚   â””â”€â”€ Task Analyzer v4.0ï¼ˆL1-L5 äº”å±¤è™•ç†ï¼‰
â”‚
â””â”€â”€ å¤–éƒ¨ Agentï¼ˆé€é MCP èª¿ç”¨ï¼‰â¬…ï¸ MM-Agent å±¬æ–¼æ­¤é¡
    â”œâ”€â”€ BPA - MM-Agent â¬…ï¸ ç‰©æ–™ç®¡ç†æ¥­å‹™å¯¦ç¾ï¼ˆç¬¬ä¸‰æ–¹ï¼‰
    â”œâ”€â”€ BPA - Purchase Agent
    â”œâ”€â”€ BPA - Sales Agent
    â””â”€â”€ System Support Agents
```

### 1.3 Agent é¡å‹å®šç¾©

| ç‰¹æ€§     | å…§å»º Agent  | å…§éƒ¨ Agent      | å¤–éƒ¨ Agentï¼ˆMM-Agentï¼‰  |
| -------- | ----------- | --------------- | ----------------------- |
| è¨»å†Šæ–¹å¼ | ç„¡éœ€è¨»å†Š    | Registry API    | Registry APIï¼ˆMCPï¼‰     |
| èª¿ç”¨æ–¹å¼ | ç›´æ¥èª¿ç”¨    | HTTP/MCP Client | MCP Protocol            |
| èªè­‰è¦æ±‚ | ç„¡          | å¯¬é¬†            | åš´æ ¼ï¼ˆmTLSã€API Keyï¼‰   |
| éƒ¨ç½²ä½ç½® | AI-Box å…§éƒ¨ | AI-Box å…§éƒ¨     | datalake-systemï¼ˆç¨ç«‹ï¼‰ |
| è³‡æºæ¬Šé™ | å®Œæ•´        | å®Œæ•´            | å—é™ï¼ˆéœ€é…ç½®ï¼‰          |

### 1.4 MCP é›†æˆç‹€æ…‹

| ç‹€æ…‹        | èªªæ˜                                    |
| ----------- | --------------------------------------- |
| âœ… å·²è¨»å†Š   | MM-Agent å·²è¨»å†Šåˆ° AI-Box Agent Registry |
| âœ… MCP é›†æˆ | é€šé MCP Protocol èˆ‡ AI-Box æºé€š        |
| â³ èƒ½åŠ›æ˜ å°„ | å°šæœªå®Œæˆ L3 èƒ½åŠ›æ˜ å°„é…ç½®                |
| â³ ç­–ç•¥æª¢æŸ¥ | å°šæœªå¯¦ç¾ L4 æ­£é¢è¡¨åˆ—                    |

### 1.5 v4.0 Task Analyzer 5 å±¤å°æ‡‰

| å±¤ç´š | åŠŸèƒ½     | MM-Agent å¯¦ç¾ä½ç½®             |
| ---- | -------- | ----------------------------- |
| L1   | èªç¾©ç†è§£ | MM-Agentï¼ˆSemantic Analyzerï¼‰ |
| L2   | æ„åœ–æŠ½è±¡ | MM-Agentï¼ˆTranslatorï¼‰        |
| L3   | èƒ½åŠ›æ˜ å°„ | AI-Box Orchestrator           |
| L4   | ç­–ç•¥æª¢æŸ¥ | MM-Agentï¼ˆPositive Listï¼‰     |
| L5   | åŸ·è¡Œè§€å¯Ÿ | AI-Box Orchestrator           |

---

## 2. ç³»çµ±æ¶æ§‹

### 2.1 æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI-Box Agent Platform v4.0                        â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   å”èª¿å±¤ï¼ˆå…§å»ºæœå‹™ï¼‰                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  Registry   â”‚  â”‚Orchestrator â”‚  â”‚  Task Analyzer      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚      v4.0           â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚ MCP                                â”‚
â”‚                               â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å¤–éƒ¨ Agent - MM-Agentï¼ˆç¬¬ä¸‰æ–¹æœå‹™ï¼‰              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚              MM-Agent Service                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚              (ç¨ç«‹é€²ç¨‹ï¼ŒTCP ç«¯å£ç›£è½)                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ MCP Handler â”‚  â”‚  Semantic   â”‚  â”‚Translation  â”‚ â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚             â”‚â”€â”€â–¶â”‚  Analyzer  â”‚â”€â”€â–¶â”‚  Engine    â”‚ â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ (L1-L5 æ©‹æ¥)â”‚  â”‚            â”‚  â”‚            â”‚ â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚   â”‚
â”‚  â”‚  â”‚         â”‚                â”‚               â”‚         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚         â–¼                â–¼               â–¼         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚           Business Logic                    â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Inventoryâ”‚ â”‚Purchase â”‚ â”‚ Sales   â”‚      â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ Query   â”‚ â”‚ Query   â”‚ â”‚ Query   â”‚      â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                       â”‚                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                       â–¼                           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚              â”‚   DA Integration â”‚                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  (Qdrant/Arango)â”‚                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       å…¬å…±æœå‹™                                 â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚   â”‚  Qdrant  â”‚   â”‚ArangoDB  â”‚   â”‚DataLake  â”‚              â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 MCP é€šä¿¡æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MCP é€šä¿¡æµç¨‹                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  AI-Box                    MCP                      MM-Agent
    â”‚                         â”‚                          â”‚
    â”‚  1. Task Analyzer L1-L3 â”‚                          â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
    â”‚     (æ„åœ–åˆ†é¡å®Œæˆ)       â”‚                          â”‚
    â”‚                         â”‚                          â”‚
    â”‚  2. é¸æ“‡ Agent: mm-agentâ”‚                          â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  3. MCP Request         â”‚
    â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
    â”‚                         â”‚     (execute)           â”‚
    â”‚                         â”‚                          â”‚
    â”‚                         â”‚     4. åŸ·è¡ŒæŸ¥è©¢          â”‚
    â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
    â”‚                         â”‚                          â”‚
    â”‚                         â”‚     5. è¿”å›çµæœ          â”‚
    â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”‚  6. Task Analyzer L5    â”‚                          â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
    â”‚     (åŸ·è¡Œè§€å¯Ÿå®Œæˆ)       â”‚                          â”‚
```

### 2.3 æ–‡ä»¶çµæ§‹

```
datalake-system/
â”œâ”€â”€ mm_agent/
â”‚   â”œâ”€â”€ main.py                 # FastAPI + MCP å…¥å£ï¼ˆç¨ç«‹æœå‹™ï¼‰
â”‚   â”œâ”€â”€ agent.py                # MM-Agent æ¥­å‹™é‚è¼¯
â”‚   â”œâ”€â”€ mcp_handler.py          # MCP Handlerï¼ˆL1-L5 æ©‹æ¥ï¼‰
â”‚   â”œâ”€â”€ semantic_analyzer.py    # èªç¾©è§£æï¼ˆL1ï¼‰
â”‚   â”œâ”€â”€ translator.py           # è½‰è­¯å¼•æ“ï¼ˆL2ï¼‰
â”‚   â”œâ”€â”€ positive_list.py        # æ­£é¢è¡¨åˆ—æª¢æŸ¥ï¼ˆL4ï¼‰
â”‚   â”œâ”€â”€ models.py               # æ•¸æ“šæ¨¡å‹
â”‚   â”œâ”€â”€ registry.py             # Agent è¨»å†Šæ¨¡çµ„
â”‚   â”œâ”€â”€ requirements.txt        # ä¾è³´
â”‚   â”œâ”€â”€ Dockerfile              # Docker é…ç½®
â”‚   â””â”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚
â””â”€â”€ frontend/
    â””â”€â”€ api_server.py           # API Gatewayï¼ˆå¯é¸ï¼Œç›´æ¥å°å¤–æš´éœ²ï¼‰
```

---

## 3. MCP é€šä¿¡å”è­°

### 3.1 MCP Handler å¯¦ç¾

```python
from mcp.server.fastmcp import FastMCP
from agents.services.protocol.base import (
    AgentServiceRequest,
    AgentServiceResponse,
)

mcp = FastMCP("mm-agent")


@mcp.tool()
async def execute_task(
    task_id: str,
    instruction: str,
    context: dict | None = None,
) -> dict:
    """åŸ·è¡Œ MM-Agent ä»»å‹™ï¼ˆL1-L5 æ©‹æ¥ï¼‰"""
    request = AgentServiceRequest(
        task_id=task_id,
        task_data={"instruction": instruction},
        metadata=context or {},
    )

    agent = MMAgent()
    response = await agent.execute(request)

    return {
        "task_id": response.task_id,
        "status": response.status,
        "result": response.result,
        "error": response.error,
    }


@mcp.tool()
async def get_capabilities() -> dict:
    """ç²å– MM-Agent èƒ½åŠ›åˆ—è¡¨"""
    agent = MMAgent()
    return await agent.get_capabilities()


@mcp.tool()
async def health_check() -> str:
    """å¥åº·æª¢æŸ¥"""
    agent = MMAgent()
    status = await agent.health_check()
    return status.value
```

### 3.2 MCP ç«¯é»

| ç«¯é»                 | åŠŸèƒ½     | èªªæ˜                     |
| -------------------- | -------- | ------------------------ |
| `execute_task`     | åŸ·è¡Œä»»å‹™ | æ¥æ”¶ AI-Box åˆ†æ´¾çš„ä»»å‹™   |
| `get_capabilities` | æŸ¥è©¢èƒ½åŠ› | è¿”å› MM-Agent æ”¯æŒçš„åŠŸèƒ½ |
| `health_check`     | å¥åº·æª¢æŸ¥ | è¿”å›æœå‹™ç‹€æ…‹             |

### 3.3 è«‹æ±‚/éŸ¿æ‡‰æ ¼å¼

```json
// MCP Request
{
  "task_id": "task-001",
  "instruction": "RM05-008 ä¸Šæœˆè²·é€²å¤šå°‘",
  "context": {
    "user_id": "user_001",
    "session_id": "session_001"
  }
}

// MCP Response
{
  "task_id": "task-001",
  "status": "completed",
  "result": {
    "success": true,
    "intent": "purchase",
    "response": "RM05-008 åœ¨ä¸Šæœˆï¼ˆ2025-12ï¼‰æ¡è³¼é€²è²¨å…± 5,000 KG"
  }
}
```

---

## 4. Agent Service Protocolï¼ˆå…§éƒ¨å¯¦ç¾ï¼‰

### 4.1 æ¥å£å®šç¾©

é›–ç„¶ MM-Agent é€šé MCP èˆ‡ AI-Box é€šä¿¡ï¼Œå…§éƒ¨ä»ä½¿ç”¨ AgentServiceProtocol è¦ç¯„ï¼š

```python
from agents.services.protocol.base import (
    AgentServiceProtocol,
    AgentServiceRequest,
    AgentServiceResponse,
    AgentServiceStatus,
)


class MMAgent(AgentServiceProtocol):
    """MM-Agentï¼ˆç‰©æ–™ç®¡ç†ä»£ç†ï¼‰- å…§éƒ¨å¯¦ç¾"""

    def __init__(self):
        self.agent_id = "mm-agent"
        self.agent_type = "bpa"
        self.version = "4.0.0"

    async def execute(
        self, request: AgentServiceRequest
    ) -> AgentServiceResponse:
        """åŸ·è¡Œç‰©æ–™ç®¡ç†ä»»å‹™"""
        pass

    async def health_check(self) -> AgentServiceStatus:
        """å¥åº·æª¢æŸ¥"""
        pass

    async def get_capabilities(self) -> dict:
        """ç²å–æœå‹™èƒ½åŠ›"""
        pass
```

### 4.2 Capabilities

```python
async def get_capabilities(self) -> dict:
    return {
        "agent_id": "mm-agent",
        "version": "4.0.0",
        "description": "ç‰©æ–™ç®¡ç†æ¥­å‹™Agent",
        "agent_type": "bpa",
        "capabilities": [
            {
                "name": "query_inventory",
                "description": "æŸ¥è©¢åº«å­˜é¤˜é¡",
                "parameters": {
                    "item_id": "string",
                    "warehouse": "string|null",
                },
            },
            {
                "name": "query_transactions",
                "description": "æŸ¥è©¢äº¤æ˜“æ­·å²",
                "parameters": {
                    "item_id": "string",
                    "tlf19": "string",
                    "date_range": "string",
                },
            },
            {
                "name": "analyze_shortage",
                "description": "ç¼ºæ–™åˆ†æ",
                "parameters": {
                    "item_id": "string",
                },
            },
        ],
        "protocols": ["http", "mcp"],
    }
```

---

## 4. API æ¥å£

### 4.1 ç¨ç«‹æœå‹™æ¥å£

**Base URL**: `http://localhost:8005`

| Method | Endpoint          | åŠŸèƒ½            |
| ------ | ----------------- | --------------- |
| POST   | `/execute`      | åŸ·è¡Œ Agent ä»»å‹™ |
| GET    | `/health`       | å¥åº·æª¢æŸ¥        |
| GET    | `/capabilities` | æŸ¥è©¢èƒ½åŠ›åˆ—è¡¨    |
| POST   | `/register`     | è¨»å†Šåˆ° Registry |

### 4.2 è«‹æ±‚æ ¼å¼

```json
// POST /execute
{
  "task_id": "task-001",
  "task_type": "mm_query",
  "task_data": {
    "instruction": "RM05-008 ä¸Šæœˆè²·é€²å¤šå°‘",
    "parameters": {}
  },
  "context": {
    "user_id": "user_001",
    "session_id": "session_001"
  },
  "metadata": {
    "version": "4.0.0"
  }
}
```

### 4.3 éŸ¿æ‡‰æ ¼å¼

```json
{
  "task_id": "task-001",
  "status": "completed",
  "result": {
    "success": true,
    "task_type": "query_transactions",
    "intent": "purchase",
    "translation": {
      "tlf19": "101",
      "time_expr": "DATE_SUB(CURDATE(), INTERVAL 1 MONTH)"
    },
    "response": "RM05-008 åœ¨ä¸Šæœˆï¼ˆ2025-12ï¼‰æ¡è³¼é€²è²¨å…± 5,000 KG",
    "data": {
      "total_quantity": 5000,
      "unit": "KG",
      "period": "2025-12"
    }
  },
  "metadata": {
    "execution_time_ms": 150,
    "agent_version": "4.0.0"
  }
}
```

---

## 5. æ ¸å¿ƒæ¨¡çµ„

### 5.1 Semantic Analyzerï¼ˆL1 èªç¾©ç†è§£ï¼‰

```python
class SemanticAnalyzer:
    """èªç¾©åˆ†ææœå‹™ - L1 å±¤"""

    async def analyze(self, instruction: str) -> SemanticAnalysisResult:
        """
        åˆ†æç”¨æˆ¶æŒ‡ä»¤

        Returns:
            SemanticAnalysisResult:
                - intent: æ„åœ–é¡åˆ¥
                - confidence: ç½®ä¿¡åº¦
                - parameters: æå–çš„åƒæ•¸
        """
        pass
```

### 5.2 Translatorï¼ˆL2 æ„åœ–æŠ½è±¡ï¼‰

```python
class Translator:
    """è½‰è­¯å¼•æ“ - L2 å±¤"""

    def translate_time(self, time_expr: str) -> str:
        """æ™‚é–“è¡¨é”å¼è½‰è­¯"""
        pass

    def translate_tlf19(self, action: str) -> str:
        """tlf19 äº¤æ˜“é¡åˆ¥è½‰è­¯"""
        pass

    def translate(self, semantic_result: dict) -> TranslationResult:
        """å®Œæ•´è½‰è­¯"""
        pass
```

### 5.3 Positive Listï¼ˆL4 ç­–ç•¥æª¢æŸ¥ï¼‰

```python
class PositiveListChecker:
    """æ­£é¢è¡¨åˆ—æª¢æŸ¥ - L4 å±¤"""

    def check(self, query: str) -> tuple[bool, list[str]]:
        """æª¢æŸ¥æŸ¥è©¢æ˜¯å¦åœ¨æ­£é¢è¡¨åˆ—å…§"""
        pass
```

---

## 4. æœå‹™éƒ¨ç½²

### 4.1 ç«¯å£é…ç½®

| æœå‹™          | ç«¯å£ | èªªæ˜                         |
| ------------- | ---- | ---------------------------- |
| Data-Agent    | 8005 | æ•¸æ“šæŸ¥è©¢ã€Qdrant æ„åœ–åŒ¹é…    |
| MM-Agent      | 8003 | æ¥­å‹™é‚è¼¯ã€LangChain å°è©±ç·¨æ’ |
| 8503 Frontend | 8503 | React å‰ç«¯ç•Œé¢               |

### 4.2 å‰ç«¯èª¿ç”¨æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     8503 Frontend (React)                        â”‚
â”‚                     http://localhost:8503                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    NLP æŸ¥è©¢é é¢                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  const handleQuery = async (query: string) => {         â”‚   â”‚
â”‚  â”‚    if (isMMScenario(query)) {                           â”‚   â”‚
â”‚  â”‚      // èª¿ç”¨ MM-Agent                                   â”‚   â”‚
â”‚  â”‚      await fetch('http://localhost:8003/api/v1/...')    â”‚   â”‚
â”‚  â”‚    } else {                                             â”‚   â”‚
â”‚  â”‚      // èª¿ç”¨ Data-Agent                                 â”‚   â”‚
â”‚  â”‚      await fetch('http://localhost:8005/api/v1/...')    â”‚   â”‚
â”‚  â”‚    }                                                    â”‚   â”‚
â”‚  â”‚  }                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MM-Agent   â”‚    â”‚Data-Agent  â”‚    â”‚ å…¶ä»–æœå‹™   â”‚
    â”‚ 8003       â”‚    â”‚ 8005       â”‚    â”‚ ...        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  AI-Box Orchestratorâ”‚
              â”‚   (MCP çµ±ä¸€èª¿åº¦)    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 å‰ç«¯èª¿ç”¨ç­–ç•¥

| å ´æ™¯                 | èª¿ç”¨æœå‹™          | èªªæ˜           |
| -------------------- | ----------------- | -------------- |
| åº«å­˜æŸ¥è©¢ã€æ¡è³¼ã€éŠ·å”® | MM-Agent (8003)   | æ¥­å‹™é‚è¼¯ã€è½‰è­¯ |
| æ•¸æ“šå„€è¡¨æ¿ã€çµ±è¨ˆ     | Data-Agent (8005) | æ•¸æ“šæŸ¥è©¢       |
| AI-Box å”èª¿          | MCP (8003)        | è·¨ç³»çµ±èª¿åº¦     |

### 4.4 API ç«¯é»

#### MM-Agent (8003)

| Method | Endpoint                       | åŠŸèƒ½           |
| ------ | ------------------------------ | -------------- |
| POST   | `/api/v1/mm-agent/chat`      | LangChain å°è©± |
| POST   | `/api/v1/mm-agent/translate` | å°ˆæ¥­è¡“èªè½‰è­¯   |
| POST   | `/api/v1/mm-agent/check`     | æ­£é¢è¡¨åˆ—æª¢æŸ¥   |
| GET    | `/health`                    | å¥åº·æª¢æŸ¥       |
| GET    | `/capabilities`              | èƒ½åŠ›åˆ—è¡¨       |
| POST   | `/mcp`                       | MCP é€šä¿¡       |

#### Data-Agent (8005)

| Method | Endpoint                          | åŠŸèƒ½     |
| ------ | --------------------------------- | -------- |
| POST   | `/api/v1/data-agent/query`      | æ•¸æ“šæŸ¥è©¢ |
| GET    | `/api/v1/datalake/inventory`    | åº«å­˜æ•¸æ“š |
| GET    | `/api/v1/datalake/transactions` | äº¤æ˜“æ•¸æ“š |

---

## 5. æ ¸å¿ƒæ¨¡çµ„

```python
# main.py
import asyncio
from mcp.server.fastmcp import FastMCP
from semantic_analyzer import SemanticAnalyzer
from translator import Translator
from positive_list import PositiveListChecker


async def main():
    """å•Ÿå‹• MM-Agent MCP Server"""
    mcp = FastMCP("mm-agent")

    # åˆå§‹åŒ–çµ„ä»¶
    semantic_analyzer = SemanticAnalyzer()
    translator = Translator()
    positive_list = PositiveListChecker()

    @mcp.tool()
    async def execute_task(
        task_id: str,
        instruction: str,
        context: dict | None = None,
    ) -> dict:
        """åŸ·è¡Œ MM-Agent ä»»å‹™"""
        # L1: æ­£é¢è¡¨åˆ—æª¢æŸ¥
        if not positive_list.check(instruction):
            return {
                "task_id": task_id,
                "status": "clarification_needed",
                "result": {
                    "message": positive_list.get_clarification_message()
                }
            }

        # L2: èªç¾©åˆ†æ
        semantic_result = await semantic_analyzer.analyze(instruction)

        # L3: è½‰è­¯
        translation = translator.translate(semantic_result)

        # åŸ·è¡Œæ¥­å‹™é‚è¼¯...
        # ...

        return {
            "task_id": task_id,
            "status": "completed",
            "result": {"response": "..."}
        }

    await mcp.run_tcp(host="0.0.0.0", port=8005)


if __name__ == "__main__":
    asyncio.run(main())
```

### 5.2 ç’°å¢ƒè®Šæ•¸

| ä»£ç¢¼ | é¡åˆ¥     | åº«å­˜è®Šå‹• | èªªæ˜                   |
| ---- | -------- | -------- | ---------------------- |
| 101  | æ¡è³¼é€²è²¨ | +        | æ¡è³¼å…¥åº«ï¼Œå¢åŠ åº«å­˜     |
| 102  | å®Œå·¥å…¥åº« | +        | ç”Ÿç”¢å®Œå·¥å…¥åº«ï¼Œå¢åŠ åº«å­˜ |
| 201  | ç”Ÿç”¢é ˜æ–™ | -        | ç”Ÿç”¢é ˜ç”¨åŸæ–™ï¼Œæ¸›å°‘åº«å­˜ |
| 202  | éŠ·å”®å‡ºåº« | -        | éŠ·å”®å‡ºè²¨ï¼Œæ¸›å°‘åº«å­˜     |
| 301  | åº«å­˜å ±å»¢ | -        | æè€—å ±å»¢ï¼Œæ¸›å°‘åº«å­˜     |

### 6.1 è½‰è­¯è¦å‰‡

```python
TRANSACTION_TYPE_MAP = {
    # æ¡è³¼ç›¸é—œ
    "æ¡è³¼": "101", "è²·": "101", "è²·é€²": "101", "é€²": "101",
    "é€²è²¨": "101", "æ”¶æ–™": "101",
    # å®Œå·¥å…¥åº«
    "å®Œå·¥å…¥åº«": "102", "å…¥åº«": "102",
    # ç”Ÿç”¢é ˜æ–™
    "é ˜æ–™": "201", "ç”Ÿç”¢é ˜æ–™": "201",
    # éŠ·å”®ç›¸é—œ
    "éŠ·å”®": "202", "è³£": "202", "è³£å‡º": "202", "å‡ºè²¨": "202",
    # å ±å»¢
    "å ±å»¢": "301", "å ±æ": "301",
}
```

---

## 7. æ­£é¢è¡¨åˆ—ç­–ç•¥

### 7.1 é—œéµè©åˆ—è¡¨

```python
POSITIVE_KEYWORDS = [
    # æ ¸å¿ƒæ¥­å‹™
    "æ¡è³¼", "è²·", "è³£", "åº«å­˜", "è¨‚å–®", "é€²è²¨", "å‡ºè²¨",
    "æ”¶æ–™", "é ˜æ–™", "å ±å»¢", "ç›¤é»",
    # æ•¸é‡
    "å¤šå°‘", "ç¸½æ•¸", "æ•¸é‡", "åˆè¨ˆ", "ç¸½è¨ˆ",
    # æ™‚é–“
    "ä¸Šæœˆ", "ä¸Šå€‹æœˆ", "å‰æœˆ", "æœ€è¿‘", "ä»Šå¹´", "å»å¹´",
    # æ–™è™Ÿå‰ç¶´
    "10-", "RM", "ABC-", "RM05", "ABC",
    # Data Dictionary
    "æ¬„ä½", "è¡¨æ ¼", "çµæ§‹", "èªªæ˜", "å®šç¾©", "schema",
    # å•å¥é–‹é ­
    "çµ¦æˆ‘çœ‹", "å‘Šè¨´æˆ‘", "æŸ¥è©¢", "é¡¯ç¤º",
]
```

### 7.2 Clarification å“åº”

```python
CLARIFICATION_MESSAGE = (
    "ğŸ’¡ ç„¡æ³•ç†è§£æ‚¨çš„æŸ¥è©¢ï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹é—œéµè©ï¼š"
    "æ¡è³¼ã€åº«å­˜ã€è¨‚å–®ã€æ•¸é‡ã€æ–™è™Ÿç­‰ã€‚"
)
```

---

## 8. æœå‹™éƒ¨ç½²

### 8.1 ç’°å¢ƒè®Šæ•¸

```env
# MM-Agent é…ç½®
MM_AGENT_HOST=0.0.0.0
MM_AGENT_PORT=8005
MM_AGENT_VERSION=4.0.0

# AI-Box Registry
AGENT_REGISTRY_URL=http://localhost:8000
AGENT_REGISTRY_ENABLED=true

# å…¬å…±æœå‹™
QDRANT_URL=http://localhost:6333
ARANGODB_URL=http://localhost:8529
DATALAKE_ENDPOINT=http://localhost:8004
```

### 8.2 Docker éƒ¨ç½²

```dockerfile
FROM python:3.12-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8005

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8005"]
```

---

## 10. LLM é…ç½®

### 10.1 Ollama é…ç½®

| é…ç½®é …      | å€¼                         |
| ----------- | -------------------------- |
| Provider    | Ollama                     |
| Model       | `glm-4.7:cloud`          |
| Endpoint    | `http://localhost:11434` |
| Temperature | 0.1ï¼ˆä½æº«ï¼Œæé«˜ç¢ºå®šæ€§ï¼‰    |
| Timeout     | 60s                        |

### 10.2 LLM ä½¿ç”¨å ´æ™¯

| å ´æ™¯     | ç”¨é€”               | Temperature |
| -------- | ------------------ | ----------- |
| èªç¾©åˆ†æ | æ„åœ–åˆ†é¡ã€åƒæ•¸æå– | 0.1         |
| è½‰è­¯     | å°ˆæ¥­è¡“èªè½‰æ›       | 0.1         |
| å›è¦†ç”Ÿæˆ | è‡ªç„¶èªè¨€å›è¦†       | 0.7         |

### 10.3 Ollama èª¿ç”¨æ–¹å¼

```python
from langchain_ollama import ChatOllama

llm = ChatOllama(
    model="glm-4.7:cloud",
    temperature=0.1,
    base_url="http://localhost:11434",
)

response = llm.invoke("æ ¹æ“šä»¥ä¸‹æ•¸æ“šï¼Œç”¨ç¹é«”ä¸­æ–‡å›è¦†ï¼š...")
```

### 10.4 ç’°å¢ƒè®Šæ•¸

```env
OLLAMA_HOST=http://localhost:11434
OLLAMA_MODEL=glm-4.7:cloud
```

---

## 11. å¯¦ä½œæ¸…å–®

- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 
- [ ] 

---

## 12. åƒè€ƒæ–‡æª”

- [Agent-é–‹ç™¼è¦ç¯„.md](../../../../../../docs/ç³»ç»Ÿè®¾è®¡æ–‡æ¡£/æ ¸å¿ƒç»„ä»¶/Agentå¹³å°/Agent-é–‹ç™¼è¦ç¯„.md)
- [åº«ç®¡å“¡-Agent-è¦æ ¼æ›¸-v3](åº«ç®¡å“¡-Agent-è¦æ ¼æ›¸-v3.md)

---

## 9. äº¤ä»˜æ¨™æº–

Agent çš„å›è¦†æ‡‰å…·å‚™å°ˆæ¥­å£å»ï¼š

**ç”¨æˆ¶å•**ï¼šã€ŒRM05-008 ä¸Šæœˆè²·é€²å¤šå°‘ã€
**Agent å›è¦†**ï¼š

> ã€ŒRM05-008 åœ¨ä¸Šæœˆï¼ˆ2025-12ï¼‰æ¡è³¼é€²è²¨å…± **5,000 KG**ã€‚
>
> - äº¤æ˜“é¡åˆ¥ï¼štlf19=101ï¼ˆæ¡è³¼é€²è²¨ï¼‰
> - æ•¸æ“šä¾†æºï¼štlf_fileã€

**ç”¨æˆ¶å•**ï¼šã€Œåº«å­˜é‚„æœ‰å¤šå°‘ã€
**Agent å›è¦†**ï¼š

> ã€ŒğŸ’¡ ç„¡æ³•ç†è§£æ‚¨çš„æŸ¥è©¢ï¼Œè«‹æä¾›æ–™è™Ÿï¼ˆä¾‹å¦‚ï¼šRM05-008ï¼‰ã€‚ã€

ä¸åœ¨æ­£é¢è¡¨åˆ—å…§ï¼Œè¿”å›æ¾„æ¸…æç¤ºï¼š

> ğŸ’¡ ç„¡æ³•ç†è§£æ‚¨çš„æŸ¥è©¢ï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹é—œéµè©ï¼šæ¡è³¼ã€åº«å­˜ã€è¨‚å–®ã€æ•¸é‡ç­‰ã€‚

---

## 6. äº¤ä»˜æ¨™æº–

Agent çš„å›è¦†æ‡‰å…·å‚™å°ˆæ¥­å£å»ï¼š

**ç”¨æˆ¶å•**ï¼šã€ŒRM05-008 ä¸Šæœˆè²·é€²å¤šå°‘ã€
**Agent å›è¦†**ï¼š

> ã€ŒRM05-008 åœ¨ä¸Šæœˆï¼ˆ2025-12ï¼‰æ¡è³¼é€²è²¨å…± **5,000 KG**ã€‚
> äº¤æ˜“é¡åˆ¥ï¼štlf19=101ï¼ˆæ¡è³¼é€²è²¨ï¼‰
> æ•¸æ“šä¾†æºï¼štlf_fileã€

---

## 7. æ–‡ä»¶çµæ§‹

```
datalake-system/
â”œâ”€â”€ mm_agent/
â”‚   â”œâ”€â”€ agent.py              # ä¸»é‚è¼¯ + Todo ç·¨æ’
â”‚   â”œâ”€â”€ semantic_analyzer.py  # èªç¾©è§£æ
â”‚   â”œâ”€â”€ translator.py         # æ–°å¢ï¼šè½‰è­¯å¼•æ“
â”‚   â””â”€â”€ models.py             # æ•¸æ“šæ¨¡å‹
â”‚
â””â”€â”€ frontend/
    â””â”€â”€ api_server.py         # API æ¥å£ + æ­£é¢è¡¨åˆ—
```

---

## 13. åŠŸèƒ½æ¸…å–®

### 13.1 å·²å¯¦ç¾åŠŸèƒ½ âœ… (v4.0 å®Œæˆ)

| åŠŸèƒ½æ¨¡çµ„                    | åŠŸèƒ½é …ç›®                       | ä»£ç¢¼ä½ç½®                      | ç‹€æ…‹ | èªªæ˜                     |
| --------------------------- | ------------------------------ | ----------------------------- | ---- | ------------------------ |
| **è½‰è­¯å¼•æ“**          |                                | `translator.py`             | âœ…   |                          |
|                             | tlf19 äº¤æ˜“é¡åˆ¥è½‰è­¯             | line 45-62                    | âœ…   | 101/102/201/202/301      |
|                             | æ™‚é–“è¡¨é”å¼è½‰è­¯                 | line 64-74                    | âœ…   | ä¸Šæœˆ/æœ€è¿‘Nå¤©/æœ¬æœˆä»½      |
|                             | æ–™è™Ÿæå–                       | line 76-91                    | âœ…   | RM05-008, ABC-123        |
|                             | æ•¸é‡æå–                       | line 93-117                   | âœ…   | æ•¸å­—+å–®ä½                |
|                             | å€‰åº«æå–                       | line 119-151                  | âœ…   | W01-W05                  |
| **æ­£é¢è¡¨åˆ—**          |                                | `positive_list.py`          | âœ…   |                          |
|                             | é—œéµè©ç™½åå–®                   | line 20-38                    | âœ…   | 25+ é—œéµè©               |
|                             | Clarification æ¶ˆæ¯             | line 28-31                    | âœ…   | æ¾„æ¸…æç¤º                 |
|                             | æª¢æŸ¥ API                       | line 43-47                    | âœ…   | check() æ–¹æ³•             |
| **LangChain å°è©±éˆ**  |                                | `chain/mm_agent_chain.py`   | âœ…   |                          |
|                             | Ollama LLM æ•´åˆ                | line 55-63                    | âœ…   | glm-4.7:cloud            |
|                             | L4 æ­£é¢è¡¨åˆ—æª¢æŸ¥                | line 111-117                  | âœ…   |                          |
|                             | L2 å°ˆæ¥­è½‰è­¯                    | line 119-121                  | âœ…   |                          |
|                             | L1 æ„åœ–åˆ†æ                    | line 123-131                  | âœ…   | purchase/sales/inventory |
|                             | Data-Agent é›†æˆ                | line 175-210                  | âœ…   | StockService æŸ¥è©¢        |
|                             | å›è¦†ç”Ÿæˆ                       | line 133-150                  | âœ…   | ç¹é«”ä¸­æ–‡                 |
| **Data-Agent å®¢æˆ¶ç«¯** |                                | `data_agent_client.py`      | âœ…   | æ–°å¢                     |
|                             | HTTP API èª¿ç”¨                  | å…¨æ–‡ä»¶                        | âœ…   | execute_action()         |
|                             | text_to_sql                    | å…¨æ–‡ä»¶                        | âœ…   | è‡ªç„¶èªè¨€â†’SQL            |
|                             | execute_sql_on_datalake        | å…¨æ–‡ä»¶                        | âœ…   | Datalake SQL æŸ¥è©¢        |
|                             | query_datalake                 | å…¨æ–‡ä»¶                        | âœ…   | æ–‡ä»¶æŸ¥è©¢                 |
| **StockService**      |                                | `services/stock_service.py` | âœ…   | é‡æ§‹                     |
|                             | query_stock_info()             | line 48-93                    | âœ…   | åº«å­˜æŸ¥è©¢ (img_file)      |
|                             | query_transactions()           | line 95-141                   | âœ…   | äº¤æ˜“æŸ¥è©¢ (tlf_file)      |
|                             | query_purchase()               | line 143-183                  | âœ…   | æ¡è³¼æŸ¥è©¢ (tlf19=101)     |
|                             | query_sales()                  | line 185-225                  | âœ…   | éŠ·å”®æŸ¥è©¢ (tlf19=202)     |
| **API ç«¯é»**          |                                | `main.py`                   | âœ…   |                          |
|                             | `/api/v1/mm-agent/chat`      | line 196-217                  | âœ…   | å°è©±æ¥å£                 |
|                             | `/api/v1/mm-agent/translate` | line 220-229                  | âœ…   | è½‰è­¯æ¥å£                 |
|                             | `/api/v1/mm-agent/check`     | line 232-241                  | âœ…   | æª¢æŸ¥æ¥å£                 |
|                             | `/health`                    | line 106-117                  | âœ…   | å¥åº·æª¢æŸ¥                 |
|                             | `/capabilities`              | line 120-129                  | âœ…   | èƒ½åŠ›åˆ—è¡¨                 |
|                             | `/mcp`                       | line 60-95                    | âœ…   | MCP é€šä¿¡                 |
| **MCP Server**        |                                | `mcp_server.py`             | âœ…   |                          |
|                             | mm_execute_task                | line 75-112                   | âœ…   | ä»»å‹™åŸ·è¡Œå·¥å…·             |
| **Agent å”è­°**        |                                | `agent.py`                  | âœ…   |                          |
|                             | execute()                      | line 104-208                  | âœ…   | ä»»å‹™åŸ·è¡Œ                 |
|                             | health_check()                 | line 398-404                  | âœ…   | å¥åº·æª¢æŸ¥                 |
|                             | get_capabilities()             | line 406-420                  | âœ…   | èƒ½åŠ›åˆ—è¡¨                 |
| **æ•¸æ“šæ¨¡å‹**          |                                | `models.py`                 | âœ…   |                          |
|                             | SemanticAnalysisResult         | å…¨æ–‡ä»¶                        | âœ…   | èªç¾©åˆ†æçµæœ             |
|                             | WarehouseAgentResponse         | å…¨æ–‡ä»¶                        | âœ…   | Agent éŸ¿æ‡‰               |
|                             | TranslationResult              | `translator.py`             | âœ…   | è½‰è­¯çµæœ                 |
| **æ¸¬è©¦**              |                                | `tests/`                    | âœ…   |                          |
|                             | test_translator.py             | 25 tests                      | âœ…   | ~90% è¦†è“‹ç‡              |
|                             | test_positive_list.py          | 20 tests                      | âœ…   | ~95% è¦†è“‹ç‡              |
| **ä¾è³´é…ç½®**          |                                | `requirements.txt`          | âœ…   |                          |
|                             | LangChain                      | å…¨æ–‡ä»¶                        | âœ…   | Ollama æ•´åˆ              |
|                             | MCP                            | å…¨æ–‡ä»¶                        | âœ…   | MCP Server               |
|                             | Pydantic                       | å…¨æ–‡ä»¶                        | âœ…   | æ•¸æ“šé©—è­‰                 |
| **æ–‡æª”**              |                                | `åº«ç®¡å“¡-Agent-è¦æ ¼æ›¸.md`    | âœ…   | v4.0                     |

---

### 13.2 å¾…é–‹ç™¼åŠŸèƒ½ â³ (ä¸‹å€‹è¿­ä»£)

#### P0 - é«˜å„ªå…ˆç´šï¼ˆç«‹å³éœ€è¦ï¼‰

| åŠŸèƒ½æ¨¡çµ„                | åŠŸèƒ½é …ç›®                         | å„ªå…ˆç´š | èªªæ˜                    | ä¾è³´    |
| ----------------------- | -------------------------------- | ------ | ----------------------- | ------- |
| **8503 å‰ç«¯é›†æˆ** |                                  | P0     |                         |         |
|                         | API è·¯ç”±é…ç½®                     | P0     | å‰ç«¯â†’MM-Agent          | main.py |
|                         | éŒ¯èª¤è™•ç† UI                      | P0     | ç•°å¸¸å›è¦†é¡¯ç¤º            | -       |
|                         | Loading ç‹€æ…‹                     | P0     | è¼‰å…¥æç¤º                | -       |
| **æ•´åˆæ¸¬è©¦**      |                                  | P0     |                         |         |
|                         | **æ„åœ–èªç¾©æ¸¬è©¦**           | âœ…     | L1/L2/L4 å±¤             | å·²é©—è­‰  |
|                         | **Clarification å›å•æ¸¬è©¦** | âœ…     | 8 å€‹æ¡ˆä¾‹                | å·²é©—è­‰  |
|                         | **çµæ§‹åŒ–æŸ¥è©¢æ•´åˆ**         | âœ…     | MM-Agent â†’ Data-Agent  | å·²é©—è­‰  |
|                         | **ç«¯åˆ°ç«¯æ€§èƒ½æ¸¬è©¦**         | âœ…     | **å¹³å‡ 0ms < 2s** | âœ…      |
|                         | 100 å ´æ™¯æ¸¬è©¦                     | â³     | å›æ­¸æ¸¬è©¦                | -       |

#### P1 - ä¸­å„ªå…ˆç´šï¼ˆè¿‘æœŸéœ€è¦ï¼‰

| åŠŸèƒ½æ¨¡çµ„               | åŠŸèƒ½é …ç›®                 | å„ªå…ˆç´š | èªªæ˜               | ä¾è³´         |
| ---------------------- | ------------------------ | ------ | ------------------ | ------------ |
| **Qdrant æ•´åˆ**  |                          | P1     |                    |              |
|                        | æ„åœ–æ¨¡æ¿åŒ¹é…             | P1     | data_agent_intents | Qdrant é‹è¡Œ  |
|                        | RAG å›é€€æ©Ÿåˆ¶             | P1     | è¤‡é›œæŸ¥è©¢è™•ç†       | -            |
| **å¤šè¼ªå°è©±**     |                          | P1     |                    |              |
|                        | å°è©±æ­·å²ç®¡ç†             | P1     | Context Manager    | Redis        |
|                        | æŒ‡ä»£æ¶ˆè§£                 | P1     | ä¸Šä¸‹æ–‡ç†è§£         | -            |
| **æ¡è³¼æœå‹™é‡æ§‹** |                          | P1     |                    |              |
|                        | é‡æ§‹ purchase_service.py | P1     | ä½¿ç”¨ Data-Agent    | StockService |
|                        | æ¡è³¼å–®ç”Ÿæˆ               | P1     | pmm/pmn/rvb æŸ¥è©¢   | -            |

#### P2 - ä½å„ªå…ˆç´šï¼ˆæœªä¾†éœ€è¦ï¼‰

| åŠŸèƒ½æ¨¡çµ„                | åŠŸèƒ½é …ç›®       | å„ªå…ˆç´š | èªªæ˜                 | ä¾è³´         |
| ----------------------- | -------------- | ------ | -------------------- | ------------ |
| **ArangoDB æ•´åˆ** |                | P2     |                      |              |
|                         | å¯¦é«”é—œä¿‚æŸ¥è©¢   | P2     | mm_agent_entities    | ArangoDB     |
|                         | æ¥­å‹™è¦å‰‡çŸ¥è­˜   | P2     | business_rules       | -            |
| **éƒ¨ç½²**          |                | P2     |                      |              |
|                         | Dockerfile     | P2     | å®¹å™¨åŒ–               | -            |
|                         | docker-compose | P2     | å¤šæœå‹™ç·¨æ’           | -            |
|                         | ç›£æ§å‘Šè­¦       | P2     | å¥åº·æª¢æŸ¥             | -            |
| **æ“´å±•åŠŸèƒ½**      |                | P2     |                      |              |
|                         | SAP Adapter    | P2     | SAP æ•¸æ“šæº           | Data-Agent   |
|                         | Oracle Adapter | P2     | Oracle æ•¸æ“šæº        | Data-Agent   |
|                         | ç¼ºæ–™åˆ†æ       | P2     | shortage_analyzer.py | StockService |

---

### 13.3 è¿­ä»£è¦åŠƒ

#### v4.0 è¿­ä»£ âœ… å·²å®Œæˆ

```
ç›®æ¨™ï¼šæ ¸å¿ƒåŠŸèƒ½å¯¦ç¾ï¼ŒData-Agent é›†æˆ
â”œâ”€â”€ è½‰è­¯å¼•æ“ (translator.py) âœ…
â”œâ”€â”€ æ­£é¢è¡¨åˆ— (positive_list.py) âœ…
â”œâ”€â”€ LangChain å°è©±éˆ (mm_agent_chain.py) âœ…
â”œâ”€â”€ Data-Agent å®¢æˆ¶ç«¯ (data_agent_client.py) âœ…
â”œâ”€â”€ StockService é‡æ§‹ (stock_service.py) âœ…
â”œâ”€â”€ API ç«¯é» (main.py) âœ…
â”œâ”€â”€ å–®å…ƒæ¸¬è©¦ (45 tests) âœ…
â”œâ”€â”€ **æ„åœ–èªç¾©æ¸¬è©¦** âœ…
â”œâ”€â”€ **Clarification å›å•æ¸¬è©¦** âœ…
â”œâ”€â”€ **çµæ§‹åŒ–æŸ¥è©¢æ•´åˆ** âœ…
â””â”€â”€ **ç«¯åˆ°ç«¯æ€§èƒ½æ¸¬è©¦ (0ms < 2s)** âœ…
```

#### v4.1 è¿­ä»£ â³ ä¸‹å€‹è¿­ä»£

```
ç›®æ¨™ï¼šå‰ç«¯é›†æˆï¼Œ100 å ´æ™¯æ¸¬è©¦
â”œâ”€â”€ 8503 å‰ç«¯ API é›†æˆ â³
â”œâ”€â”€ å‰ç«¯éŒ¯èª¤è™•ç†å®Œå–„ â³
â””â”€â”€ 100 å ´æ™¯å›æ­¸æ¸¬è©¦ â³
```

#### v4.2 è¿­ä»£ â³ æœªä¾†è¿­ä»£

```
ç›®æ¨™ï¼šæ™ºèƒ½å°è©±ï¼ŒRAG å¢å¼·
â”œâ”€â”€ Qdrant æ„åœ–åŒ¹é… â³
â”œâ”€â”€ å¤šè¼ªå°è©±ç®¡ç† â³
â”œâ”€â”€ RAG å›é€€æ©Ÿåˆ¶ â³
â””â”€â”€ æ¡è³¼æœå‹™é‡æ§‹ â³
```

#### v4.3 è¿­ä»£ â³ æœªä¾†è¿­ä»£

```
ç›®æ¨™ï¼šéƒ¨ç½²é‹ç¶­ï¼Œå¤šæ•¸æ“šæº
â”œâ”€â”€ Docker å®¹å™¨åŒ– â³
â”œâ”€â”€ SAP Adapter â³
â”œâ”€â”€ Oracle Adapter â³
â””â”€â”€ ç›£æ§å‘Šè­¦ â³
```

---

### 13.4 ä»£ç¢¼å°ç…§è¡¨

| åŠŸèƒ½              | ä»£ç¢¼æª”æ¡ˆ                        | è¡Œæ•¸     | è¿­ä»£    |
| ----------------- | ------------------------------- | -------- | ------- |
| è½‰è­¯å¼•æ“          | `translator.py`               | ~170     | v4.0 âœ… |
| æ­£é¢è¡¨åˆ—          | `positive_list.py`            | ~100     | v4.0 âœ… |
| LangChain å°è©±éˆ  | `chain/mm_agent_chain.py`     | ~200     | v4.0 âœ… |
| Data-Agent å®¢æˆ¶ç«¯ | `data_agent_client.py`        | ~170     | v4.0 âœ… |
| åº«å­˜æŸ¥è©¢æœå‹™      | `services/stock_service.py`   | ~200     | v4.0 âœ… |
| API ç«¯é»          | `main.py`                     | ~220     | v4.0 âœ… |
| MCP Server        | `mcp_server.py`               | ~113     | v4.0 âœ… |
| Agent å”è­°        | `agent.py`                    | ~421     | v4.0 âœ… |
| æ•¸æ“šæ¨¡å‹          | `models.py`                   | ~99      | v4.0 âœ… |
| ä¾è³´é…ç½®          | `requirements.txt`            | ~25      | v4.0 âœ… |
| è¦æ ¼æ–‡æª”          | `åº«ç®¡å“¡-Agent-è¦æ ¼æ›¸.md`      | ~984     | v4.0 âœ… |
| å–®å…ƒæ¸¬è©¦          | `tests/test_translator.py`    | 25 tests | v4.0 âœ… |
| å–®å…ƒæ¸¬è©¦          | `tests/test_positive_list.py` | 20 tests | v4.0 âœ… |
| å‰ç«¯ API è·¯ç”±     | `frontend/api_server.py`      | â³       | v4.1    |
| æ•´åˆæ¸¬è©¦          | `tests/`                      | â³       | v4.1    |
| Qdrant æ„åœ–åŒ¹é…   | `agents/builtin/data_agent/`  | â³       | v4.2    |
| å¤šè¼ªå°è©±          | `chain/context_manager.py`    | â³       | v4.2    |
| Docker éƒ¨ç½²       | `Dockerfile`                  | â³       | v4.3    |
| SAP Adapter       | `data_agent/adapters/`        | â³       | v4.3    |

---

### 13.5 æ¸¬è©¦è¦†è“‹ç‡

| æ¨¡çµ„            | æ¸¬è©¦æª”æ¡ˆ                   | æ¸¬è©¦æ•¸é‡ | è¦†è“‹ç‡ | ç‹€æ…‹          |
| --------------- | -------------------------- | -------- | ------ | ------------- |
| Translator      | `test_translator.py`     | 25       | ~90%   | âœ…            |
| PositiveList    | `test_positive_list.py`  | 20       | ~95%   | âœ…            |
| MMAgentChain    | `test_mm_agent_chain.py` | 15+      | â³     | éœ€ä¾è³´        |
| StockService    | -                          | -        | â³     | éœ€ Data-Agent |
| DataAgentClient | -                          | -        | â³     | éœ€ Data-Agent |

**åŸ·è¡Œæ¸¬è©¦**ï¼š

```bash
cd /home/daniel/ai-box/datalake-system/mm_agent
pip install pytest pytest-asyncio
pytest tests/test_translator.py tests/test_positive_list.py -v
```

**æ•´åˆæ¸¬è©¦ï¼ˆéœ€å•Ÿå‹• Data-Agentï¼‰**ï¼š

```bash
# å•Ÿå‹• Data-Agent
python /home/daniel/ai-box/datalake-system/data_agent/main.py

# æ¸¬è©¦ StockService
python3 -c "
import asyncio
from mm_agent.services.stock_service import StockService

async def test():
    service = StockService()
    result = await service.query_purchase('RM05-008', '2026-01')
    print('æ¡è³¼æŸ¥è©¢çµæœ:', result)

asyncio.run(test())
"
```
