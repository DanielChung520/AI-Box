# 代碼功能說明: Prometheus 监控配置
# 創建日期: 2026-01-18 13:26 UTC+8
# 創建人: Daniel Chung
# 最後修改日期: 2026-01-18 15:06 UTC+8

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: "aibox-production"
    environment: "production"

rule_files:
  - "alerts.yml"

# Alertmanager 配置
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - "alertmanager:9093"

scrape_configs:
  # FastAPI 主服务
  - job_name: "fastapi"
    static_configs:
      - targets: ["host.docker.internal:8000"]
        labels:
          service: "fastapi"
          component: "api"
    metrics_path: "/metrics"
    scrape_interval: 10s

  # Redis Exporter
  - job_name: "redis-exporter"
    static_configs:
      - targets: ["redis-exporter:9121"]
        labels:
          service: "redis"
          component: "cache"
    scrape_interval: 15s

  # ArangoDB 内置 Metrics（使用 ArangoDB 3.6.0+ 的内置 metrics API）
  - job_name: "arangodb"
    static_configs:
      - targets: ["host.docker.internal:8529"]
        labels:
          service: "arangodb"
          component: "database"
    metrics_path: "/_admin/metrics/v2"
    scrape_interval: 15s
    basic_auth:
      username: "root"
      password: "changeme"

  # Node Exporter (系统资源监控)
  - job_name: "node-exporter"
    static_configs:
      - targets: ["node-exporter:9100"]
        labels:
          service: "node"
          component: "system"
    scrape_interval: 15s

  # Prometheus 自监控
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
        labels:
          service: "prometheus"
          component: "monitoring"
    scrape_interval: 15s
